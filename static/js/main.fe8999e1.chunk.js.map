{"version":3,"sources":["utils/ElectrumClient.ts","design-system/Paper.tsx","NetworkContext.tsx","components/ExternalLinkIcon.tsx","utils/contracts.ts","TimeTravel.tsx","components/Link.tsx","components/Address.tsx","components/InfoTooltip.tsx","components/Table.tsx","components/PriceFeed.tsx","components/Box.tsx","utils/getWeiAsEth.ts","utils/getSatoshisAsTBTC.ts","components/FormattedTime.tsx","components/HeaderBoxes.tsx","components/PageHeader.tsx","components/SkeletonLoader.tsx","utils/formatNumber.ts","components/CurrencyTags.tsx","utils/useCoinPrices.ts","components/DollarValue.tsx","pages/Operators.tsx","utils/getSatoshisAsBitcoin.ts","utils/useInterval.ts","utils/depositStates.tsx","design-system/tbtcIcon.tsx","components/CollateralizationStatus.tsx","pages/Operator/KeepsTable.tsx","pages/Beacon/GroupName.ts","components/ETHValue.tsx","pages/Operator/BeaconGroupTable.tsx","components/KeepValue.tsx","components/PageHeaderMenu.tsx","components/Log.tsx","pages/Operator/Log.tsx","components/PropertyTable.tsx","pages/Operator/OverviewTab.tsx","pages/Operator/index.tsx","utils/useElectrumClient.tsx","utils/useBitcoinTxState.ts","utils/useBtcAddressFromPublicKey.ts","components/Loading.tsx","design-system/Button.tsx","utils/getAuctionDetails.ts","pages/Deposit/log.tsx","pages/Deposit/StatusBox.tsx","pages/Deposits/DepositsTable.tsx","pages/Deposits/Views.tsx","components/Pagination.tsx","pages/Deposits/index.tsx","pages/Deposit/index.tsx","design-system/NavigationButton.tsx","pages/About.tsx","components/ExplainerIcon.tsx","utils/calculateMinStake.ts","pages/Governance.tsx","torchAccountMapping.js","pages/tBTCzkSyncTorch.tsx","pages/Users.tsx","pages/Beacon/index.tsx","pages/Group.tsx","pages/Stakedrop.tsx","pages/Grants.tsx","App.tsx","serviceWorker.js","index.js","utils/BitcoinHelpers.js"],"names":["digest","sha256","Client","config","electrumClient","handleNewBlock","messages","msg","height","console","log","emit","ElectrumClient","server","port","protocol","options","on","startBlockListening","stopBlockListening","a","this","connect","catch","err","Error","close","blockchain_headers_subscribe","header","txHash","blockchain_transaction_get","tx","rawTX","blockchain_transaction_broadcast","script","scriptHash","scriptToHash","blockchain_scripthash_listunspent","JSON","stringify","listUnspent","blockchain_scripthash_getBalance","balance","callback","blockchain_scripthash_subscribe","initialStatus","result","blockchain_scripthash_unsubscribe","Promise","resolve","eventName","listener","receivedScriptHash","status","subscribe","off","listenerCount","blockHeight","blockchain_block_header","Buffer","from","slice","confirmations","blockchain_block_headers","headersChain","hex","blockchain_transaction_getMerkle","address","getTransaction","outputs","vout","index","length","scriptPubKey","addresses","blockchain_scripthash_getHistory","history","all","map","confirmedTx","tx_hash","transactions","EventEmitter","reverse","toString","Paper","props","style","className","css","padding","children","Network","ExternalLinkIcon","width","viewBox","fill","d","isVendingMachine","toLowerCase","hasDepositBeenUsedToMint","owner","state","NetworkContext","React","createContext","network","MAINNET","SetNetwork","Provider","value","useNetwork","useContext","useIsRopsten","ROPSTEN","useEtherscanDomain","useDAppDomain","useBlockchainBaseUrl","TimeTravelContext","block","undefined","TimeTravelState","l","useLocation","p","URLSearchParams","search","get","parseInt","useTimeTravelBlock","context","useIsTimeTravel","useQueryWithTimeTravel","query","queryToUse","useMemo","toUse","num","definitions","selectionSet","selections","i","argumentIdx","arguments","findIndex","argument","name","update","0","$unset","useQuery","variables","number","Link","to","others","realTo","Address","knownAddress","etherscan","Hash","hash","includeExternalIcon","long","BitcoinAddress","baseUrl","Transaction","C","linkProps","isLink","startsWith","href","longAddress","hasHexPrefix","indexOf","shortAddress","color","el","createElement","InfoIcon","ref","InfoTooltip","size","content","singleton","Table","classnames","useSort","defaultValue","useState","field","setField","column","setColumn","direction","setDirection","SortableHeader","isCurrent","fieldId","handleClick","useCallback","e","preventDefault","onClick","cursor","RTHeader","sortState","id","isSortedDesc","c","canSort","isSorted","label","tooltip","WATCH_QUERY","gql","QUERY_FOR_BLOCK","usePriceFeed","timeTravelBlock","sResult","useSubscription","skip","qResult","data","loading","error","price","priceFeed","convertedPrices","convertPriceFeedVal","val","btcPerEth","satPerWei","weiPerSat","Box","getWeiAsEth","weis","getSatoshiesAsTBTC","satoshis","dateTimeFrom","time","DateTime","fromSeconds","TimeToNow","dateTime","relString","toRelative","title","toLocaleString","DATETIME_FULL","formatSeconds","seconds","Duration","fromObject","toFormat","FormattedTime","longFormat","weekday","month","day","hour","minute","formatOpts","year","format","TimeBetween","earlier","later","diff","HeaderBoxes","PageHeader","marginBottom","buttons","subtitle","defaultProps","skeletonLineStyle","SkeletonTableRow","Array","columns","_","idx","key","percentFormatter","Intl","NumberFormat","maximumFractionDigits","numberFormatter","formatNumber","parseFloat","formatPercentage","BTCTag","CurrencyTag","currency","ETHTag","symbol","KeepTag","GweiTag","fontSize","fetcher","prices","events","useCoinPrices","setCounter","useEffect","handleUpdate","x","DollarValue","formatter","minimumFractionDigits","dollar","fetch","response","json","bitcoin","usd","ethereum","keep","handle","setInterval","setupInterval","OPERATOR_QUERY","Operators","rates","orderBy","remainingCapacityBTC","stats","availableToBeBonded","totalETH","totalBonded","Helmet","formatterSimple","OperatorsTable","formatterBTC","operators","member","unbound","unboundAvailable","total","bonded","capacityBTC","activeKeepCount","totalKeepCount","stakedAmount","totalTBTCRewards","totalETHRewards","attributableFaultCount","totalFaultCount","stakedAt","stakedropRewardWeight","totalRewardWeight","getSatoshisAsBitcoin","NiceStateLabel","getTimeRemaining","deposit","currentStateTimesOutAt","updatedAt","totalSeconds","secondsNow","diffNow","remaining","percentage","Math","min","useTimeRemaining","interval","isTimeTravel","setValue","delay","savedCallback","useRef","current","args","clearInterval","useInterval","getNiceStateLabel","currentState","depositSetup","failedSetupReason","failureReason","bondedECDSAKeep","publicKey","getStateBoxStyle","backgroundColor","border","getStateTooltip","TBTCIcon","cx","cy","r","stroke","strokeWidth","fillRule","clipRule","getPriceAtCollateralizationRatio","ratio","bondValueWei","totalBondAmount","lotSizeSatoshis","CollaterizationStatusWithPrice","finalBtcPrice","isFinalized","ratioPercent","undercollateralizedThresholdPercent","severelyUndercollateralizedThresholdPercent","highlightNormal","extraStyle","KEEPS_QUERY","KeepsTable","useSingleton","source","target","operatorId","orderDirection","keeps","operator","createdAt","contractAddress","tdtToken","RewardStatus","stakedropRewardStatus","StakeDropIcons","StakeDropStatusExplainer","url","src","getGroupName","groupId","uniqueNamesGenerator","dictionaries","colors","animals","separator","seed","ETHValue","wei","factor","maxDigits","eth","unit","BeaconGroupsTable","memberships","membership","group","pubKey","count","reward","keepFormatter","KeepValue","raw","PageHeaderMenu","trigger","hideOnClick","arrow","interactive","maxWidth","placement","LogTitle","LogEntry","event","Component","Components","__typename","UnknownEvent","timestamp","transactionHash","submitter","OPERATOR_LOG_QUERY","OperatorLog","LogComponents","amount","destination","newAmount","isDeauthorization","authorizationType","PropertyTable","groupList","properties","row","fontWeight","colSpan","OPERATOR_INFO_QUERY","OverviewTab","display","flexDirection","flex","stakeLockExpiresAt","ethLocked","beneficiary","authorizer","randomBeaconOperatorAuthorized","bondedECDSAKeepFactoryAuthorized","tbtcSystemSortitionPoolAuthorized","stakedropEthScore","stakedropBoost","marginTop","Operator","Content","useParams","tabId","useHistory","TAB_IDS","activeTabIndex","activeTab","stakedropRewardsDispensed","selectedIndex","onSelect","replace","beaconGroupMemberships","BitcoinHelpers","setElectrumConfig","State","refCount","client","connectingPromise","scheduledDisconnect","window","clearTimeout","electrumConfig","useElectrumClient","setClient","acquireConnection","then","setTimeout","useBitcoinTxState","isEnabled","isTimeTravelMode","setTxHash","isInitialized","setInitialized","setConfirmations","lotSizeSatoshisInt","waitForTxAndConfirmations","cancelToken","findWithClient","set","findOrWaitFor","transactionID","checkForConfirmations","waitForConfirmations","requiredConfirmations","unsubscribe","hasTransaction","numConfirmations","useBtcAddressFromPublicKey","publicKeyToP2WPKHAddress","Loading","transform","strokeOpacity","attributeName","type","dur","repeatCount","Button","extraProps","paddingFactor","AuctionDetailsFragment","getAuctionDetailsFromDeposit","opts","elapsed","endDate","utc","liquidationInitiated","as","available","bondValue","basePercentage","floor","initialCollateralizedPercent","nextValue","getAuctionDetails","depositLiquidation","liquidatedAt","Log","depositId","logEntry","publicKeyPointToP2WPKHAddress","signingGroupPubkeyX","signingGroupPubkeyY","cause","getLiquidationCauseAsString","description","fromScript","redeemerOutputScript","reason","allSigners","members","s","goodSigners","Set","pubkeySubmissions","badSigners","filter","has","reduce","prev","curr","details","StatusBox","secondLine","blockChainBaseUrl","dAppDomain","btcAddress","shouldShowConfirmationInfo","btcTxState","timing","action","textAlign","NotifyButton","paddingLeft","LabelWithBackgroundProgress","progress","lineHeight","alignItems","singleColor","position","zIndex","left","top","bottom","depositAbi","func","wallet","useWallet","isBusy","setBusy","ethers","provider","providers","Web3Provider","contract","Contract","daiWithSigner","getSigner","gasLimit","wait","DepositsTable","dateColumn","dateColumnTitle","dateColumnTooltip","deposits","DepositRow","memo","StateLabelWithProgressBar","FundingStatus","lastActor","Views","DEPOSITS_QUERY","Pagination","pagination","items","hasNext","page","PaginationButton","marginLeft","margin","Deposits","viewName","view","tippy","pageNumber","setPageNumber","currentView","v","depositQuery","where","active","liquidations","redeemable","round","toMillis","unminted","notifiable","redemptions","operations","ready","setReady","perPage","useDepositQuery","push","numResults","usePagination","onCreate","instance","hide","alt","visibility","depositCount","DEPOSIT_QUERY","DEPOSIT_SUBSCRIPTION","Deposit","subscription","useTimeTravelSafeSubscription","marginRight","Summary","NextStep","m","toFixed","honestThreshold","minter","tokenID","endOfTerm","keepAddress","WaitingForFundingProof","WaitingForFundingStart","WaitingForSignerSetup","canBeRedeemedByAnyone","LiquidationSummary","NavigationButton","forwardRef","isActive","pathname","innerRef","data-active","About","ExplainerIcon","GOVERNANCE_QUERY","Governance","Block","governance","newDepositsAllowed","formatLotSizes","lotSizes","signerFeeDivisor","factorySelector","fullyBackedFactory","keepStakedFactory","priceFeeds","feed","minWidth","PriceInfo","FixedParams","paddingBottom","governanceLogEntries","entry","blockNumber","now","Date","minimumStakeScheduleStart","calculateMinStake","join","change","isRequest","LotSizesChangeRequest","LotSizesChangeDone","UnsupportedChange","ActionDesc","headline","newLotSizes","takesEffectAfter","TorchMapping","ZksyncTorch","chain","setChain","setError","setLoading","item","Step","txid","tx_id","tweetId","tweetUrl","match","conversation","placeholder","USERS_QUERY","Users","UsersTable","users","user","numDepositsCreated","numDepositsUnfunded","numDepositsRedeemed","numOwnDepositsRedeemed","BEACON_QUERY","Beacon","RelayEntriesTable","relayEntries","requestedAt","generatedAt","rewardPerMember","requestId","randomBeaconGroups","BEACONGROUP_QUERY","BeaconGroup","randomBeaconGroup","STAKEDROP_QUERY","ecdsaWeights","maxWeight","max","getCurrentInterval","maxIntervals","intervalOf","getIntervalStart","Stakedrop","coinPrices","calculatorData","setCalculatorData","handleRewardShareChanged","intervals","stakedropIntervals","currentIntervalECDSAAllocation","fontFamily","borderBottom","justifyContent","KeepAsDollarValue","APYCalculatorUI","totalWeight","onRewardShareChanged","intervalAllocation","weight","startTimestamp","endTimestamp","hasEnded","monthString","tooltipText","rewardShare","calculateAPR","ethUsed","keepUsed","barText","SingleInterval","showECDSA","showBeacon","perKeepPerOperator","allocationECDSA","keepCount","perBeaconGroup","allocationBeacon","beaconGroupCount","ecdsaEndDate","ecdsaIntervalEnd","secondsToEcdsaEnd","beaconEndDate","beaconIntervalEnd","secondsToBeaconEnd","totalKeep","start","ecdsaIntervalStart","beaconIntervalStart","end","secondsToEnd","usdValue","showTilde","showCents","ethPrice","keepPrice","keepRewards","usdValueRewards","apr","APYOutput","calcResult","setEth","ethText","setEthText","setKeep","keepText","setKeepText","handleKeep","toNumber","Number","isNaN","handleEth","rewardWeight","ethScore","sqrt","boostFactor1","boostFactor2","boost","getStakedropRewardFormula","share","onChange","GRANTS_QUERY","Grants","GrantsTable","KnownStakingPolicies","Header","accessor","Cell","disableSortBy","GrantAmountsAsBar","grant","original","obj","percent","cliff","revokedAt","revocable","policy","currentSortBy","desc","tableInstance","useTable","grants","useControlledState","sortBy","manualSortBy","autoResetSortBy","useSortBy","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","headerGroup","getHeaderGroupProps","headers","getHeaderProps","render","getRowProps","cells","cell","getCellProps","FixedNumber","isZero","staked","divUnsafe","withdrawn","revoked","revokedAmount","remainder","subUnsafe","h","mulUnsafe","makeApolloLink","uri","httpLink","HttpLink","wsLink","WebSocketLink","reconnect","split","definition","getMainDefinition","kind","operation","AppInternal","isRopsten","ApolloClient","cache","InMemoryCache","link","chainId","titleTemplate","TimeTravelWarning","path","exact","App","location","host","SettingsDropdownButton","nonTimeTravelLink","delete","NetSwitcher","TimeTravelField","show","text","setText","apply","onBlur","onKeyDown","keyCode","Boolean","hostname","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","registration","unregister","message","Script","BcoinScript","TESTNET","SIMNET","REGTEST","newConfig","signatureDER","bitcoinSignature","secp256k1","signatureNormalize","concat","signatureExport","publicKeyPointToPublicKeyString","publicKeyX","publicKeyY","bitcoinNetwork","pubKeyHashToBech32","pubKeyHash","fromProgram","getAddress","toBech32","splitPublicKey","publicKeyString","substring","xString","yString","y","publicKeyImport","keyRing","KeyRing","fromKey","p2wpkhAddress","getKeyHash","toScript","toRawScript","fromRaw","fromAddress","toRaw","withElectrumClient","find","bitcoinAddress","expectedValue","findScript","outputScript","outpoint","checkTransactions","onTransactionToScript","onReceivedConfirmation","checkConfirmations","broadcast","signedTransaction","broadcastTransaction","addWitnessSignature","unsignedTransaction","inputIndex","compressedPublicKey","hashType","ALL","sig","publicKeyBytes","TX","clone","inputs","witness","fromItems","constructOneInputOneOutputWitnessTransaction","previousOutpoint","inputSequence","outputValue","prevOutpoint","Outpoint","input","Input","fromOptions","prevout","sequence","rawOutputScript","output","Output","findAllUnspent","findAllUnspentWithClient","getBalance","getBalanceOfScript","confirmed","receiverScript","getUnspentToScript","unspentTransactions","vin","some","outputPosition","tx_pos"],"mappings":"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","file":"static/js/main.fe8999e1.chunk.js","sourcesContent":["import ElectrumClient from \"electrum-client-js\"\nimport sha256 from \"bcrypto/lib/sha256-browser.js\"\nimport {EventEmitter} from 'events';\nconst { digest } = sha256\n\n/**\n * @typedef {object} ScriptPubKey\n * @property {string[]} addresses The addresses associated with this\n *           ScriptPubKey; one for regular ScriptPubkeys, more for multisigs.\n * @property {\"pubkeyhash\" | string} type The type of ScriptPubKey.\n */\n\n/**\n * @typedef {object} TransactionInput\n * @property {object} scriptSig The scriptsig that unlocks the specified\n *           outpoint for spending.\n * @property {string} txid The id of the transaction the input UTXO comes from.\n * @property {number} vout The vout from the specified txid that is being used\n *           for this input.\n */\n\n/**\n * @typedef {object} TransactionOutput\n * @property {number} n The 0-based index of the output.\n * @property {number} value The value of the output in BTC.\n * @property {ScriptPubKey} scriptPubKey The receiving ScriptPubKey.\n */\n\n/**\n * @typedef {object} TransactionData\n * @property {string} blockhash The blockhash of the transaction's containing\n *           block as an unprefixed hex string.\n * @property {number} confirmations The number of confirmations the transaction\n *           has received, including the containing blockhash.\n * @property {string} hash The transaction hash (or transaction ID) as an\n *           unprefixed hex string.\n * @property {string} hex The full transaction payload as an unprefixed hex\n *           string.\n * @property {string} txid The transaction ID (or transaction hash) as an\n *           unprefixed hex string.\n * @property {TransactionInput[]} vin The vector of transaction inputs.\n * @property {TransactionOutput[]} vout The vector of transaction outputs.\n */\n\n/**\n * Configuration of electrum client.\n * @typedef {object} Config\n * @property {string} server ElectrumX server hostname.\n * @property {number} port ElectrumX server port.\n * @property {\"ssl\"|\"tls\"|\"ws\"|\"wss\"} protocol The server connection protocol to\n *           use for the specified `server`.\n * @property {object} [options] Additional options for the server connection.\n *           For WebSocket connections, these are `W3CWebSocket` options; for\n *           SSL/TLS connections, they are Node `TLSSocket` options.\n */\n\ninterface NewBlockData {\n  height: number,\n  hex: string\n}\n\n/**\n * Client to interact with [ElectrumX](https://electrumx.readthedocs.io/en/stable/index.html)\n * server.\n * Uses methods exposed by the [Electrum Protocol](https://electrumx.readthedocs.io/en/stable/protocol.html)\n */\nexport default class Client extends EventEmitter {\n\n  private electrumClient: any;\n\n  /**\n   * Initializes Electrum Client instance with provided configuration.\n   * @param {Config} config Electrum client connection configuration.\n   */\n  constructor(config: any) {\n    super();\n    this.electrumClient = new ElectrumClient(\n        config.server,\n        config.port,\n        config.protocol,\n        config.options\n    );\n\n    this.on('newListener', () => { this.startBlockListening() });\n    this.on('removeListener', () => this.stopBlockListening())\n  }\n\n  /**\n   * Establish connection with the server.\n   */\n  async connect() {\n    console.log(\"Connecting to electrum server...\")\n    return await this.electrumClient.connect(\"tbtc\", \"1.4.2\").catch((err: any) => {\n      throw new Error(`failed to connect: [${err}]`)\n    })\n  }\n\n  /**\n   * Disconnect from the server.\n   */\n  async close() {\n    console.log(\"Closing connection to electrum server...\")\n    this.electrumClient.close()\n  }\n\n  /**\n   * Get height of the latest mined block.\n   * @return {Promise<number>} Height of the last mined block.\n   */\n  async latestBlockHeight() {\n    // Get header of the latest mined block.\n    const header = await this.electrumClient\n        .blockchain_headers_subscribe()\n        .catch((err: any) => {\n          throw new Error(`failed to get block header: [${err}]`)\n        })\n    return header.height\n  }\n\n  /**\n   * Get details of the transaction.\n   * @param {string} txHash Hash of a transaction.\n   * @return {Promise<TransactionData>} Transaction details.\n   */\n  async getTransaction(txHash: any) {\n    const tx = await this.electrumClient\n        .blockchain_transaction_get(txHash, true)\n        .catch((err: any) => {\n          throw new Error(`failed to get transaction: [${err}]`)\n        })\n\n    return tx\n  }\n\n  /**\n   * Broadcast a transaction to the network.\n   * @param {string} rawTX The raw transaction as a hexadecimal string.\n   * @return {Promise<string>} The transaction hash as a hexadecimal string.\n   */\n  async broadcastTransaction(rawTX: any) {\n    const txHash = await this.electrumClient\n        .blockchain_transaction_broadcast(rawTX)\n        .catch((err: any) => {\n          throw new Error(`failed to broadcast transaction: [${err}]`)\n        })\n\n    return txHash\n  }\n\n  /**\n   * Data about an unspent transaction output. Docs mostly taken from\n   * https://electrumx.readthedocs.io/en/latest/protocol-methods.html .\n   *\n   * @typedef {object} UnspentOutputData\n   * @property {number} height The integer height of the block the transaction\n   *           was confirmed in. 0 if the transaction is in the mempool.\n   * @property {number} tx_pos The zero-based index of the output in the\n   *           containing transaction's list of outputs.\n   * @property {string} tx_hash The containing transaction's hash (or id) as an\n   *           unprefixed hexadecimal string.\n   * @property {number} value The value of the unspent output in satoshis.\n   */\n\n  /**\n   * Get unspent outputs sent to a script.\n   * @param {string} script ScriptPubKey in a hexadecimal format.\n   * @return {Promise<UnspentOutputData[]>} List of unspent outputs. It includes\n   *         transactions in the mempool.\n   */\n  async getUnspentToScript(script: any) {\n    const scriptHash = scriptToHash(script)\n\n    const listUnspent = await this.electrumClient\n        .blockchain_scripthash_listunspent(scriptHash)\n        .catch((err: any) => {\n          throw new Error(JSON.stringify(err))\n        })\n\n    return listUnspent\n  }\n\n  /**\n   * Get balance of a script.\n   *\n   * @param {string} script ScriptPubKey in a hexadecimal format.\n   *\n   * @return {Promise<{ confirmed: string, unconfirmed: string }>} Object with\n   *         the confirmed and unconfirmed BTC balance of the given script as\n   *         decimal strings.\n   */\n  async getBalanceOfScript(script: any) {\n    const scriptHash = scriptToHash(script)\n\n    const balance = await this.electrumClient\n        .blockchain_scripthash_getBalance(scriptHash)\n        .catch((err: any) => {\n          throw new Error(JSON.stringify(err))\n        })\n\n    return balance\n  }\n\n  /**\n   * @callback TransactionToScriptReceived\n   * @param {string?} status The updated status of the script. The status is an\n   *        unprefixed hexadecimal string computed according to the rules at\n   *        https://electrumx.readthedocs.io/en/latest/protocol-basics.html#status,\n   *        or null if there are no transactions to that script.\n   * @return {Promise<T | null>}\n   * @template T\n   */\n\n  /**\n   * Listens for transactions sent to a script until callback resolves to a\n   * non-`null` value. It includes transactions in the mempool. It passes\n   * the status of the transaction to the callback (see\n   * {@link TransactionToScriptReceived<T>}).\n   *\n   * @template T\n   * @param {string} script ScriptPubKey in a hexadecimal format.\n   * @param {TransactionToScriptReceived<T>} callback An async callback\n   *        function called when an existing transaction for the script is found\n   *        or a new transaction is sent to the script. If the transaction\n   *        returns non-`null`, the returned value is also returned from\n   *        `onTransactionToScript` and monitoring of the specified script is\n   *        discontinued.\n   * @return {Promise<T>} Value resolved by the callback.\n   */\n  async onTransactionToScript(script: any, callback: any) {\n    const scriptHash = scriptToHash(script)\n\n    // Check if transaction for script already exists.\n    const initialStatus = await this.electrumClient\n        .blockchain_scripthash_subscribe(scriptHash)\n        .catch((err: any) => {\n          throw new Error(`failed to subscribe: ${err}`)\n        })\n\n    // Invoke callback for the current status.\n    const result = await callback(initialStatus)\n    if (result) {\n      // TODO: We send request directly, because `electrumjs` library doesn't\n      // support `blockchain.scripthash.unsubscribe` method.\n      await this.electrumClient\n          .blockchain_scripthash_unsubscribe(scriptHash)\n          .catch((err: any) => {\n            throw new Error(`failed to unsubscribe: ${err}`)\n          })\n\n      return result\n    }\n\n    // If callback have not resolved wait for new transaction notifications.\n    return new Promise(async resolve => {\n      try {\n        const eventName = \"blockchain.scripthash.subscribe\"\n        const electrumClient = this.electrumClient\n\n        const listener = async function(/** @type {[string, string]} */ msg: any) {\n          const receivedScriptHash = msg[0]\n          const status = msg[1]\n\n          console.log(\n              `Received notification for script hash: [${receivedScriptHash}] with status: [${status}]`\n          )\n\n          if (receivedScriptHash == scriptHash) {\n            const result = await callback(status)\n            if (result) {\n              await electrumClient.subscribe.off(eventName, listener)\n\n              await electrumClient\n                  .blockchain_scripthash_unsubscribe(scriptHash)\n                  .catch((err: any) => {\n                    throw new Error(`failed to unsubscribe: ${err}`)\n                  })\n\n              return resolve(result)\n            }\n          }\n        }\n\n        this.electrumClient.subscribe.on(eventName, listener)\n      } catch (err) {\n        throw new Error(`failed listening for notification: ${err}`)\n      }\n    })\n  }\n\n  private handleNewBlock = (messages: NewBlockData[]) => {\n    for (const msg of messages) {\n      const height = msg.height\n      console.log(\n          `Received notification of a new block at height: [${height}]`\n      )\n      this.emit('block', msg);\n    }\n  }\n\n  // This will start listening to onBlock events if we have subscriptions to the onNewBlock event.\n  private startBlockListening() {\n    const eventName = \"blockchain.headers.subscribe\"\n    const listenerCount = this.listenerCount('block');\n    if (listenerCount == 0) {\n      try {\n        this.electrumClient.subscribe.on(eventName, this.handleNewBlock)\n      }\n      catch (err) {\n        throw new Error(`failed listening for notification: ${err}`)\n      }\n      console.log(`ElectrumClient: First \"block\" listener added, subscribing to server's ${eventName}`)\n    }\n  }\n\n  private stopBlockListening() {\n    const eventName = \"blockchain.headers.subscribe\"\n    const listenerCount = this.listenerCount('block');\n    if (listenerCount == 0) {\n      this.electrumClient.subscribe.off(eventName, this.handleNewBlock)\n      console.log(`ElectrumClient: No \"block\" listeners, unsubscribing from server's ${eventName}`)\n    }\n  }\n\n  /**\n   * Get merkle root hash for block.\n   * @param {number} blockHeight Block height.\n   * @return {Promise<Buffer>} Merkle root hash.\n   */\n  async getMerkleRoot(blockHeight: any) {\n    const header = await this.electrumClient\n        .blockchain_block_header(blockHeight)\n        .catch((err: any) => {\n          throw new Error(`failed to get block header: [${err}]`)\n        })\n\n    return Buffer.from(header, \"hex\").slice(36, 68)\n  }\n\n  /**\n   * Get concatenated chunk of block headers built on a starting block.\n   * @param {number} blockHeight Starting block height.\n   * @param {number} confirmations Number of confirmations (subsequent blocks)\n   * built on the starting block.\n   * @return {Promise<string>} Concatenation of block headers in a hexadecimal format.\n   */\n  async getHeadersChain(blockHeight: any, confirmations: any) {\n    const headersChain = await this.electrumClient\n        .blockchain_block_headers(blockHeight, confirmations + 1)\n        .catch((err: any) => {\n          throw new Error(`failed to get block headers: [${err}]`)\n        })\n    return headersChain.hex\n  }\n\n  /**\n   * Information about the merkle branch to a confirmed transaction.\n   *\n   * @typedef {object} TransactionMerkleBranch\n   * @property {number} block_height The height of the block the transaction was\n   *           confirmed in.\n   * @property {string[]} merkle A list of transaction hashes the current hash\n   *           is paired with, recursively, in order to trace up to obtain the\n   *           merkle root of the including block, deepest pairing first. Each\n   *           hash is an unprefixed hex string.\n   * @property {number} pos The 0-based index of the transaction's position in\n   *           the block.\n   */\n\n  /**\n   * Get proof of transaction inclusion in the block.\n   *\n   * @param {string} txHash Hash of a transaction.\n   * @param {number} blockHeight Height of the block where transaction was\n   *        confirmed.\n   * @return {Promise<TransactionMerkleBranch>} Transaction inclusion proof in\n   *         hexadecimal form.\n   */\n  async getTransactionMerkle(txHash: any, blockHeight: any) {\n    return /** @type {TransactionMerkleBranch} */ (await this.electrumClient\n        .blockchain_transaction_getMerkle(txHash, blockHeight)\n        .catch((err: any) => {\n          throw new Error(`failed to get transaction merkle: [${err}]`)\n        }))\n  }\n\n  /**\n   * Finds index of output in a transaction for a given address.\n   * @param {string} txHash Hash of a transaction.\n   * @param {string} address Bitcoin address for the output.\n   * @return {Promise<number>} Index of output in the transaction (0-indexed).\n   */\n  async findOutputForAddress(txHash: any, address: any) {\n    const tx = await this.getTransaction(txHash).catch((err: any) => {\n      throw new Error(`failed to get transaction: [${err}]`)\n    })\n\n    const outputs = tx.vout\n\n    for (let index = 0; index < outputs.length; index++) {\n      for (const a of outputs[index].scriptPubKey.addresses) {\n        if (a == address) {\n          return index\n        }\n      }\n    }\n\n    throw new Error(`output for address ${address} not found`)\n  }\n\n  /**\n   * Gets a history of all transactions the script is involved in.\n   * @param {string} script The script in raw hexadecimal format.\n   * @return {Promise<TransactionData[]>} A list of transactions.\n   */\n  async getTransactionsForScript(script: any) {\n    const scriptHash = scriptToHash(script)\n    /** @type {{ height: number, tx_hash: string }[]} */\n    const history = await this.electrumClient.blockchain_scripthash_getHistory(\n        scriptHash\n    )\n\n    // Get all transactions for script.\n    const transactions = await Promise.all(\n        history\n            .map((confirmedTx: any) => confirmedTx.tx_hash)\n            .map((txHash: any) => this.getTransaction(txHash))\n    )\n\n    return transactions\n  }\n}\n\n/**\n * Converts ScriptPubKey to a script hash specified by the [Electrum Protocol](https://electrumx.readthedocs.io/en/stable/protocol-basics.html#script-hashes).\n * @param {string} script ScriptPubKey in a hexadecimal format.\n * @return {string} Script hash as a hex string.\n */\nfunction scriptToHash(script: any) {\n  const scriptHash = digest(Buffer.from(script, \"hex\")).reverse()\n  return scriptHash.toString(\"hex\")\n}","import {css} from \"emotion\";\nimport React from \"react\";\n\nexport function Paper(props: {\n  children: any,\n  padding?: boolean,\n  style?: any\n}) {\n  return <div style={props.style} className={css`\n    background: #FFFFFF;\n    box-shadow: 0px 4px 8px rgba(20, 20, 20, 0.20);\n    border-radius: 4px;\n    padding: ${props?.padding ? '20px' : '0'}\n  `}>\n    {props.children}\n  </div>\n}\n","/**\n * React context that determines the current network (mainnet or testnet).\n */\nimport React, { useContext } from \"react\";\n\nexport enum Network {\n  ROPSTEN,\n  MAINNET\n}\n\nexport type NetworkContextType = {\n  network: Network\n}\nexport const NetworkContext = React.createContext<NetworkContextType>({\n  network: Network.MAINNET\n});\n\nexport function SetNetwork(props: {\n  network: Network\n  children: any\n}) {\n  return <NetworkContext.Provider value={{network: props.network}}>\n    {props.children}\n  </NetworkContext.Provider>\n}\n\nexport function useNetwork(): Network {\n  const context = useContext(NetworkContext);\n  return context.network;\n}\n\nexport function useIsRopsten(): boolean {\n  return useNetwork() == Network.ROPSTEN;\n}\n\nexport function useEtherscanDomain(): string {\n  const isRopsten = useIsRopsten();\n  return isRopsten ? 'ropsten.etherscan.io' : 'etherscan.io';\n}\n\nexport function useDAppDomain(): string {\n  const isRopsten = useIsRopsten();\n  return isRopsten ? 'dapp.test.tbtc.network' : 'dapp.tbtc.network';\n}\n\nexport function useBlockchainBaseUrl(): string {\n  const isRopsten = useIsRopsten();\n  return isRopsten ? 'https://www.blockchain.com/btc-testnet' : 'https://www.blockchain.com/btc';\n}\n","import * as React from \"react\"\n\nexport function ExternalLinkIcon(props: React.SVGProps<SVGSVGElement>) {\n  return (\n      <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 48 48\" fill={\"silver\"} {...props}>\n        <path d=\"M40.96 4.98a2 2 0 00-.22.02H28a2 2 0 100 4h8.172L22.586 22.586a2 2 0 102.828 2.828L39 11.828V20a2 2 0 104 0V7.246a2 2 0 00-2.04-2.266zM12.5 8C8.383 8 5 11.383 5 15.5v20c0 4.117 3.383 7.5 7.5 7.5h20c4.117 0 7.5-3.383 7.5-7.5V26a2 2 0 10-4 0v9.5c0 1.947-1.553 3.5-3.5 3.5h-20A3.483 3.483 0 019 35.5v-20c0-1.947 1.553-3.5 3.5-3.5H22a2 2 0 100-4h-9.5z\" />\n      </svg>\n  )\n}","export function isVendingMachine(address: string) {\n  return address?.toLowerCase() == getVendingMachineAddress().toLowerCase();\n}\n\nexport function getVendingMachineAddress() {\n  return '0x526c08E5532A9308b3fb33b7968eF78a5005d2AC';\n}\n\nexport function getTDTTokenAddress() {\n  return '0x10b66bd1e3b5a936b7f8dbc5976004311037cdf0';\n}\n\n// TODO: We just assume that if the owner is the vending machine, then the coins have been minted. this is very lazy and probably wrong.\n// Instead, the subgraph has check for mint events, or, for the tdtTotbtc() call.\nexport function hasDepositBeenUsedToMint(owner: string, state: string) {\n  return isVendingMachine(owner) && state == 'ACTIVE'\n}","import React, { useContext } from \"react\";\nimport {useQuery, useSubscription} from \"@apollo/client\";\nimport {OperationVariables} from \"@apollo/client/core\";\nimport {DocumentNode} from \"graphql\";\nimport {TypedDocumentNode} from \"@graphql-typed-document-node/core\";\nimport {QueryHookOptions, SubscriptionHookOptions} from \"@apollo/client/react/types/types\";\nimport update from 'immutability-helper';\nimport {useLocation} from \"react-router\";\nimport {FieldNode, OperationDefinitionNode} from \"graphql/language/ast\";\nimport { useMemo } from \"react\";\n\nexport type TimeTravelContextType = {\n  block: number|undefined,\n}\n\nexport const TimeTravelContext = React.createContext<TimeTravelContextType>({\n  block: undefined\n});\n\nexport function TimeTravelState(props: {\n  children: any\n}) {\n  const l = useLocation();\n  const p = new URLSearchParams(l.search);\n  const block = p.get(\"block\") ? parseInt(p.get(\"block\")!) : undefined;\n  return <TimeTravelContext.Provider value={{block}}>\n    {props.children}\n  </TimeTravelContext.Provider>\n}\n\nexport function useTimeTravelBlock(): number|null {\n  const context = useContext(TimeTravelContext);\n  return context.block ? context.block : null;\n}\n\nexport function useIsTimeTravel(): boolean {\n  const context = useContext(TimeTravelContext);\n  return !!context.block;\n}\n\n/**\n * TheGraph does not allow us to make the block-height argument optional - when given, it needs to have a\n * valid value. So we would have to write two versions of each query where we want to time travel.\n *\n * Instead, we use a helper to patch the query object to remove the `block` argument.\n *\n * This hook is a full replacement for `useQuery`, which will do all of this automatically - the input query\n * has to be set up with a block_Height parameter though.\n */\nexport function useQueryWithTimeTravel<TData = any, TVariables = OperationVariables>(query: DocumentNode | TypedDocumentNode<TData, TVariables>, options?: QueryHookOptions<TData, TVariables>) {\n  const block = useTimeTravelBlock();\n\n  let queryToUse = useMemo(() => {\n    if (block) {\n      return query;\n    }\n    else {\n      // Otherwise, we assume that the query defines a $block variable, and includes that $block in the filter.\n      // When then find that argument and remove it. We do not have to remove it from `query()` (only from the field).\n      // NB: We assume that the query to edit is always the first operation (i.e. fragments come after).\n\n      let toUse = query;\n      const num = (query.definitions[0] as any).selectionSet.selections.length;\n      for (let i=0; i<num; i++) {\n        // Find the argument we have to remove.\n        const argumentIdx = ((query.definitions[0] as OperationDefinitionNode).selectionSet.selections[i] as FieldNode).arguments?.findIndex(\n            argument => argument.name.value === 'block');\n        if (!argumentIdx) {\n          continue;\n        }\n\n        toUse = update(toUse as any, {\n          definitions: {\n            0: {\n              selectionSet: {\n                selections: {\n                  [i]: {\n                    arguments: {\n                      $unset: [argumentIdx.toString()]\n                    }\n                  }\n                }\n              }\n            }\n          }\n        });\n      }\n\n      return toUse;\n    }\n  }, [query, block]);\n\n  return useQuery(queryToUse, {\n    ...options,\n    variables: {\n      ...options?.variables,\n      block: block ? {number: block} : undefined\n    } as unknown as TVariables\n  });\n}\n\n\n/**\n * In time-travel mode, we generally do not want to do subscriptions, so this drop-in replacement of `useSubscription`\n * will disable itself automatically if time-travel is enabled.\n */\nexport function useTimeTravelSafeSubscription<TData = any, TVariables = OperationVariables>(subscription: DocumentNode | TypedDocumentNode<TData, TVariables>, options?: SubscriptionHookOptions<TData, TVariables>) {\n  const block = useTimeTravelBlock();\n\n  return useSubscription(subscription, {\n    ...options,\n    skip: !!block\n  });\n}","import {Link as RouterLink, LinkProps} from 'react-router-dom';\nimport React from \"react\";\nimport {useTimeTravelBlock} from \"../TimeTravel\";\n\nexport function Link(props: LinkProps) {\n  const {to, ...others} = props;\n  const block = useTimeTravelBlock();\n  const realTo = block ? to + \"?block=\" + block : to;\n  return <RouterLink {...others} to={realTo} />;\n}","import React from \"react\";\nimport {css} from \"emotion\";\nimport {ExternalLinkIcon} from \"./ExternalLinkIcon\";\nimport {isVendingMachine} from \"../utils/contracts\";\nimport {useBlockchainBaseUrl, useEtherscanDomain} from \"../NetworkContext\";\nimport { Link } from \"./Link\";\n\n\nexport function Address(props: {\n  address: string,\n  to?: string,\n  includeExternalIcon?: boolean,\n  long?: boolean,\n  children?: any\n}) {\n  const etherscan = useEtherscanDomain();\n  let knownAddress: string|undefined;\n  if (isVendingMachine(props.address)) {\n    knownAddress = 'Vending Machine'\n  }\n\n  return <Hash\n    hash={props.address}\n    to={props.to || `https://${etherscan}/address/${props.address}`}\n    includeExternalIcon={props.includeExternalIcon}\n    children={props.children || knownAddress}\n    long={props.long}\n  />\n}\n\n\nexport function BitcoinAddress(props: {\n  address: string\n}) {\n  const baseUrl = useBlockchainBaseUrl();\n  return <Address address={props.address} to={`${baseUrl}/address/${props.address}`} />;\n}\n\n\nexport function Transaction(props: {\n  tx: string,\n  to?: string,\n  includeExternalIcon?: boolean,\n  children?: any\n}) {\n  const etherscan = useEtherscanDomain();\n  return <Hash\n    hash={props.tx}\n    to={props.to || `https://${etherscan}/tx/${props.tx}`}\n    includeExternalIcon={props.includeExternalIcon}\n    children={props.children}\n  />\n}\n\n\nexport function Hash(props: {\n  hash: string,\n  to?: string,\n  includeExternalIcon?: boolean,\n  long?: boolean,\n  children?: any\n}) {\n  // #tokentxnsErc721\n  if (!props.hash) {\n    return null;\n  }\n\n  let linkProps: any = {};\n\n  let C: any;\n  let isLink = false;\n  if (!props.to) {\n    C = 'span';\n  }\n  else if (!(props.to).startsWith('http')) {\n    C = Link;\n    isLink = true;\n    linkProps.to = props.to;\n  } else {\n    C = 'a';\n    isLink = true;\n    linkProps = {\n      ...linkProps,\n      href: props.to\n    }\n  }\n\n  let longAddress = props.hash;\n  let hasHexPrefix = longAddress?.indexOf('0x') == 0;\n  if (hasHexPrefix) {\n    longAddress = longAddress.slice(2)\n  }\n  let shortAddress = longAddress.slice(0,4) + \"\" + longAddress.slice(longAddress.length-4);\n\n  let children;\n  if (props.children)  {\n    children = props.children;\n  } else {\n    children = <>\n      {hasHexPrefix ? <span style={{color: isLink ? '#bda8e9' : undefined}}>0x</span> : null}\n      {props.long ? longAddress : shortAddress}\n    </>;\n  }\n\n  const el = React.createElement(C, linkProps, <span>\n    {children}\n\n    {props.includeExternalIcon ? <span className={css`\n        font-size: 0.8em;\n        padding-left: 0.2em;\n       `}>\n      <ExternalLinkIcon />\n    </span> : null}\n  </span>)\n\n  return <span>\n    {el}\n  </span>\n}","import * as React from \"react\"\nimport Tippy from \"@tippyjs/react\";\n\nconst InfoIcon = React.forwardRef((props: React.SVGProps<SVGSVGElement>, ref) => {\n  return (\n      <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 48 48\" {...props} ref={ref as any}>\n        <path d=\"M24 3.998c-11.028 0-20 8.972-20 20 0 3.275.863 6.337 2.262 9.066l-2.168 7.762c-.505 1.804 1.278 3.587 3.082 3.082l7.767-2.168c2.728 1.396 5.785 2.258 9.057 2.258 11.028 0 20-8.972 20-20s-8.972-20-20-20zm0 3c9.406 0 17 7.594 17 17 0 9.406-7.594 17-17 17-3.002 0-5.81-.78-8.258-2.144a1.5 1.5 0 00-1.133-.135l-7.386 2.06 2.062-7.383a1.5 1.5 0 00-.135-1.134A16.89 16.89 0 017 23.998c0-9.406 7.594-17 17-17zM24 13c-3.296 0-6 2.704-6 6a1.5 1.5 0 103 0c0-1.674 1.326-3 3-3s3 1.326 3 3c0 1.586-.643 2.053-1.773 3.11-1.13 1.056-2.727 2.697-2.727 5.39a1.5 1.5 0 103 0c0-1.66.654-2.152 1.773-3.2C28.393 23.255 30 21.65 30 19c0-3.296-2.704-6-6-6zm0 18a2 2 0 000 4 2 2 0 000-4z\" />\n      </svg>\n  )\n});\n\nexport function InfoTooltip(props: {\n  children: any,\n  size?: number,\n  // If used with a singleton\n  singleton?: any\n}) {\n  const size = props.size ? `${props.size}em` : '1em';\n  return <Tippy content={props.children} singleton={props.singleton}>\n    <InfoIcon width={size} height={size} />\n  </Tippy>\n}\n","import {css} from \"emotion\";\nimport React, {useCallback, useState} from \"react\";\nimport classnames from 'classnames';\nimport {Column, ColumnInstance} from \"react-table\";\nimport {InfoTooltip} from \"./InfoTooltip\";\n\nexport function Table(props: {\n  children?: any,\n  style?: any,\n  className?: string,\n}) {\n  return <table\n      style={props.style}\n      className={classnames(css`\n        border-collapse: collapse;\n        \n        & td, th {\n          text-align: left;\n        }\n        & td {\n          border-bottom: 1px solid #f5f5f5;\n        }\n        & tr:hover td {\n          background-color: #f5f5f5;          \n        }\n      `, props.className)}\n  >\n    {props.children}\n  </table>\n}\n\n\n/**\n * Defines a sort state variable.\n */\nexport function useSort(defaultValue: string) {\n  const [field, setField] = useState(defaultValue);\n  const [direction, setDirection] = useState<\"asc\"|\"desc\">('desc');\n  return {\n    column: field,\n    setColumn: setField,\n    direction,\n    setDirection\n  }\n}\nexport type SortState = ReturnType<typeof useSort>;\n\n\nexport function SortableHeader(props: {\n  children: any,\n  fieldId: string,\n  state: SortState\n}) {\n  const isCurrent = props.fieldId == props.state.column;\n\n  const handleClick = useCallback((e: any) => {\n    e.preventDefault();\n    if (props.state.column === props.fieldId) {\n      props.state.setDirection(props.state.direction == 'desc' ? \"asc\" : \"desc\")\n    } else {\n      props.state.setColumn(props.fieldId);\n    }\n  }, [props.state, props.fieldId]);\n\n  return <div onClick={handleClick} style={{cursor: 'pointer'}}>\n    {isCurrent\n        ? <span>\n          {props.state.direction == 'desc' ? \"\" : \"\"}\n          </span>\n        : null\n    }\n    {props.children}\n  </div>\n}\n\n\n/**\n * A header rendered with react-table (which has built-in sort features).\n */\nexport function RTHeader(props: {\n  children: any,\n  column: ColumnInstance,\n  sortState: SortState\n}) {\n  const handleClick = useCallback((e: any) => {\n    e.preventDefault();\n    props.sortState.setColumn(props.column.id);\n    props.sortState.setDirection(props.column.isSortedDesc ? \"asc\" : \"desc\");\n  }, [props.column, props.sortState]);\n\n  const c = (props.column as any);\n\n  return <div\n    onClick={c.canSort ? handleClick : undefined}\n    style={{cursor: c.canSort ? 'pointer' : undefined}}\n  >\n    {props.column.canSort ? (\n        props.column.isSorted\n          ? <span>\n            {props.column.isSortedDesc ? \"\" : \"\"}\n            </span>\n          : null)\n        : null\n    }\n    {c.label} {c.tooltip ? <InfoTooltip>{c.tooltip}</InfoTooltip> : null}\n  </div>\n}","/**\n * We use a special subgraph that gives us access to the the on-chain price feed.\n */\n\nimport {useMemo} from 'react';\nimport {gql, useQuery, useSubscription} from \"@apollo/client\";\nimport {useTimeTravelBlock} from \"../TimeTravel\";\n\n\nconst WATCH_QUERY = gql`\n  subscription WatchPrice {\n    priceFeed(id: \"0x81a679f98b63b3ddf2f17cb5619f4d6775b3c5ed\") {\n      val,\n      timestamp,\n      blockNumber,\n      transactionHash\n    }\n  }\n`;\n\nconst QUERY_FOR_BLOCK = gql`\n    query GetBlockPrice($block: Block_height) {\n        priceFeed(id: \"0x81a679f98b63b3ddf2f17cb5619f4d6775b3c5ed\", block: $block) {\n            val,\n            timestamp,\n            blockNumber,\n            transactionHash\n        }\n    }\n`;\n\n\nexport type PriceData = {\n  val: number,  // btcPerEth\n  satPerWei: number,\n  weiPerSat: number,\n\n  timestamp: string,\n  blockNumber: number,\n  transactionHash: string\n}\n\n/**\n * This is the price of 1 ETH in BTC.\n */\nexport function usePriceFeed() {\n  const timeTravelBlock = useTimeTravelBlock();\n  const sResult = useSubscription(WATCH_QUERY, {skip: !!timeTravelBlock});\n  const qResult = useQuery(QUERY_FOR_BLOCK, {skip: !timeTravelBlock, variables: {block: {number: timeTravelBlock}}});\n\n  const result = timeTravelBlock ? qResult : sResult;\n  const {data, loading, error} = result;\n\n  return useMemo<PriceData>(() => {\n    if (!data) { return null; }\n    const price = data.priceFeed;\n    if (!data.priceFeed) { // i.e. when block too early\n      return null;\n    }\n\n    const convertedPrices = convertPriceFeedVal(price.val);\n\n    return {\n      ...price,\n      ...convertedPrices,\n      val: convertedPrices.btcPerEth,\n    };\n  }, [data]);\n}\n\n// Convert the rate given in the price feed (price of 1 ETH in BTC) into other useful units.\nexport function convertPriceFeedVal(val: string) {\n  // Given with 18 decimal places\n  const btcPerEth = parseInt(val) / 10 ** 18;\n  const satPerWei = btcPerEth * 100000000 * 0.000000000000000001;\n  const weiPerSat = 1 / satPerWei;\n\n  return {\n    weiPerSat,\n    satPerWei,\n    btcPerEth\n  }\n}","import {css} from \"emotion\";\nimport React from \"react\";\nimport {InfoTooltip} from \"./InfoTooltip\";\n\nexport function Box(props: {\n  label: string,\n  tooltip?: string,\n  children: any,\n  style?: any\n}) {\n  return (\n    <div style={props.style} className={css`\n      font-size: 35px;\n      color: #0A0806;\n      \n      font-feature-settings: 'zero' on;\n    `}>\n      <div className={css`                         \n        font-size: 16px;\n      `}>\n        {props.label} {props.tooltip ? <InfoTooltip>{props.tooltip}</InfoTooltip> : null}\n      </div>\n      <div>\n        {props.children}\n      </div>\n    </div>\n  )\n}","export function getWeiAsEth(weis: number): number {\n  return weis * 0.000000000000000001;\n}\n\nexport function getWeiAsGwei(weis: number): number {\n  return weis / 1000_000_000;\n\n}","// This really needs a better name, but we mean to convert the TBTC ERC20 decials here.\nexport function getSatoshiesAsTBTC(satoshis: number): number {\n  return satoshis * 0.000000000000000001;\n}","import {DateTime, Duration} from \"luxon\";\nimport React from \"react\";\n\nexport function dateTimeFrom(time: string|number|DateTime) {\n  if (time instanceof DateTime) {\n    return time;\n  }\n  return DateTime.fromSeconds(typeof time === 'string' ? parseInt(time) : time);\n}\n\nexport function TimeToNow(props: {\n  time: string|number\n}) {\n  if (!props.time) {\n    return null;\n  }\n  const dateTime = dateTimeFrom(props.time);\n\n  // toRelative(): always contains a single unit, the options only allow you to switch to unrounded (\"1.3 days\"),\n  // You can define a padding, but this does seem to only work right if your padding matches the time, i.e. you\n  // have to know you are dealing with \"months ago\", for you to pad up to 10 days, say.\n  const relString = dateTime.toRelative()\n\n  // Or, we can use diffNow?\n  // const diff = dateTime.diffNow(['days', 'hours', 'minutes', 'months', 'years'])\n  // console.log(diff)\n\n  return <span title={dateTime.toLocaleString(DateTime.DATETIME_FULL)}>\n    {relString}\n  </span>\n}\n\nexport function formatSeconds(seconds: number) {\n  if (seconds < 120) {\n    return Duration.fromObject({seconds }).toFormat(\"s's'\")\n  }\n  else if (seconds < 3600 + 1800) {\n    return Duration.fromObject({seconds }).toFormat(\"m'm' s's'\")\n  }\n  else if (seconds < (3600 * 24 * 1.5)) {\n    return Duration.fromObject({seconds }).toFormat(\"h'h' m'm'\")\n  }\n  else if (seconds < (3600 * 24 * 265)) {\n    return Duration.fromObject({seconds }).toFormat(\"d'd 'h'h'\")\n  }\n  else {\n    return Duration.fromObject({seconds }).toFormat(\"y'y 'd'd'\")\n  }\n}\n\n\nexport function FormattedTime(props: {\n  time: string|number|DateTime,\n  format: 'full'|'long'|'simple'|'day-full'\n}) {\n  const dateTime = dateTimeFrom(props.time);\n\n  const longFormat = { weekday: 'short', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' };\n  let formatOpts = {\n    'full': { weekday: 'short', month: 'short', year: 'numeric', day: '2-digit', hour: '2-digit', minute: '2-digit' },\n    'long': longFormat,\n    'simple': { month: 'short', day: '2-digit' },\n    // Precision=date, show in which year\n    'day-full': { month: 'short', day: '2-digit', year: 'numeric' }\n  }[props.format];\n\n  const tooltip = props.format === 'long' ? \"\" : dateTime.toLocaleString(longFormat);\n  return <span title={tooltip}>\n    {dateTime.toLocaleString(formatOpts)}\n  </span>\n}\nFormattedTime.defaultProps = {\n  format: 'long'\n};\n\n\nexport function TimeBetween(props: {\n  earlier: string|number\n  later: string|number\n}) {\n  if (!props.earlier || !props.later) {\n    return null;\n  }\n  const earlier = dateTimeFrom(props.earlier);\n  const later = dateTimeFrom(props.later);\n\n  // Or, we can use diffNow?\n  // const diff = dateTime.diffNow(['days', 'hours', 'minutes', 'months', 'years'])\n  const diff = later.diff(earlier, ['seconds'])\n\n  // <Gray>s</Gray>\n  return <span title={later.toLocaleString(DateTime.DATETIME_FULL)}>\n    {formatSeconds(diff.seconds)}\n  </span>\n}\n\nfunction Gray(props: {children: any}) {\n  return <span style={{color: 'gray'}}>{props.children}</span>\n}","import {css} from \"emotion\";\nimport React from \"react\";\n\nexport function HeaderBoxes(props: {\n  children: any,\n  style?: any\n}) {\n  return <div style={props.style} className={css`\n    display: flex;\n    flex-direction: row;\n    & > * {\n      margin-right: 40px;\n    }\n    & > :last-child {\n      margin-right: 0px;\n    }\n  `}>\n    {props.children}\n  </div>\n}","import {css} from \"emotion\";\nimport React from \"react\";\n\nexport function PageHeader(props: {\n  label: any,\n  subtitle?: any,\n  buttons?: any,\n  children?: any\n}) {\n  return <div\n    style={{marginBottom: '20px'}}\n    className={css`\n      display: flex;\n      flex-direction: row;         \n   `}\n  >\n    <div className={css`\n      display: flex;\n      flex-direction: column;\n      \n      align-self: flex-start;\n      flex: 1;         \n   `}>\n      <div className={css`        \n        display: flex;\n        flex-direction: row;\n        align-items: center;         \n     `}>\n        <h1\n          className={css`\n            margin: 0px;                             \n         `}\n        >\n          {props.label}\n        </h1>\n\n        <div className={css`\n          margin-left: 15px;\n        `}>\n          {props.buttons}\n        </div>\n      </div>\n\n      <div style={{color: 'gray'}}>\n        {props.subtitle}\n      </div>\n    </div>\n\n    {props.children}\n  </div>\n}","import React from \"react\";\nimport {css} from \"emotion\";\n\n\nconst skeletonLineStyle = css`\n  width: 140px;\n  height: 1em;\n  border-radius: 3px;\n  background-color: #eee;\n  background-image: linear-gradient(90deg, #eee 0px, #e8e8e8 40px, #eee 80px);\n  background-size: 600px;\n  animation: shine-lines 1.6s infinite linear;\n  \n  @keyframes shine-lines {\n    0% {\n      background-position: -100px;\n    }\n    40%, 100% {\n      background-position: 140px;\n    }\n  }\n`;\n\nconst skeletonAvatarStyle =`\n  width: 52px;\n  height: 52px;\n  background-color: #ccc;\n  border-radius: 25%;\n  margin: 8px;\n  background-image: linear-gradient(90deg, #eee 0px, #e8e8e8 40px, #eee 80px);\n  background-size: 600px;\n  animation: shine-avatar 1.6s infinite linear;\n\n@keyframes shine-avatar {\n  0% {\n    background-position: -32px;\n  }\n  40%, 100% {\n    background-position: 208px;\n  }\n}\n\n`;\n\n\nexport function SkeletonWord(props: {\n\n}) {\n  return <div className={skeletonLineStyle} style={{width: '140px'}} />;\n}\n\n\nexport function SkeletonTableRow(props: {\n  columns: number\n}) {\n  return <tr>\n    {Array(props.columns).fill(1).map((_, idx) => {\n      return <td key={idx}>\n        <div className={skeletonLineStyle} />\n      </td>;\n    })}\n  </tr>\n}","const percentFormatter = new Intl.NumberFormat(\"en-US\", {\n  style: 'percent',\n  maximumFractionDigits: 2\n});\n\nconst numberFormatter = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 2,\n});\n\nexport function formatNumber(value: number|string) {\n  return numberFormatter.format(typeof value === 'string' ? parseFloat(value): value);\n}\n\nexport function formatPercentage(value: number|string) {\n  return percentFormatter.format(typeof value === 'string' ? parseFloat(value): value);\n}","import React from \"react\";\n\nexport function BTCTag() {\n  return <CurrencyTag currency={\"BTC\"} />;\n}\n\nexport function ETHTag(props: {\n  symbol?: boolean\n}) {\n  return <CurrencyTag currency={props.symbol ? \"\" : \"ETH\"} />;\n}\n\nexport function KeepTag() {\n  return <CurrencyTag currency={\"KEEP\"} />;\n}\n\nexport function GweiTag() {\n  return <CurrencyTag currency={\"GWEI\"} />;\n}\n\nexport function CurrencyTag(props: {\n  currency: string\n}) {\n  return <span style={{color: 'gray', fontSize: '0.8em'}}>{props.currency}</span>;\n}","import {EventEmitter} from \"events\";\nimport {useEffect, useState} from \"react\";\n\nconst fetcher: {\n  events: EventEmitter,\n  prices: null|CoinPrices,\n  handle?: any\n} = {\n  prices: null,\n  events: new EventEmitter()\n};\n\nfunction setupInterval() {\n  const get = async () => {\n    const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin%2Cethereum%2Ckeep-network&vs_currencies=usd')\n    const data = await response.json();\n    fetcher.prices = {\n      bitcoin: data.bitcoin.usd,\n      ethereum: data.ethereum.usd,\n      keep: data['keep-network'].usd\n    };\n    fetcher.events.emit('update');\n  }\n  fetcher.handle = setInterval(async () => {\n    get();\n  }, 20000);\n  get();\n}\n\nsetupInterval();\n\nexport function useCoinPrices(): CoinPrices {\n  const [counter, setCounter] = useState(0);\n  useEffect(() => {\n    const handleUpdate = () => {\n      setCounter(x => x+1);\n    };\n    fetcher.events.on('update', handleUpdate);\n    return () => {\n      fetcher.events.off('update', handleUpdate);\n    }\n  }, [])\n  return fetcher.prices || {};\n}\n\nexport type CoinPrices = {\n  ethereum?: number,\n  bitcoin?: number,\n  keep?: number\n}","import React, {useMemo} from \"react\";\n\nexport function DollarValue(props: {\n  dollar: number,\n  showCents?: boolean\n}) {\n  const formatter = useMemo(() => {\n    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0, minimumFractionDigits: 0 });\n  }, []);\n\n  return <>{formatter.format(props.dollar)}</>;\n}\n","import {gql, useQuery} from \"@apollo/client\";\nimport React from \"react\";\nimport {Paper} from \"../design-system/Paper\";\nimport {css} from \"emotion\";\nimport { Address } from \"../components/Address\";\nimport {ExternalLinkIcon} from \"../components/ExternalLinkIcon\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport {Helmet} from \"react-helmet\";\nimport {SortableHeader, SortState, Table, useSort} from \"../components/Table\";\nimport {usePriceFeed} from \"../components/PriceFeed\";\nimport {Box} from \"../components/Box\";\nimport {GetOperatorsQuery} from \"../generated/graphql\";\nimport {useEtherscanDomain} from \"../NetworkContext\";\nimport {getWeiAsEth} from \"../utils/getWeiAsEth\";\nimport {getSatoshiesAsTBTC} from \"../utils/getSatoshisAsTBTC\";\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {FormattedTime, TimeToNow} from \"../components/FormattedTime\";\nimport {HeaderBoxes} from \"../components/HeaderBoxes\";\nimport {PageHeader} from \"../components/PageHeader\";\nimport {SkeletonTableRow} from \"../components/SkeletonLoader\";\nimport {formatPercentage} from \"../utils/formatNumber\";\nimport {ETHTag} from \"../components/CurrencyTags\";\nimport {useCoinPrices} from \"../utils/useCoinPrices\";\nimport {DollarValue} from \"../components/DollarValue\";\n\nconst OPERATOR_QUERY = gql`\n    query GetOperators(\n        $orderBy: Operator_orderBy,\n        $direction: OrderDirection,\n        $block: Block_height\n    ) {\n        operators(first: 1000, orderBy: $orderBy, orderDirection: $direction, block: $block) {\n            id,\n            address,\n            bonded,\n            stakedAt,\n            unboundAvailable,\n            totalKeepCount,\n            activeKeepCount,\n            stakedAmount,\n            totalFaultCount,\n            attributableFaultCount,\n            totalTBTCRewards,\n            totalETHRewards,\n            randomBeaconOperatorAuthorized,\n            bondedECDSAKeepFactoryAuthorized,\n            tbtcSystemSortitionPoolAuthorized,\n            stakedropRewardWeight\n        },\n        stats: statsRecord(id: \"current\", block: $block) {\n            availableToBeBonded,\n            totalBonded\n        },\n        status: statusRecord(id: \"current\", block: $block) {\n            totalRewardWeight\n        }\n    }\n`;\n\n\nexport function Operators() {\n  const sortState = useSort(\"activeKeepCount\");\n  const rates = useCoinPrices()\n  const { loading, error, data } = useQueryWithTimeTravel<GetOperatorsQuery>(OPERATOR_QUERY, {\n    variables: {\n      orderBy: sortState.column,\n      direction: sortState.direction\n    }\n  });\n  const price: any = usePriceFeed();\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  const remainingCapacityBTC = price?.val ? parseFloat(data?.stats?.availableToBeBonded) / 1.5 * price.val : null;\n  const totalETH = parseInt(data?.stats?.totalBonded) + parseInt(data?.stats?.availableToBeBonded);\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Operators</title>\n    </Helmet>\n    <PageHeader label={\"Operators\"}>\n      {data?.stats ? <HeaderBoxes>\n        <Box\n            label={\"total collateral locked\"}\n            tooltip={\"The amount of ETH collateral in the system (bonded + available for new deposits)\"}\n        >\n          <div>\n            <ETHTag symbol /> {formatterSimple.format(totalETH)}\n            {rates?.ethereum ? <div style={{fontSize: '20px', color: 'gray'}}>\n              <DollarValue dollar={rates.ethereum * totalETH} />\n            </div> : null}\n          </div>\n        </Box>\n        <Box\n            label={\"collateral bonded\"}\n            tooltip={\"The amount of collateral currently in use backing active deposits.\"}\n        >\n          <div>\n            <ETHTag symbol /> {formatterSimple.format(data!.stats!.totalBonded)}</div>\n        </Box>\n        <Box\n            label={\"free collateral\"}\n            tooltip={`The amount of collateral put up by signers still available for new deposits. BTC value is based on a 150% collateralization ratio.`}\n        >\n          <div>\n            <ETHTag symbol /> {formatterSimple.format(data!.stats!.availableToBeBonded)}</div>\n            {remainingCapacityBTC !== null ? <div style={{fontSize: '20px', color: 'gray'}}>\n              capacity ~{formatter.format(remainingCapacityBTC)} BTC\n            </div> : null}\n        </Box>\n      </HeaderBoxes> : null}\n    </PageHeader>\n    <Paper padding>\n      <OperatorsTable data={data} sortState={sortState} loading={loading} />\n    </Paper>\n  </div>\n}\n\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 2\n});\n\nconst formatterSimple = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 0\n});\n\nconst formatterBTC = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 6\n});\n\nexport function OperatorsTable(props: {\n  data: any,\n  loading?: boolean,\n  sortState: SortState,\n}) {\n  const {data} = props;\n  const etherscan = useEtherscanDomain();\n  const price = usePriceFeed();\n\n  return <Table\n      style={{width: '100%'}}>\n    <thead>\n    <tr>\n      <th>Address</th>\n      <th>\n        <SortableHeader fieldId={\"activeKeepCount\"} state={props.sortState}>\n          # Keeps <InfoTooltip>Number of keeps/deposits this operator is securing.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>      \n        <SortableHeader fieldId={\"bonded\"} state={props.sortState}>\n          Amount Bonded <InfoTooltip>Collateral backing active deposits.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"unboundAvailable\"} state={props.sortState}>\n          Amount Available\n          <InfoTooltip>\n            Collateral available for further deposits. The BTC number indicates the lot size this amount\n            of ETH is able to support.\n          </InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"stakedAmount\"} state={props.sortState}>\n          Amount Staked <InfoTooltip>The stake will be seized in case of fraud.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"totalTBTCRewards\"} state={props.sortState}>\n          BTC Earnings <InfoTooltip>The BTC fees earned by this operator.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"totalETHRewards\"} state={props.sortState}>\n          ETH Earnings <InfoTooltip>The ETH fees earned by this operator.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"totalFaultCount\"} state={props.sortState}>\n          Faults <InfoTooltip>How often this operator was involved in a signing group with improper behaviour. If two numbers, the first one counts how often this operator can be blamed for the fault.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"stakedAt\"} state={props.sortState}>\n          Staked At <InfoTooltip>The date this operator joined based on having stake delegated to it.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"stakedropRewardWeight\"} state={props.sortState}>\n          Reward Share <InfoTooltip>Share of Stakedrop rewards going to this operator.</InfoTooltip>\n        </SortableHeader>\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    {props.loading ? <SkeletonTableRow columns={10} /> : null}\n    {data?.operators.map((member: any) => {\n      const unbound = parseFloat(member.unboundAvailable);\n      const total = (unbound + parseFloat(member.bonded));\n      const bonded = parseFloat(member.bonded);\n      const capacityBTC = price?.val ? (unbound / 1.5 * 3) * price.val : null;\n\n      return  <tr key={member.id}>\n        <td>\n          <Address address={member.address} to={`/operator/${member.address}`} />\n          <a title={\"Open on Etherscan\"} href={`https://${etherscan}/address/${member.address}`} className={css`\n                font-size: 0.8em;\n                padding-left: 0.2em;\n               `}>\n            <ExternalLinkIcon />\n          </a>\n        </td>\n        <td>{member.activeKeepCount}<span style={{color: 'gray', fontSize: '0.8em'}}> / {member.totalKeepCount}</span></td>\n        <td>\n          <span style={{color: 'gray', fontSize: '0.8em'}}>ETH</span> {formatterSimple.format(bonded)}\n          {\" \"}\n          {total > 0 ? <span style={{color: 'gray', fontSize: '0.8em'}}>\n            ({formatterSimple.format(bonded / total * 100)}%)\n          </span> : null}\n        </td>\n        <td>\n          <span style={{color: 'gray', fontSize: '0.8em'}}>ETH</span> {formatterSimple.format(unbound)}\n          {\" \"}\n          {(capacityBTC != null && unbound) ? <span style={{color: 'gray', fontSize: '0.8em'}}>\n            ~{formatter.format(capacityBTC)} BTC\n          </span> : null}\n        </td>\n        <td>\n          <span style={{color: 'gray', fontSize: '0.8em'}}>KEEP</span> {formatterSimple.format(member.stakedAmount)}\n        </td>\n        <td>\n          <span style={{color: 'gray', fontSize: '0.8em'}}>TBTC</span> {formatterBTC.format(getSatoshiesAsTBTC(member.totalTBTCRewards))}\n        </td>\n        <td>\n          <span style={{color: 'gray', fontSize: '0.8em'}}>ETH</span> {formatter.format(getWeiAsEth(member.totalETHRewards))}\n        </td>\n        <td>\n          {member.attributableFaultCount > 0 ? <>\n            {member.attributableFaultCount} / </> : null}\n          {member.totalFaultCount || \"\"}\n        </td>\n        <td>\n          <TimeToNow time={member.stakedAt} />\n        </td>\n        <td>\n          {formatPercentage(parseFloat(member.stakedropRewardWeight) / parseFloat(data.status!.totalRewardWeight))}\n        </td>\n      </tr>\n    })}\n    </tbody>\n  </Table>\n}\n","export function getSatoshisAsBitcoin(satoshis: number): number {\n  return satoshis / 100000000;\n}","import {useEffect, useRef} from \"react\";\n\n\nexport const useInterval = (callback: any, delay: number|null) => {\n  const savedCallback = useRef<any>();\n\n  useEffect(\n      () => {\n        savedCallback.current = callback;\n      },\n      [callback]\n  );\n\n  useEffect(\n      () => {\n        const handler = (...args: any) => savedCallback.current?.(...args);\n\n        if (delay !== null) {\n          const id = setInterval(handler, delay);\n          return () => clearInterval(id);\n        }\n      },\n      [delay]\n  );\n};","import { gql } from '@apollo/client';\nimport React, {useState} from \"react\";\nimport {NiceStateLabelFragment} from \"../generated/graphql\";\nimport {dateTimeFrom} from \"../components/FormattedTime\";\nimport {useInterval} from \"./useInterval\";\nimport {useIsTimeTravel} from \"../TimeTravel\";\n\nexport const NiceStateLabel = gql`\n    fragment NiceStateLabel on Deposit {\n        currentState,\n        bondedECDSAKeep {\n            publicKey\n        },\n        depositSetup {\n            failureReason\n        },\n        currentStateTimesOutAt,\n        updatedAt\n    }\n`;\n\n/**\n * Percentage of the current phase of the deposit that has passed, for example, 50% until AWAITING_BTC_FUNDING\n * times out. Returns `undefined` if the current state does not expire.\n */\nexport function getTimeRemaining(deposit: NiceStateLabelFragment) {\n  if (!deposit.currentStateTimesOutAt) { return; }\n\n  const updatedAt = dateTimeFrom(deposit.updatedAt);\n  const currentStateTimesOutAt = dateTimeFrom(deposit.currentStateTimesOutAt);\n\n  const {seconds: totalSeconds} = currentStateTimesOutAt.diff(updatedAt, ['seconds']);\n  const {seconds: secondsNow} = currentStateTimesOutAt.diffNow(['seconds']);\n  const percentage = Math.min(1 - (secondsNow / totalSeconds), 1);\n\n  return {remaining: secondsNow, total: totalSeconds, percentage};\n}\n\n/**\n * Self-updating hook version of `getTimeRemaining()`.\n *\n * TODO: If we have a lot of \"avaiting funding proof\", this gets slow. We should use a shared, global timer.\n * Or, use https://reactjs.org/docs/concurrent-mode-adoption.html\n */\nexport function useTimeRemaining(deposit: NiceStateLabelFragment, interval?: number) {\n  const isTimeTravel = useIsTimeTravel();\n  const [value, setValue] = useState(isTimeTravel ? null : getTimeRemaining(deposit));\n  useInterval(() => {\n    setValue(getTimeRemaining(deposit));\n  }, (isTimeTravel ? null : (interval ?? 0.8) * 1000));\n  return value;\n}\n\n\nexport function getNiceStateLabel(deposit: NiceStateLabelFragment) {\n  const {currentState: state, depositSetup} = deposit;\n  const failedSetupReason = depositSetup?.failureReason || \"\";\n\n  if (state == 'AWAITING_SIGNER_SETUP' && deposit.bondedECDSAKeep?.publicKey) {\n    return \"Awaiting Funding\";\n  }\n\n  if (state == 'FAILED_SETUP' && failedSetupReason) {\n    return ({\n      'FUNDING_TIMEOUT': 'Funding Timeout',\n      'SIGNER_SETUP_FAILED_DEPOSITOR': 'Funding Timeout',\n      'SIGNER_SETUP_FAILED': 'Signer Setup Failed',\n    } as any)[failedSetupReason] || \"Setup Failed\";\n  }\n\n  return ({\n    'AWAITING_SIGNER_SETUP': \"Awaiting Signer Setup\",\n    'AWAITING_BTC_FUNDING_PROOF': \"Awaiting Funding Proof\",\n    'AWAITING_WITHDRAWAL_SIGNATURE': 'Awaiting Withdrawal Signature',\n    'AWAITING_WITHDRAWAL_PROOF': 'Awaiting Withdrawal Proof',\n    'REDEEMED': 'Redeemed',\n    'ACTIVE': \"Active\",\n    'COURTESY_CALL': \"Courtesy Called\",\n    'FAILED_SETUP': \"Setup Failed\",\n    \"LIQUIDATED\": \"Liquidated\",\n    \"LIQUIDATION_IN_PROGRESS\": \"Liquidation In Progress\"\n  } as any)[state || \"\"] || state;\n}\n\nexport function getStateBoxStyle(state: string) {\n  let inProgress = '#ffb74d';\n  let failed = '#F44336';\n  let redeemed = 'silver';\n  let active = '#4caf50';\n\n  const color = ({\n    'AWAITING_SIGNER_SETUP': inProgress,\n    'AWAITING_BTC_FUNDING_PROOF': inProgress,\n    'AWAITING_WITHDRAWAL_SIGNATURE': inProgress,\n    'AWAITING_WITHDRAWAL_PROOF': inProgress,\n    'REDEEMED': redeemed,\n    'ACTIVE': active,\n    'COURTESY_CALL': '#ff9730', // #dfc51df7\n    'FAILED_SETUP': 'transparent',\n    \"LIQUIDATED\": failed,\n    \"LIQUIDATION_IN_PROGRESS\": '#ffcdd2'\n  } as any)[state] || \"transparent\";\n\n  const borderColor = ({\n    'FAILED_SETUP': failed,\n    \"LIQUIDATION_IN_PROGRESS\": failed\n  } as any)[state] || color;\n\n  return {\n    backgroundColor: color,\n    border: `1px solid ${borderColor}`\n  };\n}\n\nexport function getStateTooltip(state: string) {\n  const text = ({\n    'REDEEMED': \"The original BTC have been released, and the deposit is now closed.\",\n    \"LIQUIDATION_IN_PROGRESS\": \"The funds backing this deposit are being auctioned off.\"\n  } as any)[state] || \"\";\n\n  return text;\n}","import * as React from \"react\"\n\nexport const TBTCIcon = React.forwardRef((props: React.SVGProps<SVGSVGElement>, ref) => {\n  return (\n      <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 56 56\" {...props} ref={ref as any}>\n        <circle cx={28} cy={28} r={25.5} stroke=\"#0A0806\" fill={\"white\"} strokeWidth={5} />\n        <path\n            fillRule=\"evenodd\"\n            clipRule=\"evenodd\"\n            d=\"M26 26h-8v4h8v10h4V30h8v-4H26z\"\n            fill=\"#0A0806\"\n        />\n        <circle cx={28} cy={19} r={3} fill=\"#0A0806\" />\n      </svg>\n  )\n});\n","import {convertPriceFeedVal, PriceData, usePriceFeed} from \"./PriceFeed\";\nimport React from \"react\";\n\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  style: 'percent',\n  maximumFractionDigits: 2\n});\n\nexport function CollaterizationStatus(props: {\n  deposit: any,\n\n  style?: any,\n  highlightNormal?: boolean\n}) {\n  const price = usePriceFeed();\n  return <CollaterizationStatusWithPrice {...props} price={price} />\n}\n\nexport function getPriceAtCollateralizationRatio(deposit: any, ratio: number) {\n  const bondValueWei = parseInt(deposit.bondedECDSAKeep.totalBondAmount);\n  const lotValueSatoshis = parseInt(deposit.lotSizeSatoshis);\n  return ((ratio * lotValueSatoshis) / bondValueWei)  * 10**10;   // I am too tired to figure out why it has to be **10.\n}\n\nexport function CollaterizationStatusWithPrice(props: {\n  deposit: any,\n  price: PriceData|null\n\n  style?: any,\n  highlightNormal?: boolean\n}) {\n  const {deposit} = props;\n\n  const price = deposit.finalBtcPrice ? convertPriceFeedVal(deposit.finalBtcPrice) : props.price;\n  const isFinalized = !!deposit.finalBtcPrice;\n\n  if (!price) {\n    return <span>-</span>;\n  }\n\n  const bondValueWei = parseInt(deposit.bondedECDSAKeep.totalBondAmount);\n  const lotValueSatoshis = parseInt(deposit.lotSizeSatoshis);\n  const lotValueWei = lotValueSatoshis * price.weiPerSat;\n\n  const ratio = bondValueWei / lotValueWei;\n\n  const ratioPercent = ratio * 100;\n  let status = 'normal';\n  if (ratioPercent < deposit.undercollateralizedThresholdPercent) {\n    status = 'courtesy'\n  }\n  if (ratioPercent < deposit.severelyUndercollateralizedThresholdPercent) {\n    status = 'undercollaterized'\n  }\n\n  // Color-code unless finalized.\n  const color = isFinalized ? null : ({\n    'normal': props.highlightNormal ? 'green' : undefined,\n    'courtesy': 'orange',\n    'undercollaterized': 'red'\n  } as any)[status]\n\n  // Show as gray in the normal/non-highlight case, or when finalized.\n  let extraStyle = ((!props.highlightNormal && status == 'normal') || isFinalized) ? {\n    fontSize: '0.9em',\n    color: 'gray'\n  }  : {};\n\n  return <span style={{\n    color: color,\n      ...extraStyle,\n    ...props.style\n  }}>{formatter.format(ratio)}</span>\n}","import Tippy, {useSingleton} from \"@tippyjs/react\";\nimport {usePriceFeed} from \"../../components/PriceFeed\";\nimport {useEtherscanDomain} from \"../../NetworkContext\";\nimport {SortableHeader, Table, useSort} from \"../../components/Table\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {TimeToNow} from \"../../components/FormattedTime\";\nimport {css} from \"emotion\";\nimport {ExternalLinkIcon} from \"../../components/ExternalLinkIcon\";\nimport {getSatoshisAsBitcoin} from \"../../utils/getSatoshisAsBitcoin\";\nimport {getNiceStateLabel, getStateBoxStyle, NiceStateLabel} from \"../../utils/depositStates\";\nimport {hasDepositBeenUsedToMint} from \"../../utils/contracts\";\nimport {TBTCIcon} from \"../../design-system/tbtcIcon\";\nimport {CollaterizationStatusWithPrice} from \"../../components/CollateralizationStatus\";\nimport {getWeiAsEth} from \"../../utils/getWeiAsEth\";\nimport React from \"react\";\nimport {gql} from \"@apollo/client\";\nimport {GetOperatorKeepsQuery} from \"../../generated/graphql\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport { Link } from \"../../components/Link\";\nimport {SkeletonTableRow} from \"../../components/SkeletonLoader\";\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 2\n});\n\nconst KEEPS_QUERY = gql`\n    query GetOperatorKeeps($id: ID!, $orderBy: BondedECDSAKeep_orderBy, $orderDirection: OrderDirection, $block: Block_height) {\n        operator(id: $id, block: $block) {\n            keeps(first: 1000, orderBy: $orderBy, orderDirection: $orderDirection) {\n                id,\n                # TODO: How much is bonded in this keep for this operator?\n                totalBondAmount,\n                stakedropRewardStatus,\n                stakedropInterval { number }\n                deposit {\n                    id,\n                    contractAddress,\n                    lotSizeSatoshis,\n                    currentState,\n                    keepAddress,\n                    createdAt,\n                    tdtToken {\n                        owner\n                    },\n                    finalBtcPrice\n\n                    undercollateralizedThresholdPercent,\n                    severelyUndercollateralizedThresholdPercent,\n\n                    # Should take it from the parent intead.\n                    bondedECDSAKeep {\n                        id,\n                        totalBondAmount\n                    },\n\n                    ...NiceStateLabel\n                }\n            }\n        }\n    }\n\n    ${NiceStateLabel}\n`;\n\n\nexport function KeepsTable(props: {\n  operatorId: string\n}) {\n  const [source, target] = useSingleton();\n  const price = usePriceFeed();\n  const etherscan = useEtherscanDomain();\n  const sortState = useSort(\"createdAt\");\n\n  const { loading, error, data } = useQueryWithTimeTravel<GetOperatorKeepsQuery>(KEEPS_QUERY, {variables: {\n    id: props.operatorId,\n    orderBy: sortState.column,\n    orderDirection: sortState.direction\n  }});\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  const keeps = data?.operator?.keeps;\n\n  // const totalActive = props.keeps.filter((keep: any) => {\n  //   return (\n  //       keep.deposit.currentState == 'ACTIVE' ||\n  //       keep.deposit.currentState == 'AWAITING_SIGNER_SETUP' ||\n  //       keep.deposit.currentState == 'AWAITING_BTC_FUNDING_PROOF'\n  //   )\n  // }).map((keep: any) => parseFloat(keep.totalBondAmount) / 3).reduce((a: any, b: any) => a + b, 0)\n\n  return <>\n    <Tippy singleton={source} delay={500} />\n    <Table style={{width: '100%'}}>\n      <thead>\n      <tr>\n        <th>\n          <SortableHeader fieldId={\"createdAt\"} state={sortState}>\n            Created\n          </SortableHeader>\n        </th>\n        <th>\n          Contract <InfoTooltip>\n          Every deposit is represented on-chain by a contract.\n        </InfoTooltip>\n        </th>\n        <th>\n          Lot Size\n        </th>\n        <th>State</th>\n        <th>\n          <SortableHeader fieldId={\"etcToBtcRatio\"} state={sortState}>\n            C-Ratio <InfoTooltip>\n            The current collateralization ratio, or for completed deposits, the ratio at the time of completion.\n          </InfoTooltip>\n          </SortableHeader>\n        </th>\n        <th>\n          <SortableHeader fieldId={\"totalBondAmount\"} state={sortState}>\n            Bond\n          </SortableHeader>\n        </th>\n        <th>\n          Stakedrop\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      {loading ? <SkeletonTableRow columns={7} /> : null}\n      {keeps?.map((keep: any) => {\n        const deposit = keep.deposit;\n        return <tr key={deposit.id}>\n          <td>\n            <TimeToNow\n                time={deposit.createdAt}\n            />\n          </td>\n          <td>\n            <Link to={`/deposit/${deposit.contractAddress}`}>\n              {deposit.contractAddress}\n            </Link>\n            <a title={\"Open on Etherscan\"} href={`https://${etherscan}/address/${deposit.contractAddress}`}\n               className={css`\n                font-size: 0.8em;\n                padding-left: 0.2em;\n               `}>\n              <ExternalLinkIcon/>\n            </a>\n          </td>\n          <td>\n            <span style={{\n              color: 'gray',\n              fontSize: '0.8em'\n            }}>BTC</span>&nbsp;{getSatoshisAsBitcoin(deposit.lotSizeSatoshis ?? 0)}\n          </td>\n          <td className={css`\n            display: flex;\n            align-items: center;\n          `}>\n            <div className={css`\n              display: inline-block;\n              width: 1.2em;\n              height: 1.2em;\n              border-radius: 2px;\n              padding: 0.2em;\n              box-sizing: border-box;\n            `} style={getStateBoxStyle(deposit.currentState)}>\n            </div>\n            &nbsp;\n            {hasDepositBeenUsedToMint(deposit.tdtToken.owner, deposit.currentState)\n                ? <><Tippy content=\"TBTC was minted\" singleton={target}><TBTCIcon/></Tippy>&nbsp;</>\n                : \"\"\n            }\n            {getNiceStateLabel(deposit)}\n          </td>\n\n          <td>\n            <CollaterizationStatusWithPrice deposit={deposit} price={price} highlightNormal={true}/>\n          </td>\n\n          <td>\n            {/*Get the real number from the contract. */}\n            <span style={{\n              color: 'gray',\n              fontSize: '0.8em'\n            }}>ETH</span> {formatter.format(getWeiAsEth(keep.totalBondAmount / 3))}\n          </td>\n\n          <td>\n            <RewardStatus status={keep.stakedropRewardStatus} target={target} />\n          </td>\n        </tr>\n      })}\n      </tbody>\n    </Table>\n  </>;\n}\n\n\nconst StakeDropIcons = ({\n  //https://icons8.com/icon/set/cross/flat_round (32x32)\n  \"INELIGABLE\": \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMzIiIGhlaWdodD0iMzIiCnZpZXdCb3g9IjAgMCA1MTIgNTEyIgpzdHlsZT0iIGZpbGw6IzAwMDAwMDsiPjxwYXRoIGZpbGw9IiNFMDRGNUYiIGQ9Ik01MDQuMSwyNTZDNTA0LjEsMTE5LDM5Myw3LjksMjU2LDcuOUMxMTksNy45LDcuOSwxMTksNy45LDI1NkM3LjksMzkzLDExOSw1MDQuMSwyNTYsNTA0LjFDMzkzLDUwNC4xLDUwNC4xLDM5Myw1MDQuMSwyNTZ6Ij48L3BhdGg+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTI4NSwyNTZsNzIuNS04NC4yYzcuOS05LjIsNi45LTIzLTIuMy0zMWMtOS4yLTcuOS0yMy02LjktMzAuOSwyLjNMMjU2LDIyMi40bC02OC4yLTc5LjJjLTcuOS05LjItMjEuOC0xMC4yLTMxLTIuM2MtOS4yLDcuOS0xMC4yLDIxLjgtMi4zLDMxTDIyNywyNTZsLTcyLjUsODQuMmMtNy45LDkuMi02LjksMjMsMi4zLDMxYzQuMSwzLjYsOS4yLDUuMywxNC4zLDUuM2M2LjIsMCwxMi4zLTIuNiwxNi42LTcuNmw2OC4yLTc5LjJsNjguMiw3OS4yYzQuMyw1LDEwLjUsNy42LDE2LjYsNy42YzUuMSwwLDEwLjItMS43LDE0LjMtNS4zYzkuMi03LjksMTAuMi0yMS44LDIuMy0zMUwyODUsMjU2eiI+PC9wYXRoPjwvc3ZnPg==\",\n  //https://icons8.com/icon/set/cross/flat_round (32x32, #CCCCCC)\n  \"TERMINATION_REPORTED\": \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMzIiIGhlaWdodD0iMzIiCnZpZXdCb3g9IjAgMCAxNzIgMTcyIgpzdHlsZT0iIGZpbGw6IzAwMDAwMDsiPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0ibm9uemVybyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIGZvbnQtZmFtaWx5PSJub25lIiBmb250LXdlaWdodD0ibm9uZSIgZm9udC1zaXplPSJub25lIiB0ZXh0LWFuY2hvcj0ibm9uZSIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOiBub3JtYWwiPjxwYXRoIGQ9Ik0wLDE3MnYtMTcyaDE3MnYxNzJ6IiBmaWxsPSJub25lIj48L3BhdGg+PGc+PHBhdGggZD0iTTE2OS4zNDYwOSw4NmMwLC00Ni4wMjM0NCAtMzcuMzIyNjYsLTgzLjM0NjA5IC04My4zNDYwOSwtODMuMzQ2MDljLTQ2LjAyMzQ0LDAgLTgzLjM0NjA5LDM3LjMyMjY2IC04My4zNDYwOSw4My4zNDYwOWMwLDQ2LjAyMzQ0IDM3LjMyMjY2LDgzLjM0NjA5IDgzLjM0NjA5LDgzLjM0NjA5YzQ2LjAyMzQ0LDAgODMuMzQ2MDksLTM3LjMyMjY2IDgzLjM0NjA5LC04My4zNDYwOXoiIGZpbGw9IiNjY2NjY2MiPjwvcGF0aD48cGF0aCBkPSJNOTUuNzQyMTksODZsMjQuMzU1NDcsLTI4LjI4NTk0YzIuNjUzOTEsLTMuMDkwNjIgMi4zMTc5NywtNy43MjY1NiAtMC43NzI2NiwtMTAuNDE0MDZjLTMuMDkwNjMsLTIuNjUzOTEgLTcuNzI2NTYsLTIuMzE3OTcgLTEwLjM4MDQ3LDAuNzcyNjZsLTIyLjk0NDUzLDI2LjYzOTg0bC0yMi45MTA5NCwtMjYuNjA2MjVjLTIuNjUzOTEsLTMuMDkwNjIgLTcuMzIzNDQsLTMuNDI2NTYgLTEwLjQxNDA2LC0wLjc3MjY2Yy0zLjA5MDYyLDIuNjUzOTEgLTMuNDI2NTYsNy4zMjM0NCAtMC43NzI2NiwxMC40MTQwNmwyNC4zNTU0NywyOC4yNTIzNGwtMjQuMzU1NDcsMjguMjg1OTRjLTIuNjUzOTEsMy4wOTA2MiAtMi4zMTc5Nyw3LjcyNjU2IDAuNzcyNjYsMTAuNDE0MDZjMS4zNzczNCwxLjIwOTM3IDMuMDkwNjIsMS43ODA0NyA0LjgwMzkxLDEuNzgwNDdjMi4wODI4MSwwIDQuMTMyMDMsLTAuODczNDQgNS41NzY1NiwtMi41NTMxM2wyMi45MTA5NCwtMjYuNjA2MjVsMjIuOTEwOTQsMjYuNjA2MjVjMS40NDQ1MywxLjY3OTY5IDMuNTI3MzQsMi41NTMxMyA1LjU3NjU2LDIuNTUzMTNjMS43MTMyOCwwIDMuNDI2NTYsLTAuNTcxMDkgNC44MDM5MSwtMS43ODA0N2MzLjA5MDYzLC0yLjY1MzkxIDMuNDI2NTYsLTcuMzIzNDQgMC43NzI2NiwtMTAuNDE0MDZ6IiBmaWxsPSIjZmZmZmZmIj48L3BhdGg+PC9nPjwvZz48L3N2Zz4=\",\n  // https://icons8.com/icons/set/checkmark (32x32, #CCCCCC)\n  \"DISPENSED\": \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIKdmlld0JveD0iMCAwIDE3MiAxNzIiCnN0eWxlPSIgZmlsbDojMDAwMDAwOyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtZGFzaG9mZnNldD0iMCIgZm9udC1mYW1pbHk9Im5vbmUiIGZvbnQtd2VpZ2h0PSJub25lIiBmb250LXNpemU9Im5vbmUiIHRleHQtYW5jaG9yPSJub25lIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6IG5vcm1hbCI+PHBhdGggZD0iTTAsMTcydi0xNzJoMTcydjE3MnoiIGZpbGw9Im5vbmUiPjwvcGF0aD48Zz48cGF0aCBkPSJNMTY5LjM0NjA5LDg2YzAsLTQ2LjAyMzQ0IC0zNy4zMjI2NiwtODMuMzQ2MDkgLTgzLjM0NjA5LC04My4zNDYwOWMtNDYuMDIzNDQsMCAtODMuMzQ2MDksMzcuMzIyNjYgLTgzLjM0NjA5LDgzLjM0NjA5YzAsNDYuMDIzNDQgMzcuMzIyNjYsODMuMzQ2MDkgODMuMzQ2MDksODMuMzQ2MDljNDYuMDIzNDQsMCA4My4zNDYwOSwtMzcuMzIyNjYgODMuMzQ2MDksLTgzLjM0NjA5eiIgZmlsbD0iI2NjY2NjYyI+PC9wYXRoPjxwYXRoIGQ9Ik0xMzEuODg5MDYsNTguMDgzNTljLTEuOTQ4NDQsLTUuMDcyNjYgLTUuOTQ2MDksLTQuMjY2NDEgLTEwLjI3OTY5LC0zLjM5Mjk3Yy0yLjU4NjcyLDAuNTM3NSAtMTQuMTA5MzcsMy44OTY4NyAtMzIuMjgzNTksMjMuMTEyNWMtNy41NTg1OSw3Ljk2MTcyIC0xMi41MzA0NywxNC4zMTA5NCAtMTUuODIyNjYsMTkuMTQ4NDRjLTIuMDE1NjIsLTIuNDUyMzQgLTQuMywtNS4xMDYyNSAtNi43MTg3NSwtNy40OTE0MWMtNy40MjQyMiwtNy40MjQyMiAtMTUuNzIxODcsLTEyLjUzMDQ3IC0xNi4wNTc4MSwtMTIuNzMyMDNjLTMuNDYwMTYsLTIuMTE2NDEgLTcuOTk1MzEsLTEuMDQxNDEgLTEwLjE0NTMxLDIuNDUyMzRjLTIuMTE2NDEsMy40NjAxNiAtMS4wNDE0MSw3Ljk5NTMxIDIuNDE4NzUsMTAuMTQ1MzFjMC4wNjcxOSwwLjAzMzU5IDcuMTg5MDYsNC40MzQzOCAxMy4zMDMxMywxMC41ODIwM2M2LjI0ODQ0LDYuMjQ4NDQgMTEuOTI1NzgsMTQuNzE0MDYgMTEuOTkyOTcsMTQuODE0ODRjMS4zNzczNCwyLjA4MjgxIDMuNjk1MzEsMy4yOTIxOSA2LjE0NzY2LDMuMjkyMTljMC40MDMxMiwwIDAuODM5ODQsLTAuMDMzNTkgMS4yNzY1NiwtMC4xMDA3OGMyLjg4OTA2LC0wLjUwMzkxIDUuMTczNDQsLTIuNjUzOTEgNS44Nzg5MSwtNS40NzU3OGMwLjAzMzU5LC0wLjA2NzE5IDIuOTU2MjUsLTguMTYzMjggMTguMzc1NzgsLTI0LjQyMjY2YzEyLjQyOTY5LC0xMy4xMzUxNiAyMC43MjczNCwtMTcuMzAwNzggMjMuNjE2NDEsLTE4LjQ0Mjk3YzAuMDMzNTksMCAwLjAzMzU5LDAgMC4xMDA3OCwwYzAsMCAwLjEwMDc4LC0wLjAzMzU5IDAuMjY4NzUsLTAuMTM0MzhjMC41MDM5MSwtMC4yMDE1NiAwLjc3MjY2LC0wLjI2ODc1IDAuNzcyNjYsLTAuMjY4NzVjLTAuMTM0MzcsMC4wMzM1OSAtMC4yMDE1NiwwLjAzMzU5IC0wLjIwMTU2LDAuMDMzNTl2LTAuMDMzNTljMS4zNDM3NSwtMC41NzEwOSAzLjgyOTY5LC0xLjY0NjA5IDMuODYzMjgsLTEuNjc5NjljMy43Mjg5MSwtMS42MTI1IDQuOTcxODcsLTUuNjQzNzUgMy40OTM3NSwtOS40MDYyNXoiIGZpbGw9IiNmZmZmZmYiPjwvcGF0aD48L2c+PC9nPjwvc3ZnPg==\",\n  // https://icons8.com/icons/set/checkmark (32x32, #23AE5A)\n  \"WITHDRAWABLE\": \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIKdmlld0JveD0iMCAwIDE3MiAxNzIiCnN0eWxlPSIgZmlsbDojMDAwMDAwOyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1saW5lam9pbj0ibWl0ZXIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iIiBzdHJva2UtZGFzaG9mZnNldD0iMCIgZm9udC1mYW1pbHk9Im5vbmUiIGZvbnQtd2VpZ2h0PSJub25lIiBmb250LXNpemU9Im5vbmUiIHRleHQtYW5jaG9yPSJub25lIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6IG5vcm1hbCI+PHBhdGggZD0iTTAsMTcydi0xNzJoMTcydjE3MnoiIGZpbGw9Im5vbmUiPjwvcGF0aD48Zz48cGF0aCBkPSJNMTY5LjM0NjA5LDg2YzAsLTQ2LjAyMzQ0IC0zNy4zMjI2NiwtODMuMzQ2MDkgLTgzLjM0NjA5LC04My4zNDYwOWMtNDYuMDIzNDQsMCAtODMuMzQ2MDksMzcuMzIyNjYgLTgzLjM0NjA5LDgzLjM0NjA5YzAsNDYuMDIzNDQgMzcuMzIyNjYsODMuMzQ2MDkgODMuMzQ2MDksODMuMzQ2MDljNDYuMDIzNDQsMCA4My4zNDYwOSwtMzcuMzIyNjYgODMuMzQ2MDksLTgzLjM0NjA5eiIgZmlsbD0iIzIzYWU1YSI+PC9wYXRoPjxwYXRoIGQ9Ik0xMzEuODg5MDYsNTguMDgzNTljLTEuOTQ4NDQsLTUuMDcyNjYgLTUuOTQ2MDksLTQuMjY2NDEgLTEwLjI3OTY5LC0zLjM5Mjk3Yy0yLjU4NjcyLDAuNTM3NSAtMTQuMTA5MzcsMy44OTY4NyAtMzIuMjgzNTksMjMuMTEyNWMtNy41NTg1OSw3Ljk2MTcyIC0xMi41MzA0NywxNC4zMTA5NCAtMTUuODIyNjYsMTkuMTQ4NDRjLTIuMDE1NjIsLTIuNDUyMzQgLTQuMywtNS4xMDYyNSAtNi43MTg3NSwtNy40OTE0MWMtNy40MjQyMiwtNy40MjQyMiAtMTUuNzIxODcsLTEyLjUzMDQ3IC0xNi4wNTc4MSwtMTIuNzMyMDNjLTMuNDYwMTYsLTIuMTE2NDEgLTcuOTk1MzEsLTEuMDQxNDEgLTEwLjE0NTMxLDIuNDUyMzRjLTIuMTE2NDEsMy40NjAxNiAtMS4wNDE0MSw3Ljk5NTMxIDIuNDE4NzUsMTAuMTQ1MzFjMC4wNjcxOSwwLjAzMzU5IDcuMTg5MDYsNC40MzQzOCAxMy4zMDMxMywxMC41ODIwM2M2LjI0ODQ0LDYuMjQ4NDQgMTEuOTI1NzgsMTQuNzE0MDYgMTEuOTkyOTcsMTQuODE0ODRjMS4zNzczNCwyLjA4MjgxIDMuNjk1MzEsMy4yOTIxOSA2LjE0NzY2LDMuMjkyMTljMC40MDMxMiwwIDAuODM5ODQsLTAuMDMzNTkgMS4yNzY1NiwtMC4xMDA3OGMyLjg4OTA2LC0wLjUwMzkxIDUuMTczNDQsLTIuNjUzOTEgNS44Nzg5MSwtNS40NzU3OGMwLjAzMzU5LC0wLjA2NzE5IDIuOTU2MjUsLTguMTYzMjggMTguMzc1NzgsLTI0LjQyMjY2YzEyLjQyOTY5LC0xMy4xMzUxNiAyMC43MjczNCwtMTcuMzAwNzggMjMuNjE2NDEsLTE4LjQ0Mjk3YzAuMDMzNTksMCAwLjAzMzU5LDAgMC4xMDA3OCwwYzAsMCAwLjEwMDc4LC0wLjAzMzU5IDAuMjY4NzUsLTAuMTM0MzhjMC41MDM5MSwtMC4yMDE1NiAwLjc3MjY2LC0wLjI2ODc1IDAuNzcyNjYsLTAuMjY4NzVjLTAuMTM0MzcsMC4wMzM1OSAtMC4yMDE1NiwwLjAzMzU5IC0wLjIwMTU2LDAuMDMzNTl2LTAuMDMzNTljMS4zNDM3NSwtMC41NzEwOSAzLjgyOTY5LC0xLjY0NjA5IDMuODYzMjgsLTEuNjc5NjljMy43Mjg5MSwtMS42MTI1IDQuOTcxODcsLTUuNjQzNzUgMy40OTM3NSwtOS40MDYyNXoiIGZpbGw9IiNmZmZmZmYiPjwvcGF0aD48L2c+PC9nPjwvc3ZnPg==\",\n} as any);\n\n\nconst StakeDropStatusExplainer = ({\n  \"INELIGABLE\": \"There is no reward for this keep, but it needs to be notified to have the reward allocation added back into the pool for future intervals.\",\n  \"TERMINATION_REPORTED\": \"There is no reward for this keep, and the amount initially allocated for it has been transferred back into the pool.\",\n  \"DISPENSED\": \"The reward for this keep has been dispensed (but may not have been withdrawn).\",\n  \"WITHDRAWABLE\": \"The reward for this keep has not yet been dispensed.\",\n} as any);\n\nfunction RewardStatus(props: {\n  status: string,\n  target: any\n}) {\n  const url = StakeDropIcons[props.status];\n  if (url) {\n    return <Tippy content={StakeDropStatusExplainer[props.status]} singleton={props.target}>\n      <img style={{width: 14, height: 14}} src={url} />\n    </Tippy>\n  }\n  return null;\n}","import { uniqueNamesGenerator, Config, colors, animals } from 'unique-names-generator';\n\nexport function getGroupName(groupId: string) {\n  return uniqueNamesGenerator({\n    dictionaries: [colors, animals],\n    separator: ' ',\n    // Conver the group pub key (0xabcef) to a number. Note we have to cut it off, the number would be much too large.\n    seed: parseInt(groupId.slice(0, 12), 16)\n  });\n}","import React from \"react\";\n\nexport function ETHValue(props: {\n  wei?: number,\n  eth?: number,\n  unit: 'eth'|'gwei'\n}) {\n  let wei: number;\n  if (props.wei !== undefined) {\n    wei = props.wei\n  } else {\n    wei = props.eth! * (10 ** 18);\n  }\n\n  let factor: number;\n  let maxDigits: number|undefined ;\n  if (props.unit === 'eth') {\n    factor = 1_000_000_000_000_000_000;\n    maxDigits = undefined\n  } else {\n    factor = 1000_000_000;\n    maxDigits = 0;\n  }\n\n  const value = wei / factor;\n  const formatter = new Intl.NumberFormat(\"en-US\", {\n    maximumFractionDigits: maxDigits\n  });\n  return <>{formatter.format(value)}</>;\n}\nETHValue.defaultProps = {\n  unit: 'eth'\n}","import {Table} from \"../../components/Table\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {Hash} from \"../../components/Address\";\nimport {getGroupName} from \"../Beacon/GroupName\";\nimport {ETHTag} from \"../../components/CurrencyTags\";\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {TimeToNow} from \"../../components/FormattedTime\";\nimport React from \"react\";\n\nexport function BeaconGroupsTable(props: {\n  memberships: any,\n}) {\n  const {memberships} = props;\n\n  return <Table\n      style={{width: '100%'}}>\n    <thead>\n    <tr>\n      <th>\n        Group\n      </th>\n      <th>\n        Weight <InfoTooltip>An operator can fill multiple membership slots in a group, and will then earn a multiple of rewards.</InfoTooltip>\n      </th>\n      <th>\n        ETH Earned <InfoTooltip>ETH earned by the operator through membership in the group.</InfoTooltip>\n      </th>\n      <th>\n        Created At\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    {memberships.map((membership: any) => {\n      const {group} = membership;\n      return <tr key={group.id}>\n        <td>\n          <Hash hash={group.pubKey} to={`/group/${group.id}`}>{getGroupName(group.id)}</Hash>\n        </td>\n        <td>\n          {membership.count}\n        </td>\n        <td>\n          <ETHTag/> <ETHValue unit={\"eth\"} wei={membership.reward}/>\n        </td>\n        <td><TimeToNow time={group.createdAt}/></td>\n      </tr>\n    })}\n    </tbody>\n  </Table>\n}","import React, {useMemo} from \"react\";\n\nexport const keepFormatter = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 0\n});\n\nexport function KeepValue(props: {\n  keep: number,\n} | {raw: number}) {\n  let keep: number;\n  if ('raw' in props) {\n    keep = props.raw / 10**18;\n  } else {\n    keep = props.keep;\n  }\n\n  return <>{keepFormatter.format(keep)}</>;\n}\n","import {css} from \"emotion\";\nimport {Paper} from \"../design-system/Paper\";\nimport Tippy from \"@tippyjs/react\";\nimport React from \"react\";\n\nexport function PageHeaderMenu(props: {\n  children: any\n}) {\n  return <Tippy\n      trigger=\"click\"\n      hideOnClick={true}\n      arrow={false}\n      interactive={true}\n      maxWidth={600}\n      className={css`\n              background-color: transparent !important;\n              padding: 0;\n              color: inherit;\n            `}\n      placement={\"bottom\"}\n      content={\n        <Paper style={{padding: '10px'}}>\n          {props.children}\n        </Paper>\n      }\n  >\n    <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAW0lEQVRIie2Ruw2AMAwFTykyu5mD2RKmQFCQ6imiSALVO8mSP+fGBmPML2RgAypQgGi9ZU4Al0TI8pRTO4NDloed1BLllHrYScDeGWhvysk8tyq8P3CFY4z5ghvPEDu0rDRS9gAAAABJRU5ErkJggg==\"\n         width={14} height={14} style={{cursor: 'pointer'}} />\n  </Tippy>\n}","import React from \"react\";\nimport {css} from \"emotion\";\nimport {TimeToNow} from \"./FormattedTime\";\nimport {Address, Transaction} from \"./Address\";\n\nexport function LogTitle(props: {\n  children: any\n}) {\n  return <div style={{marginBottom: '0.2em'}}><strong>{props.children}</strong></div>;\n}\n\nexport function LogEntry(props: {\n  event: {\n    transactionHash: string,\n    submitter: string,\n    __typename: string,\n    timestamp: string\n  },\n  Components: any\n}) {\n  const {event, Components} = props;\n\n  let Component = Components[event.__typename] || UnknownEvent;\n\n  return <div className={css`\n    &:not(:last-child) {\n       margin-bottom: 20px;\n       border-bottom: 1px dotted silver;\n       padding-bottom: 20px;\n    }     \n   `}>\n    <div className={css`    \n      font-size: 0.85em;\n      margin-bottom: 0.4em;\n      color: gray;\n    `}>\n      <TimeToNow time={event.timestamp}/> @ <Transaction tx={event.transactionHash}/> by <Address address={event.submitter}/>\n    </div>\n    <div>\n      <Component event={event}/>\n    </div>\n  </div>\n}\n\nexport function UnknownEvent(props: {\n  event: any\n}) {\n  return <div>Unknown Event: {props.event.__typename}</div>\n}","import {SortableHeader, Table, useSort} from \"../../components/Table\";\nimport React from \"react\";\nimport {gql} from \"@apollo/client\";\nimport {getNiceStateLabel, getStateBoxStyle, NiceStateLabel} from \"../../utils/depositStates\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport {GetOperatorKeepsQuery, GetOperatorLogQuery} from \"../../generated/graphql\";\nimport {LogEntry, LogTitle} from \"../../components/Log\";\nimport {Address} from \"../../components/Address\";\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {keepFormatter} from \"../../components/KeepValue\";\n\nconst OPERATOR_LOG_QUERY = gql`\n    query GetOperatorLog($id: String!, $orderBy: BondedECDSAKeep_orderBy, $orderDirection: OrderDirection, $block: Block_height) {\n        events(where: {operator: $id}, orderBy: timestamp, orderDirection: desc, block: $block) {\n            __typename,\n            id,\n            transactionHash,\n            submitter,\n            timestamp,\n            \n            ... on UnbondedValueDepositedEvent {\n                amount,\n                beneficiary\n            },\n\n            ... on UnbondedValueWithdrawnEvent {\n                amount,\n                beneficiary\n            },\n            \n            ... on BondSeizedEvent {\n                amount,\n                destination,\n                referenceId\n            },\n            \n            ...on TokensSeizedEvent {\n                amount\n            },\n\n            ...on TopUpInitiatedEvent {\n                amount\n            }\n\n            ...on TopUpCompletedEvent {\n                newAmount\n            },\n            ...on OperatorAuthorizationEvent {\n                authorizationType,\n                isDeauthorization\n            }\n        }\n    }\n\n    ${NiceStateLabel}\n`;\n\n\nexport function OperatorLog(props: {\n  operatorId: string\n}) {\n  const sortState = useSort(\"createdAt\");\n\n  const { loading, error, data } = useQueryWithTimeTravel<GetOperatorLogQuery>(OPERATOR_LOG_QUERY, {variables: {\n      id: props.operatorId,\n      orderBy: sortState.column,\n      orderDirection: sortState.direction\n    }});\n\n  if (loading) return <p>Loading...</p>;\n  if (error || !data) return <p>Error :( {\"\"+ error}</p>;\n\n  return <div>\n    {data?.events.map((event, idx) => {\n      return <LogEntry key={event.id} event={event} Components={LogComponents} />\n    })}\n  </div>\n}\n\nconst LogComponents = {\n  'UnbondedValueDepositedEvent': UnbondedValueDepositedEvent,\n  'UnbondedValueWithdrawnEvent': UnbondedValueWithdrawnEvent,\n  'BondSeizedEvent': BondSeizedEvent,\n  'TokenGrantStakedEvent': TokenGrantStakedEvent,\n  'TokensSeizedEvent': TokensSeizedEvent,\n  'TopUpInitiatedEvent': TopUpInitiatedEvent,\n  'TopUpCompletedEvent': TopUpCompletedEvent,\n  'UndelegatedEvent': UndelegatedEvent,\n  'OperatorStakedEvent': OperatorStakedEvent,\n  'OperatorAuthorizationEvent': OperatorAuthorizationEvent\n}\n\n\nfunction UnbondedValueDepositedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>ETH Collateral Deposited</LogTitle>\n    <div>\n      <ETHValue wei={props.event.amount} /> ETH of additional collateral was deposited.\n    </div>\n  </div>\n}\n\nfunction UnbondedValueWithdrawnEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>ETH Collateral Withdrawn</LogTitle>\n    <div>\n      <ETHValue wei={props.event.amount} /> ETH of collateral was withdrawn.\n    </div>\n  </div>\n}\n\nfunction BondSeizedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Bond Seized</LogTitle>\n    <div>\n      <ETHValue wei={props.event.amount} /> ETH of bonded collateral was seized by the system (and sent to <Address address={props.event.destination} />).\n    </div>\n  </div>\n}\n\nfunction TokenGrantStakedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Token Grant Staked</LogTitle>\n  </div>\n}\n\nfunction OperatorStakedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Staked</LogTitle>\n  </div>\n}\n\nfunction TopUpInitiatedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Topup initiated</LogTitle>\n    <div>\n      A topup of {keepFormatter.format(props.event.amount / (10**18))} KEEP was initiated.\n    </div>\n  </div>\n}\n\nfunction TopUpCompletedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Topup Completed</LogTitle>\n    <div>\n      The topup completed. The total amount staked is now {keepFormatter.format(props.event.newAmount / (10**18))} KEEP.\n    </div>\n  </div>\n}\n\nfunction TokensSeizedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Tokens Seized</LogTitle>\n    <div>\n      {keepFormatter.format(props.event.amount / (10**18))} KEEP were seized.\n    </div>\n  </div>\n}\n\n\nfunction UndelegatedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Undelegated</LogTitle>\n  </div>\n}\n\n\nfunction OperatorAuthorizationEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Contract {props.event.isDeauthorization ? \"Deauthorized\" : \"Authorized\"}</LogTitle>\n    <div>\n      The {props.event.authorizationType} contract has been {props.event.isDeauthorization ? \"deauthorized\" : \"authorized\"}.\n    </div>\n  </div>\n}","import {css} from \"emotion\";\nimport {InfoTooltip} from \"./InfoTooltip\";\nimport React, {Fragment} from \"react\";\n\ntype Property = {\n  key: string,\n  label: string,\n  tooltip?: string,\n  value: any\n};\n\ntype PropertyList = (Property|undefined)[];\n\ntype GroupList = {title: string, properties: PropertyList}[];\n\nfunction isGroupList(data: PropertyList|GroupList): data is GroupList {\n  if (data.length && data[0] && \"properties\" in data[0]) {\n    return true;\n  }\n  return false;\n}\n\n\nexport function PropertyTable(props: {\n  data: PropertyList|GroupList,\n  style?: any\n}) {\n  const groupList = isGroupList(props.data) ? props.data : [{title: \"\", properties: props.data}];\n\n  return <table\n    style={props.style}\n    className={css`\n      color: #0A0806;\n      \n      & td, th {\n        font-weight: normal;\n        padding: 5px;\n        text-align: left;\n        vertical-align: top;\n      }\n      \n      tbody.indented th:first-child {\n        padding-left: 20px;\n      }\n    `}\n  >\n    {groupList.map(group => {\n      const props = group.properties.map(row => {\n        if (!row) {\n          return null;\n        }\n        return <tr key={row.key}>\n          <th>\n            {row.label} {row.tooltip ? <InfoTooltip>{row.tooltip}</InfoTooltip> : null}\n          </th>\n          <td>{row.value}</td>\n        </tr>\n      })\n\n      return <Fragment key={group.title}>\n        {group.title ? <tbody>\n          <tr>\n            <th style={{fontWeight:'bold'}} colSpan={2}>{group.title}</th>\n          </tr>\n        </tbody> : null}\n\n        <tbody className={group.title ? \"indented\" : \"\"}>\n          {props}\n        </tbody>\n      </Fragment>\n    })}\n  </table>\n}","import React from \"react\";\nimport {OperatorLog} from \"./Log\";\nimport {Paper} from \"../../design-system/Paper\";\nimport {PropertyTable} from \"../../components/PropertyTable\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport {gql} from \"@apollo/client\";\nimport {Address} from \"../../components/Address\";\nimport {GetOperatorDataQuery} from \"../../generated/graphql\";\nimport {FormattedTime} from \"../../components/FormattedTime\";\nimport {formatNumber, formatPercentage} from \"../../utils/formatNumber\";\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {keepFormatter} from \"../../components/KeepValue\";\nimport {KeepTag} from \"../../components/CurrencyTags\";\n\n\nconst OPERATOR_INFO_QUERY = gql`\n    query GetOperatorData($id: ID!, $block: Block_height) {\n      operator(id: $id) {\n        id,\n        address,\n        owner,\n        beneficiary,\n        authorizer,\n        \n        stakedAmount,\n        ethLocked,\n        stakedAt,\n        stakeLockExpiresAt,\n        \n        randomBeaconOperatorAuthorized,\n        bondedECDSAKeepFactoryAuthorized,\n        tbtcSystemSortitionPoolAuthorized,\n        \n        stakedropEthScore,\n        stakedropBoost,\n        stakedropRewardWeight\n      },\n      \n      status: statusRecord(id: \"current\") {\n        totalRewardWeight\n      }       \n    }\n`;\n\n\nexport default function OverviewTab(props: {\n  operatorId: string\n}) {\n  const {operatorId} = props;\n\n  const { loading, error, data } = useQueryWithTimeTravel<GetOperatorDataQuery>(OPERATOR_INFO_QUERY, {variables: {\n      id: props.operatorId,\n    }});\n\n  if (loading) return <p>Loading...</p>;\n  if (error || !data) return <p>Error :( {\"\"+ error}</p>;\n\n  const operator = data.operator!;\n  const status = data.status!;\n\n  return <Paper padding>\n    <div style={{display: 'flex', flexDirection: 'row'}}>\n      <div style={{flex:1}}>\n        <PropertyTable data={[\n          {\n            title: \"Stake\",\n            properties: [\n              {\n                key: 'amountstaked',\n                label: \"Stake\",\n                tooltip: \"Amount of KEEP staked by this operator. A larger keep stake means the operator will be selected for work more frequently.\",\n                value: <><KeepTag /> {keepFormatter.format(operator.stakedAmount)}</>\n              },\n              {\n                key: 'dateStaked',\n                label: \"Date\",\n                tooltip: \"When KEEP was originally staked for this operator.\",\n                value: <FormattedTime format={\"full\"} time={operator.stakedAt} />\n              },\n              {\n                key: 'stakeLockedUntil',\n                label: \"Locked Until\",\n                tooltip: \"The stake can only be withdrawn after this date. This date will change when keeps are redeemed early. Note that there is a two-month undelegation period in any case.\",\n                value: (!operator.stakeLockExpiresAt || operator.stakeLockExpiresAt == '0') ? <>Not Locked</> : <FormattedTime format={\"full\"} time={operator.stakeLockExpiresAt} />\n              },\n            ],\n          },\n          {\n            title: \"ETH\",\n            properties: [\n              {\n                key: 'ethLocked',\n                label: \"ETH Locked\",\n                value: <ETHValue eth={operator.ethLocked} />\n              },\n            ],\n          },\n          {\n            title: \"Roles\",\n            properties: [\n              {\n                key: 'address',\n                label: \"Node\",\n                tooltip: \"The address running the node server.\",\n                value: <Address address={operator.address} />\n              },\n              {\n                key: 'owner',\n                label: \"Owner\",\n                tooltip: \"Assigns roles, stakes KEEP and provides ETH for bonding.\",\n                value: <Address address={operator.owner} />\n              },\n              {\n                key: 'beneficiary',\n                label: \"Beneficiary\",\n                tooltip: \"Receives earnings and rewards.\",\n                value: <Address address={operator.beneficiary} />\n              },\n              {\n                key: 'authorizer',\n                label: \"Authorizer\",\n                tooltip: \"Can authorize new contracts.\",\n                value: <Address address={operator.authorizer} />\n              },\n            ]\n          },\n          {\n            title: 'Authorizations',\n            properties: [\n              {\n                key: 'randomBeacon',\n                label: \"Random Beacon\",\n                value: operator.randomBeaconOperatorAuthorized ? 'Yes' : 'No'\n              },\n              {\n                key: 'ecdsa',\n                label: \"ECDSA Factory\",\n                value: operator.bondedECDSAKeepFactoryAuthorized ? 'Yes' : 'No'\n              },\n              {\n                key: 'tbtc',\n                label: \"TBTC System\",\n                value: operator.tbtcSystemSortitionPoolAuthorized ? 'Yes' : 'No'\n              },\n            ]\n          },\n          {\n            title: 'Stakedrop',\n            properties: [\n              {\n                key: 'ethScore',\n                label: \"ETH Score\",\n                tooltip: \"Based on the amount of ETH provided to the system.\",\n                value: formatNumber(operator.stakedropEthScore),\n              },\n              {\n                key: 'bost',\n                label: \"Boost\",\n                tooltip: \"The boost is based on the amount of staked KEEP, and increases the reward weight.\",\n                value: formatNumber(operator.stakedropBoost),\n              },\n              {\n                key: 'rewardWeight',\n                label: \"Reward Weight\",\n                tooltip: \"The reward weight represents this operator's share of the total rewards.\",\n                value: formatNumber(operator.stakedropRewardWeight),\n              },\n              {\n                key: 'rewardWeightShare',\n                label: \"Reward Share\",\n                tooltip: \"The share of rewards going to this operator.\",\n                value: formatPercentage(parseFloat(operator.stakedropRewardWeight) / parseFloat(status.totalRewardWeight)),\n              },\n            ]\n          }\n        ]}\n        />\n      </div>\n      <div style={{flex:1}}>\n        <h3 style={{marginTop: 0}}>Log</h3>\n        <OperatorLog operatorId={operatorId} />\n      </div>\n    </div>\n  </Paper>;\n}","import {gql, useQuery} from \"@apollo/client\";\nimport React from \"react\";\nimport {useParams} from 'react-router';\nimport {css} from \"emotion\";\nimport {Paper} from \"../../design-system/Paper\";\nimport {Helmet} from \"react-helmet\";\nimport {Box} from \"../../components/Box\";\nimport {getSatoshiesAsTBTC} from \"../../utils/getSatoshisAsTBTC\";\nimport {Tab, TabList, TabPanel, Tabs} from \"react-tabs\";\nimport {GetOperatorQuery} from \"../../generated/graphql\";\nimport {KeepsTable} from \"./KeepsTable\";\nimport {BeaconGroupsTable} from \"./BeaconGroupTable\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport {keepFormatter} from \"../../components/KeepValue\";\nimport {PageHeader} from \"../../components/PageHeader\";\nimport {HeaderBoxes} from \"../../components/HeaderBoxes\";\nimport {Hash} from \"../../components/Address\";\nimport {PageHeaderMenu} from \"../../components/PageHeaderMenu\";\nimport {useEtherscanDomain} from \"../../NetworkContext\";\nimport { useMemo } from \"react\";\nimport {useHistory} from \"react-router-dom\";\nimport OverviewTab from \"./OverviewTab\";\n\n\nconst OPERATOR_QUERY = gql`\n    query GetOperator($id: ID!, $block: Block_height) {\n        operator(id: $id, block: $block) {\n            id,\n            address,\n            bonded,\n            unboundAvailable,\n            stakedAmount,\n            totalFaultCount,\n            attributableFaultCount,\n            totalTBTCRewards,\n            beaconGroupMemberships(orderBy: groupCreatedAt, orderDirection: desc) {\n                count,\n                reward,\n                group {\n                    id,\n                    pubKey,\n                    createdAt,\n                }\n            },\n            stakedropRewardsDispensed,\n            stakedropECDSARewardsDispensed,\n            stakedropBeaconRewardsDispensed\n        }\n    }\n`;\n\n\nexport function Operator() {\n  return <div className={css`\n      padding: 1em;\n    `}>\n    <Helmet>\n      <title>Operator</title>\n    </Helmet>\n    <Content />\n  </div>\n}\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 2\n});\n\nconst formatterBTC = new Intl.NumberFormat(\"en-US\", {\n  maximumFractionDigits: 6\n});\n\n\nexport function Content() {\n  let { operatorId, tabId } = useParams<any>();\n  operatorId = operatorId.toLowerCase()\n  const history = useHistory();\n  const etherscan = useEtherscanDomain();\n  const { loading, error, data } = useQueryWithTimeTravel<GetOperatorQuery>(OPERATOR_QUERY, {variables: {id: operatorId}});\n\n  const TAB_IDS = [\"\", \"keeps\", \"beacongroups\"];\n  const activeTabIndex = useMemo(() => {\n    const activeTab = TAB_IDS.indexOf(tabId);\n    if (activeTab == -1) {\n      return 0;\n    }\n    return activeTab;\n  }, [tabId]);\n  const handleSelect = (index: number) => {\n    const id = TAB_IDS[index];\n    history.replace(`/operator/${operatorId}/${id}`)\n  }\n\n  if (loading) { return <p>Loading...</p>; }\n  if (error || !data) { return <p>Error :( {\"\"+ error}</p>; }\n  const operator = data.operator;\n  if (!operator) {\n    return <p>No such operator.</p>\n  }\n\n  const total = (parseFloat(operator.unboundAvailable) + parseFloat(operator.bonded));\n  const bonded = parseFloat(operator.bonded);\n\n  return <div>\n    <PageHeader label={<Hash hash={operator.address} />} subtitle={\"Operator\"} buttons={\n      <PageHeaderMenu>\n        <div><a href={`https://${etherscan}/address/${operator.address}`}>Open in Etherscan</a></div>\n      </PageHeaderMenu>\n    }>\n      <HeaderBoxes>\n        <Box label={\"bonded\"}>\n          <div>{formatter.format(operator.bonded)} ETH</div>\n\n          {total > 0 ? <div style={{fontSize: '20px', color: 'gray'}}>\n            {formatter.format((bonded / total * 100))}% of {formatter.format(total)} ETH\n          </div> : null}\n        </Box>\n\n        <Box label={\"available to bond\"}>\n          <div>\n            {formatter.format(operator.unboundAvailable)} ETH\n          </div>\n        </Box>\n\n        <Box label={\"staked\"}>\n          <div>\n            {formatter.format(operator.stakedAmount)} KEEP\n          </div>\n        </Box>\n\n        <Box label={\"faults\"} tooltip={\"How often this operator was involved in a signing group with improper behaviour. If two numbers, the first one counts how often this operator can be blamed for the fault.\"}>\n          <div>\n            {operator.attributableFaultCount > 0 ? <>\n              {operator.attributableFaultCount} / </> : null}\n            {operator.totalFaultCount}\n          </div>\n        </Box>\n\n        <Box label={\"fees\"}>\n          <div>\n            {formatterBTC.format(getSatoshiesAsTBTC(operator.totalTBTCRewards))} TBTC\n          </div>\n        </Box>\n\n        <Box label={\"rewards dispensed\"} tooltip={\"Stakedrop awards which have already been dispensed to this operator (whether withdrawn or not).\"}>\n          <div>\n            {keepFormatter.format(operator.stakedropRewardsDispensed / (10**18))} KEEP\n          </div>\n        </Box>\n      </HeaderBoxes>\n    </PageHeader>\n\n    <Tabs selectedIndex={activeTabIndex} onSelect={handleSelect}>\n      <TabList>\n        <Tab>\n          Overview\n        </Tab>\n        <Tab>\n          Keeps\n        </Tab>\n        <Tab>\n          Beacon Groups\n        </Tab>\n      </TabList>\n\n      <TabPanel>\n        <OverviewTab operatorId={operatorId} />\n      </TabPanel>\n      <TabPanel>\n        <Paper padding>\n          <h3 style={{marginTop: 0}}>Keeps</h3>\n          <KeepsTable operatorId={operatorId} />\n        </Paper>\n      </TabPanel>\n      <TabPanel>\n        <Paper padding>\n          <h3 style={{marginTop: 0}}>Random Beacon Groups</h3>\n          <BeaconGroupsTable memberships={operator.beaconGroupMemberships} />\n        </Paper>\n      </TabPanel>\n    </Tabs>\n  </div>\n}\n\n\n","/**\n * As long as at least one instance of this hooks mounted, we keep a connection to an electrum server open.\n * We close the connection once no component needs it anymore.\n */\nimport { useEffect, useState } from \"react\";\nimport BitcoinHelpers from \"./BitcoinHelpers\";\nimport ElectrumClient from \"./ElectrumClient\";\n\n\nBitcoinHelpers.setElectrumConfig({\n  \"server\": \"electrumx-server.tbtc.network\",\n  \"port\": 8443,\n  \"protocol\": \"wss\"\n})\n\n\nconst State: {\n  refCount: number,\n  state: 'connecting'|'connected'|'disconnected',\n  connectingPromise: Promise<any>|null,\n  client: ElectrumClient|null,\n  scheduledDisconnect?: number\n} = {\n  refCount: 0,\n  state: 'disconnected',\n  client: null,\n  connectingPromise: null\n}\n\n/**\n * Will return the current connection, or start a new one if necessary.\n */\nasync function acquireConnection() {\n  if (State.scheduledDisconnect) {\n    window.clearTimeout(State.scheduledDisconnect);\n  }\n\n  if (!State.client) {\n    if (BitcoinHelpers.electrumConfig === null) {\n      throw new Error(\"Electrum client not configured.\")\n    }\n    State.client = new ElectrumClient(BitcoinHelpers.electrumConfig);\n  }\n\n  State.refCount += 1;\n\n  // Connect the first time\n  if (State.state === 'disconnected') {\n    State.state = 'connecting';\n    State.connectingPromise = State.client.connect();\n  }\n\n  if (State.state === 'connecting') {\n    await State.connectingPromise;\n    if (State.state === 'connecting') {\n      State.state = 'connected';\n    }\n  }\n\n  return State.client;\n}\n\n\nfunction releaseConnection() {\n  State.refCount -= 1;\n\n  if (State.refCount == 0) {\n    State.scheduledDisconnect = window.setTimeout(() => {\n      // TODO: It seems if you try to reconnect immediately after this, it will not work. Enforce a timeout.\n      State.client?.close();\n      State.state = 'disconnected';\n      State.scheduledDisconnect = undefined;\n    }, 10000);\n  }\n}\n\n\nexport function useElectrumClient() {\n  const [client, setClient] = useState<null|ElectrumClient>(null);\n\n  useEffect(() => {\n    acquireConnection().then(client => {\n      setClient(client);\n    });\n    return () => {\n      releaseConnection();\n    }\n  }, [])\n\n  return client;\n}","import {useElectrumClient} from \"./useElectrumClient\";\nimport {useCallback, useEffect, useState} from \"react\";\nimport BitcoinHelpers from \"./BitcoinHelpers\";\nimport {useIsTimeTravel} from \"../TimeTravel\";\n\n\n/**\n * NB: Will disable itself if time travel mode is on.\n *\n * A bug:\n * - first findScript() does return null even though findorWaitfor() finds one.\n */\nexport function useBitcoinTxState(address: string, lotSizeSatoshis: number|string, isEnabled: boolean) {\n  const client = useElectrumClient();\n  const isTimeTravelMode = useIsTimeTravel();\n  const [txHash, setTxHash] = useState(\"\");\n  const [isInitialized, setInitialized] = useState(false);\n  const [confirmations, setConfirmations] = useState(0);\n  const lotSizeSatoshisInt = typeof lotSizeSatoshis === 'string' ? parseInt(lotSizeSatoshis) : lotSizeSatoshis;\n\n  const waitForTxAndConfirmations = useCallback(async (cancelToken: { set: boolean }) => {\n    let tx = await BitcoinHelpers.Transaction.findWithClient(client!, address, lotSizeSatoshisInt);\n    if (cancelToken.set) {\n      return;\n    }\n\n    if (!tx) {\n      setInitialized(true);\n\n      // Would be much nicer to get a cancel token from those helper functions\n      tx = await BitcoinHelpers.Transaction.findOrWaitFor(\n          client,\n          address,\n          lotSizeSatoshisInt\n      )\n    }\n    if (cancelToken.set) {\n      return;\n    }\n\n    setTxHash(tx.transactionID);\n\n    // Now ensure we have enough confirmations\n    let confirmations = await BitcoinHelpers.Transaction.checkForConfirmations(client, tx.transactionID, 0);\n    if (cancelToken.set) {\n      return;\n    }\n\n    setConfirmations(confirmations!);\n    setInitialized(true);\n\n    return BitcoinHelpers.Transaction.waitForConfirmations(\n        client,\n        tx.transactionID,\n        6,\n        ({transactionID, confirmations, requiredConfirmations}) => {\n          setConfirmations(confirmations);\n        });\n  }, [address, lotSizeSatoshisInt, setConfirmations, setTxHash, client]);\n\n  useEffect(() => {\n    if (!address || !lotSizeSatoshisInt || !isEnabled || !client || isTimeTravelMode) {\n      return;\n    }\n\n    const cancelToken: any = {set: false, unsubscribe: null};\n    waitForTxAndConfirmations(cancelToken).then(unsubscribe => {\n      cancelToken.unsubscribe = unsubscribe;\n    });\n    return () => {\n      cancelToken.set = true;\n      if (cancelToken.unsubscribe) {\n        cancelToken.unsubscribe();\n      }\n    }\n  }, [address, lotSizeSatoshisInt, client, isEnabled, isTimeTravelMode]);\n\n  // isInitialized makes sure we do not return \"no tx\" if we really don't know yet.\n  return isInitialized ? {\n    hasTransaction: !!txHash,\n    transactionHash: txHash,\n    numConfirmations: confirmations\n  } : null;\n}","import BitcoinHelpers from \"./BitcoinHelpers\";\n\nexport function useBtcAddressFromPublicKey(publicKey: string) {\n  return publicKey ? BitcoinHelpers.Address.publicKeyToP2WPKHAddress(publicKey.slice(2), \"main\") : \"\";\n}","import React from 'react';\n\nconst Loading = ({ className, ...props }: any) => (\n    <svg width={\"1em\"} height={\"1em\"} stroke=\"black\" viewBox=\"0 0 38 38\" className={`svg-loaders-svg${className ? ` ${className}` : ''}`} {...props}>\n      <g\n          transform=\"translate(1 1)\"\n          strokeWidth={2}\n          fill=\"none\"\n          fillRule=\"evenodd\"\n      >\n        <circle strokeOpacity={0.5} cx={18} cy={18} r={18} />\n        <path d=\"M36 18c0-9.94-8.06-18-18-18\">\n          <animateTransform\n              attributeName=\"transform\"\n              type=\"rotate\"\n              from=\"0 18 18\"\n              to=\"360 18 18\"\n              dur=\"1s\"\n              repeatCount=\"indefinite\"\n          />\n        </path>\n      </g>\n    </svg>\n);\n\n\nexport { Loading };","import {css} from \"emotion\";\nimport React, {useCallback} from \"react\";\n\nexport function Button(props: {\n  type?: 'primary'|'secondary',\n  size?: 'default'|'small'|'tiny',\n  to?: any,\n  onClick?: any,\n  children?: any\n}) {\n  const handleClick = useCallback((e: any) => {\n    if (props.onClick) {\n      e.preventDefault();\n      props.onClick();\n    }\n  }, [props.onClick]);\n\n  let Component: any;\n  let extraProps: any = {};\n  if (props.to) {\n    Component = \"a\"\n    extraProps.href = props.to;\n  }\n  else {\n    Component = \"button\";\n  }\n\n  let fontSize = 16;\n  let paddingFactor = 1;\n  if (props.size === 'small') {\n    fontSize = 13;\n  }\n  else if (props.size === 'tiny') {\n    fontSize = 11;\n    paddingFactor = 0.8;\n  }\n\n  return <Component className={css`\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    outline: none;\n    display: inline-block;\n    text-decoration: none;\n    &:visited {\n      color: inherit;\n    }\n    &:hover {\n      text-decoration: none;\n    }\n    cursor: pointer;\n    \n    font-family: Work Sans;\n    font-weight: 500;    \n    line-height: 1.2;\n        \n    background: #FFFFFF;    \n    border: 1px solid #0A0806;    \n    color: #0A0806;\n\n    text-transform: uppercase;\n    \n    position: relative;\n    &::after {\n      content: '';\n      position: absolute;\n      height: 5px;\n      background: #0A0806;\n      bottom: 0px;\n      left: 0px;\n      right: 0px;\n      display: none;\n    }    \n    &:hover {\n      border-bottom-color: #0A0806;\n      ::after {\n        background: #0A0806;\n        display: block;      \n      }\n    }\n    &:active{\n      border-bottom-color: #48DBB4;\n      ::after {\n        background: #48DBB4;\n        display: block;      \n      }\n    }\n    \n    font-size: ${fontSize}px;\n    padding: ${0.9 * paddingFactor}em ${1.2 * paddingFactor}em;\n  `}\n      {...extraProps}\n      onClick={handleClick}\n  >\n    {props.children}\n  </Component>\n}","import {DateTime} from \"luxon\";\nimport {dateTimeFrom, formatSeconds} from \"../components/FormattedTime\";\nimport {getSatoshisAsBitcoin} from \"./getSatoshisAsBitcoin\";\nimport {getWeiAsEth} from \"./getWeiAsEth\";\nimport {CoinPrices} from \"./useCoinPrices\";\nimport {gql} from \"@apollo/client\";\nimport {AuctionDetailsFragment as AuctionDetailsF} from \"../generated/graphql\";\n\n/**\n * Note: The real `auctionValue` function uses address(this), which could be different than the registered bond value?\n */\nconst AUCTION_DURATION = 24 * 60 * 60; // seconds\n\n\n/**\n * Calculate the liquidation auction details. This reproduces the math from within the contract.\n *\n * Returns the state of the auction either at the current time, or the given `endDate`.\n */\nexport function getAuctionDetails(opts: {\n  bondValue: number,\n  liquidationInitiated: number,\n  initialCollateralizedPercent: number,\n  endDate?: number\n}) {\n  const endDate = opts?.endDate ? dateTimeFrom(opts.endDate) : DateTime.utc();\n  const elapsed = endDate.diff(dateTimeFrom(opts.liquidationInitiated)).as('seconds');\n  const available = opts.bondValue;\n\n  if (elapsed > AUCTION_DURATION) {\n    return {value: available, percentage: 100};\n  }\n\n  // This should make a smooth flow from base% to 100%\n  const basePercentage = Math.floor(10000 / opts.initialCollateralizedPercent);\n  const elapsedPercentage = Math.floor((100 - basePercentage) * elapsed / AUCTION_DURATION);\n  const percentage = basePercentage + elapsedPercentage;\n\n  return {\n    percentage,\n    value: available * percentage / 100,\n\n    // Return the next jump in bond on auction.\n    nextValue: percentage == 100 ? null : available * (percentage + 1) / 100,\n    //nextTime: 0,\n  }\n}\nexport type AuctionDetails = ReturnType<typeof getAuctionDetails>;\n\n\nexport const AuctionDetailsFragment = gql`\n    fragment AuctionDetails on Deposit {\n        initialCollateralizedPercent,\n        depositLiquidation {\n            liquidationInitiated,\n            liquidatedAt\n        },\n        bondedECDSAKeep {\n            totalBondAmount\n        }\n    }\n`;\n\n/**\n * Return the details of the auction based on a standard deposit query object.\n */\nexport function getAuctionDetailsFromDeposit(deposit: AuctionDetailsF) {\n  return getAuctionDetails({\n    initialCollateralizedPercent: deposit.initialCollateralizedPercent!,\n    liquidationInitiated: deposit.depositLiquidation!.liquidationInitiated!,\n    bondValue: deposit.bondedECDSAKeep?.totalBondAmount,\n    endDate: deposit.depositLiquidation?.liquidatedAt\n  });\n}\n\nexport function calculateAuctionUSDValues(value: AuctionDetails, coinPrices: CoinPrices, opts: {lotSizeSatoshis: number}) {\n  const btcPrice = coinPrices.bitcoin!;\n  const ethPrice = coinPrices.ethereum!;\n  const cost = getSatoshisAsBitcoin(opts.lotSizeSatoshis) * btcPrice;\n  const income = ethPrice * getWeiAsEth(value.value);\n  const nextIncome = ethPrice * getWeiAsEth(value.nextValue ?? 0);\n\n  return {\n    usdProfit: income - cost,\n    usdProfitNext: nextIncome - cost,\n    yieldPercent: (income - cost) / cost\n  }\n}\n\nconst COURTESY_CALL_DURATION = 6 * 60 * 60; // seconds\n\nexport function getCourtesyCallExpiryDate(deposit: any) {\n  if (!deposit.depositLiquidation?.courtesyCallInitiatedAt) {\n    return \"\";\n  }\n  const endDate = dateTimeFrom(parseInt(deposit.depositLiquidation?.courtesyCallInitiatedAt) + COURTESY_CALL_DURATION);\n  const d = DateTime.utc().diff(endDate);\n  return formatSeconds(d.as('seconds'));\n}","import {Address, BitcoinAddress} from \"../../components/Address\";\nimport React from \"react\";\nimport BitcoinHelpers from \"../../utils/BitcoinHelpers\";\nimport { gql } from '@apollo/client';\nimport {GetDepositLogsQuery} from \"../../generated/graphql\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport {AuctionDetailsFragment, getAuctionDetailsFromDeposit} from \"../../utils/getAuctionDetails\";\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {LogTitle, LogEntry} from \"../../components/Log\";\n\nexport function Log(props: {\n  depositId: string\n}) {\n  const {loading, error, data} = useQueryWithTimeTravel<GetDepositLogsQuery>(gql`\n      query GetDepositLogs($depositId: String!, $block: Block_height)\n      {\n          events(where: {deposit: $depositId}, orderBy: timestamp, orderDirection: desc, block: $block) {\n              __typename,\n              id,\n              transactionHash,\n              submitter,\n              timestamp,\n\n              ...on RegisteredPubKeyEvent {\n                  signingGroupPubkeyX,\n                  signingGroupPubkeyY\n              }\n              \n              ...on StartedLiquidationEvent {\n                  cause\n              },\n\n              ...on RedemptionRequestedEvent {\n                  redeemerOutputScript,\n                  requestedFee\n              },\n\n              ...on LiquidatedEvent {\n                  deposit {\n                      ...AuctionDetails\n                  }\n              },\n\n              ...on SetupFailedEvent {\n                  reason,\n                  deposit {\n                      bondedECDSAKeep {\n                          pubkeySubmissions { address },\n                          members { address }\n                      }\n                  }\n              }\n          }\n      }\n      \n      ${AuctionDetailsFragment}\n  `, {variables: {depositId: props.depositId}});\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :( {\"\" + error}</p>;\n\n  return <>\n    {data!.events.map((logEntry: any) => {\n      return <LogEntry key={logEntry.id} event={logEntry} Components={LogComponents} />\n    })}\n  </>\n}\n\n\nconst LogComponents = {\n  'CreatedEvent': CreatedEvent,\n  'RegisteredPubKeyEvent': RegisteredPubKeyEvent,\n  'FundedEvent': FundedEvent,\n  'StartedLiquidationEvent': StartedLiquidationEvent,\n  'RedemptionRequestedEvent': RedemptionRequestedEvent,\n  'GotRedemptionSignatureEvent': GotRedemptionSignatureEvent,\n  'RedeemedEvent': RedeemedEvent,\n  'SetupFailedEvent': SetupFailedEvent,\n  'LiquidatedEvent': LiquidatedEvent,\n  'CourtesyCalledEvent': CourtesyCalledEvent,\n  'ExitedCourtesyCallEvent': ExitedCourtesyCallEvent,\n};\n\n\nfunction CreatedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Deposit created</LogTitle>\n    <div>\n      <Address address={props.event.submitter}/> created a new deposit.\n    </div>\n    <div style={{color: 'gray', fontSize: '0.9em', marginTop: '7px'}}>\n      A random group of nodes (called the signers) will now be selected to collateralize and hold the\n      Bitcoin.\n    </div>\n  </div>\n}\n\nfunction RegisteredPubKeyEvent(props: {\n  event: any\n}) {\n  // Triggered when retrieveSignerPubkey() is called\n  // TODO: Can we get this earlier?\n\n  const event = props.event;\n  const address = BitcoinHelpers.Address.publicKeyPointToP2WPKHAddress(event.signingGroupPubkeyX, event.signingGroupPubkeyY, \"main\");\n\n  return <div>\n    <LogTitle>Bitcoin address provided</LogTitle>\n    <div>\n      Signers have provided a Bitcoin address to receive the funds: <BitcoinAddress address={address}/>\n    </div>\n    <div style={{color: 'gray', fontSize: '0.9em', marginTop: '7px'}}>\n      The depositor must now send the chosen amount of Bitcoin to this address, then provide proof that they did so.\n    </div>\n  </div>\n}\n\nfunction FundedEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Funded</LogTitle>\n    <div>\n      Proof has been submitted that the Bitcoin have been sent to the address provided, and the deposit is now active.\n    </div>\n  </div>\n}\n\n// Triggered via VM.tbtcToBtc(), or Deposit.transferAndRequestRedemption()\nfunction RedemptionRequestedEvent(props: {\n  event: any\n}) {\n  const address = BitcoinHelpers.Address.fromScript(props.event.redeemerOutputScript);\n\n  return <div>\n    <LogTitle>Redemption Requested</LogTitle>\n    <div>\n      <Address address={props.event.submitter}/> paid back the TBTC tokens to the system and is asking for\n      the deposited bitcoin to be sent to <BitcoinAddress address={address} />.\n    </div>\n  </div>\n}\n\nexport function getLiquidationCauseAsString(cause: string) {\n  return ({\n    'FRAUD': 'Signer Fraud',\n    'PROOF_TIMEOUT': 'Signer Timeout',\n    'SIGNATURE_TIMEOUT': 'Signer Timeout',\n    'UNDERCOLLATERIZED': 'Undercollaterialized',\n    'COURTESY_CALL_EXPIRED': 'Undercollaterialized'\n  } as any)[cause] || cause;\n}\n\nfunction StartedLiquidationEvent(props: {\n  event: any\n}) {\n  const {cause} = props.event;\n  const title: string = getLiquidationCauseAsString(cause);\n\n  const description: string = ({\n    'FRAUD': 'One of the signers submitted a fraudulent signature.',\n    'PROOF_TIMEOUT': 'The signing group failed to submit proof that their transaction, releasing the deposited Bitcoin, was included in the blockchain.',\n    'SIGNATURE_TIMEOUT': 'The signing group failed to provide a signature for a transaction releasing the Bitcoin.',\n    'UNDERCOLLATERIZED': 'The deposit became undercollateralized due to the value of the backing ETH bond falling.',\n    'COURTESY_CALL_EXPIRED': 'The deposit became undercollateralized due to the value of the backing ETH bond falling. It was courtesy called earlier, but the courtesy call expired.'\n  } as any)[cause];\n\n  return <div>\n    <LogTitle>Liquidation Started: {title}</LogTitle>\n    <div>\n      {description}\n    </div>\n    <div style={{color: 'gray', fontSize: '0.9em', marginTop: '7px'}}>\n      The system now runs a falling-price auction, selling the ETH collateral backing the deposit.\n    </div>\n  </div>\n}\n\nfunction LiquidatedEvent(props: {\n  event: any\n}) {\n  const details = getAuctionDetailsFromDeposit(props.event.deposit);\n  return <div>\n    <LogTitle>Liquidated</LogTitle>\n    <div>\n      <Address address={props.event.submitter}/> bought {details.percentage}% (<ETHValue wei={details.value} /> ETH) of the collateral.\n    </div>\n  </div>\n}\n\n\nfunction CourtesyCalledEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Courtesy Call</LogTitle>\n    {/*submitted by XXX */}\n    <div>\n      The deposit has been notified that is undercollateralized.\n    </div>\n    <div style={{color: 'gray', fontSize: '0.9em', marginTop: '7px'}}>\n      The value of the backing collateral has fallen, and now covers less than the required 125% of\n      the Bitcoin deposited. Anyone is now able to start the redemption process. If the deposit is not redeemed\n      within 6 hours, or regains the required collaterialization ratio, liquidation proceedings will be started.\n    </div>\n  </div>\n}\n\nfunction ExitedCourtesyCallEvent(props: {\n  event: any\n}) {\n  return <div>\n    <LogTitle>Courtesy Call Exited</LogTitle>\n    <div>\n      The deposit regained the required collaterialization ratio and is no longer in danger\n      of being liquidated.\n    </div>\n  </div>\n}\n\nfunction SetupFailedEvent(props: {\n  event: any\n}) {\n  let content: any;\n  if (props.event.reason == 'FUNDING_TIMEOUT' || props.event.reason == 'SIGNER_SETUP_FAILED_DEPOSITOR') {\n    content = <>\n      <LogTitle>Failed: Not funded</LogTitle>\n      <div>\n        The depositor did not send the required amount of Bitcoin to the deposit address,\n        and the deposit has now timed out.\n      </div>\n      {/*<div style={{color: 'gray', fontSize: '0.9em'}}>*/}\n      {/*  The depositor has 3 hours to send the desired amount of Bitcoins to the address provided by the signers.*/}\n      {/*  Failure to do so, as*/}\n      {/*</div>*/}\n    </>\n  }\n  else if (props.event.reason == 'SIGNER_SETUP_FAILED') {\n    const allSigners = props.event.deposit.bondedECDSAKeep.members.map((s: any) => s.address);\n    const goodSigners = new Set(props.event.deposit.bondedECDSAKeep.pubkeySubmissions.map((s: any) => s.address));\n    const badSigners: string[] = allSigners.filter((s: any) => !goodSigners.has(s));\n\n    content = <>\n      <LogTitle>Failed: Signer Setup</LogTitle>\n      <div>\n        The signers failed to coordinate to provide a Bitcoin deposit address. Specifically, nothing was\n        submitted by the following signer(s): {badSigners\n          .map(\n            address => <Address key={address} to={`/operator/${address}`} address={address} />)\n          .reduce((prev, curr) => [prev, ', ', curr] as any)}\n      </div>\n      {/*<div style={{color: 'gray', fontSize: '0.9em'}}>*/}\n      {/*  The depositor has 3 hours to send the desired amount of Bitcoins to the address provided by the signers.*/}\n      {/*  Failure to do so, as*/}\n      {/*</div>*/}\n    </>\n  }\n  else {\n    content = <>\n      <LogTitle>Setup Failed</LogTitle>\n      <div>\n        Reason: {props.event.reason}\n      </div>\n    </>\n  }\n  return <div>\n    {content}\n  </div>\n}\n\nfunction GotRedemptionSignatureEvent(props: {\n  event: any\n}) {\n  // Signers call provideRedemptionSignature(). They provide a signature over a pay-out transaction that would\n  // release the funds.\n  return <div>\n    <LogTitle>\n      Signers provided a redemption signature\n    </LogTitle>\n    <div>\n      The signers provided a signature for the redemption Bitcoin transaction.\n    </div>\n  </div>\n}\n\nfunction RedeemedEvent(props: {\n  event: any\n}) {\n  // # Triggered when provideRedemptionProof() is called - confirmations\n  return <div>\n    <LogTitle>Redeemed</LogTitle>\n    <div>\n      Proof was submitted that the signers have paid the held Bitcoin to the requested withdrawal address.\n    </div>\n  </div>\n}","import {getNiceStateLabel, getStateTooltip, useTimeRemaining} from \"../../utils/depositStates\";\nimport {css} from \"emotion\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {hasDepositBeenUsedToMint} from \"../../utils/contracts\";\nimport {TBTCIcon} from \"../../design-system/tbtcIcon\";\nimport {ExternalLinkIcon} from \"../../components/ExternalLinkIcon\";\nimport {Loading} from \"../../components/Loading\";\nimport {Box} from \"../../components/Box\";\nimport React, {useState} from \"react\";\nimport {useBitcoinTxState} from \"../../utils/useBitcoinTxState\";\nimport {useBlockchainBaseUrl, useDAppDomain} from \"../../NetworkContext\";\nimport {useBtcAddressFromPublicKey} from \"../../utils/useBtcAddressFromPublicKey\";\nimport {useWallet} from \"use-wallet\";\nimport {Button} from \"../../design-system/Button\";\nimport {getLiquidationCauseAsString} from \"./log\";\nimport {formatSeconds} from \"../../components/FormattedTime\";\nimport {useIsTimeTravel} from \"../../TimeTravel\";\n\n/**\n * Displays the deposit status in a <Box />.\n */\nexport function StatusBox(props: {\n  deposit: any,\n  noPadding?: boolean\n}) {\n  const {deposit} = props;\n  const blockChainBaseUrl = useBlockchainBaseUrl();\n  const dAppDomain = useDAppDomain();\n  const btcAddress = useBtcAddressFromPublicKey(deposit.bondedECDSAKeep.publicKey);\n  const isTimeTravel = useIsTimeTravel();\n  const shouldShowConfirmationInfo = !isTimeTravel && deposit.currentState == 'AWAITING_BTC_FUNDING_PROOF';\n  const btcTxState = useBitcoinTxState(btcAddress, deposit.lotSizeSatoshis, shouldShowConfirmationInfo)\n  const timing = useTimeRemaining(deposit);\n\n  // Secondary information/actions shown below the status.\n  let secondLine: any;\n  if (['LIQUIDATED', 'LIQUIDATION_IN_PROGRESS', 'FRAUD_LIQUIDATION_IN_PROGRESS'].indexOf(deposit.currentState) > -1) {\n      secondLine = <span style={{fontSize: 20, flex: 1, color: 'gray'}}>\n        {getLiquidationCauseAsString(deposit.depositLiquidation.cause)}\n      </span>;\n  }\n\n  else if (shouldShowConfirmationInfo) {\n    if (!btcTxState) {\n      // wait until it is loaded\n      secondLine = null;\n    }\n    else {\n      let action: any;\n      if (btcTxState.hasTransaction && btcTxState.numConfirmations >= 6) {\n        action = <Button size={\"tiny\"} to={`https://${dAppDomain}/deposit/${deposit.contractAddress}/pay/confirming`}>Go to dApp</Button>;\n      }\n      else if (timing === undefined) {\n        action = null;\n      }\n      else if ((timing?.remaining ?? 0) > 0) {\n        action = <span style={{fontSize: 20, flex: 1, color: 'gray', textAlign: 'right'}}>\n          {formatSeconds(timing?.remaining!)} <InfoTooltip size={0.8}>When this timer reaches zero, anyone can close the deposit, returning the bonded funds to the signers.</InfoTooltip>\n        </span>\n      }\n      else {\n        action = <NotifyButton deposit={deposit} />;\n      }\n      secondLine = <>\n        <span style={{fontSize: 20, flex: 1, color: 'gray'}}>\n          {btcTxState.hasTransaction\n              ? <>{btcTxState?.numConfirmations} confirmations</>\n              : <>waiting for transaction</>}\n\n          <a\n              title={\"Open on blockchain.com\"}\n              href={\n                btcTxState.transactionHash\n                    ? `${blockChainBaseUrl}/tx/${btcTxState.transactionHash}`\n                    : `${blockChainBaseUrl}/address/${btcAddress}`\n              }\n              className={css`\n                font-size: 0.8em;\n                padding-left: 0.2em;\n             `}\n          >\n            <ExternalLinkIcon/>\n          </a>\n\n          <span style={{fontSize: 12, paddingLeft: 5}}><Loading/></span>\n        </span>\n        {action}\n      </>;\n    }\n  }\n\n  return <Box label={\"state\"}>\n    <LabelWithBackgroundProgress\n        progress={timing?.percentage}\n    >\n      {getNiceStateLabel(deposit)} {getStateTooltip(deposit.currentState)\n        ? <span className={css`position: relative; top: -0.5em; font-size: 0.6em;`}><InfoTooltip>{getStateTooltip(deposit.currentState)}</InfoTooltip></span>\n        : null}\n    </LabelWithBackgroundProgress>\n\n    {\n      hasDepositBeenUsedToMint(deposit.tdtToken.owner, deposit.currentState)\n          ? <div className={css`\n                  font-size: 0.6em;\n                  display: flex;\n                  flex-direction: row;\n                  align-items: center;\n              ` }>\n            <TBTCIcon /> <span style={{paddingLeft: 5}}>TBTC minted</span>\n          </div>\n          : null\n    }\n\n    {\n      <div style={{lineHeight: 1, alignItems: 'center', display: 'flex', flexDirection: 'row', marginTop: '5px'}}>\n        {secondLine}\n      </div>\n    }\n  </Box>\n}\n\n\nexport function LabelWithBackgroundProgress(props: {\n  children: any,\n  singleColor?: string,\n  progress: number|undefined,\n}) {\n  if (props.progress === undefined) {\n    return props.children;\n  }\n\n  let color: string = '';\n  if (props.singleColor) {\n    color = props.singleColor;\n  }\n  else if (props.progress <= 0.5) {\n    color = '#d3f7ce';\n  }\n  else if (props.progress <= 0.8) {\n    color = '#f7e4ce';\n  }\n  else {\n    color = '#f7cece';\n  }\n\n  return <div style={{\n    position: 'relative',\n    zIndex: 1,\n    backgroundColor: 'whitesmoke'\n  }}>\n    {props.children}\n    <div style={{\n      position: 'absolute',\n      backgroundColor: color,\n      left: 0,\n      top: 0,\n      bottom: 0,\n      width: `${props.progress * 100}%`,\n      zIndex: -4\n    }}>\n    </div>\n  </div>\n}\n\n\nconst depositAbi = [\n  \"function notifyFundingTimedOut()\",\n  \"function notifySignerSetupFailed()\"\n];\n\n\n/**\n * Show a notification button for this deposit.\n */\nfunction NotifyButton(props: {\n  deposit: any\n}) {\n  const isTimeTravel = useIsTimeTravel();\n  const wallet = useWallet()\n  const deposit = props.deposit;\n  const [isBusy, setBusy] = useState(false);\n\n  if (isTimeTravel) {\n    return null;\n  }\n\n  let func: string;\n  if (deposit.currentState == 'AWAITING_SIGNER_SETUP') {\n    func = 'notifySignerSetupFailed';    \n    if (deposit?.bondedECDSAKeep?.publicKey) {\n      // Here, we have to call retrieveSignerPubkey first\n      return null;\n    }\n  } else if (deposit.currentState == 'AWAITING_BTC_FUNDING_PROOF') {    \n    func = 'notifyFundingTimedOut';\n  }\n  else {\n    return null;\n  }\n\n  return <Button size={\"tiny\"} onClick={async () => {\n    setBusy(true)\n    try {\n      const ethers = await import(\"ethers\");\n\n      // This is what shoes the metamask popup (could support different providers)\n      // await returns only when the user took action, but unfortunately it does not tell us the result\n      // (we'd have to wait for a state update).\n      await wallet.connect(\"injected\")\n\n      // TODO: We should use wallet.ethereum here I think, but again, it is not filled until the\n      // component re-renders.\n      const provider = new ethers.providers.Web3Provider((window as any).ethereum as any);\n\n      const contract = new ethers.Contract(deposit.contractAddress, depositAbi, provider);\n      const daiWithSigner = contract.connect(provider.getSigner());\n\n      // gas estimation fails, why?\n      //alert(await daiWithSigner.estimateGas.notifyFundingTimedOut());\n\n      // limit based on: https://etherscan.io/tx/0x35d1a7e9d25bb1aefb4a0ed5237854a12440a4748091b9f16474b7a2d5ac5251, but can vary widely, I also saw 246,750\n      const tx = await daiWithSigner[func]({gasLimit: 593800})\n      const receipt = await tx.wait();\n    }\n    finally {\n      setBusy(false)\n    }\n  }}>\n    Notify Timeout {isBusy ? <Loading /> : <InfoTooltip>\n    If the deposit process was not completed in time. Notifying the contract of this will release\n    the bonded funds back to the signers.\n  </InfoTooltip>}\n  </Button>\n}\n\n","import Tippy, {useSingleton} from \"@tippyjs/react\";\nimport {css} from \"emotion\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {TimeBetween, TimeToNow} from \"../../components/FormattedTime\";\nimport {ExternalLinkIcon} from \"../../components/ExternalLinkIcon\";\nimport {getSatoshisAsBitcoin} from \"../../utils/getSatoshisAsBitcoin\";\nimport {\n  getNiceStateLabel,\n  getStateBoxStyle,\n  useTimeRemaining\n} from \"../../utils/depositStates\";\nimport {hasDepositBeenUsedToMint} from \"../../utils/contracts\";\nimport {TBTCIcon} from \"../../design-system/tbtcIcon\";\nimport React from \"react\";\nimport {CollaterizationStatusWithPrice} from \"../../components/CollateralizationStatus\";\nimport {usePriceFeed} from \"../../components/PriceFeed\";\nimport {SortableHeader, Table, useSort} from \"../../components/Table\";\nimport {useEtherscanDomain} from \"../../NetworkContext\";\nimport {useBitcoinTxState} from \"../../utils/useBitcoinTxState\";\nimport {useBtcAddressFromPublicKey} from \"../../utils/useBtcAddressFromPublicKey\";\nimport {LabelWithBackgroundProgress} from \"../Deposit/StatusBox\";\nimport {BTCTag} from \"../../components/CurrencyTags\";\nimport {UseDepositQuery} from \"./Views\";\nimport {Address} from \"../../components/Address\";\nimport {SkeletonTableRow} from \"../../components/SkeletonLoader\";\n\n\nexport function DepositsTable(props: {\n  query: UseDepositQuery\n}) {\n  const {loading, error, dateColumn, sortState, data} = props.query;\n  const [source, target] = useSingleton();\n  const price = usePriceFeed();\n  const etherscan = useEtherscanDomain();\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  const dateColumnTitle = (dateColumn == \"updatedAt\") ? \"Updated\"\n      : (dateColumn == \"redemptionStartedAt\") ? \"Started\"\n          : \"Created\";\n  const dateColumnTooltip = (dateColumn == \"updatedAt\") ?\n      \"When this deposit last changed state, during the funding, redemption or liquidation processes.\"\n      : (dateColumn == \"redemptionStartedAt\") ? \"When the redemption process, or liquidation, started.\"\n          : \"When this deposit was created.\";\n\n\n  return <>\n    <Tippy singleton={source} delay={500} />\n    <Table\n        style={{width: '100%'}}\n    >\n      <thead>\n      <tr>\n        <th>\n          <SortableHeader fieldId={dateColumn} state={sortState}>\n            {dateColumnTitle} <InfoTooltip>\n              {dateColumnTooltip}\n            </InfoTooltip>\n          </SortableHeader>\n        </th>\n        <th>\n          Contract <InfoTooltip>\n          Every deposit is represented on-chain by a contract.\n        </InfoTooltip>\n        </th>\n        <th>\n          <SortableHeader fieldId={\"lotSizeSatoshis\"} state={sortState}>Lot Size</SortableHeader>\n        </th>\n        <th>\n          State\n        </th>\n        <th>\n          <SortableHeader fieldId={\"etcToBtcRatio\"} state={sortState}>\n            C-Ratio <InfoTooltip>\n            The current collateralization ratio, or for completed deposits, the ratio at the time of completion.\n          </InfoTooltip>\n          </SortableHeader>\n        </th>\n        <th>\n          Actor <InfoTooltip>\n            Either the creator of the redeemer, depending on the current process of the deposit.\n          </InfoTooltip>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      {props.query.loading ? <SkeletonTableRow columns={6} /> : null}\n      {data?.deposits.map((deposit: any) => {\n        return <DepositRow\n          deposit={deposit}\n          key={deposit.id}\n          dateColumn={dateColumn}\n          etherscan={etherscan}\n          price={price}\n          target={target}\n        />\n      })}\n      </tbody>\n    </Table>\n  </>;\n}\n\nconst DepositRow = React.memo((props: {\n  deposit: any,\n  dateColumn: string,\n  etherscan: string,\n  price: any,\n  target: any\n}) => {\n  const {deposit, dateColumn, etherscan, price, target} = props;\n  return  <tr key={deposit.id}>\n    <td>\n      <TimeToNow time={deposit[dateColumn]} />\n    </td>\n    <td>\n      <Address address={deposit.contractAddress} to={`/deposit/${deposit.contractAddress}`} />\n      <a title={\"Open on Etherscan\"} href={`https://${etherscan}/address/${deposit.contractAddress}`} className={css`\n                font-size: 0.8em;\n                padding-left: 0.2em;\n               `}>\n        <ExternalLinkIcon />\n      </a>\n    </td>\n    <td>\n      <BTCTag />&nbsp;{getSatoshisAsBitcoin(deposit.lotSizeSatoshis ?? 0)}\n    </td>\n    <td className={css`\n            display: flex;\n            align-items: center;\n          `}>\n      <div className={css`\n              display: inline-block;\n              width: 1.2em;\n              height: 1.2em;\n              border-radius: 2px;\n              padding: 0.2em;\n              box-sizing: border-box;\n            `} style={getStateBoxStyle(deposit.currentState)}>\n      </div>\n      &nbsp;\n      {hasDepositBeenUsedToMint(deposit.tdtToken.owner, deposit.currentState)\n          ? <><Tippy content=\"TBTC was minted\" singleton={target}><TBTCIcon /></Tippy>&nbsp;</>\n          : \"\"\n      }\n      <StateLabelWithProgressBar deposit={deposit} />\n\n      <FundingStatus deposit={deposit}/>\n    </td>\n    <td>\n      <CollaterizationStatusWithPrice deposit={deposit} price={price} />\n    </td>\n    <td>\n      <Address address={deposit.lastActor} />\n    </td>\n    {/*<td>*/}\n    {/*  <TimeBetween earlier={deposit.createdAt} later={deposit.redemptionStartedAt} />*/}\n    {/*</td>*/}\n  </tr>\n});\n\n\nexport function StateLabelWithProgressBar(props: {\n  deposit: any\n}) {\n  const timing = useTimeRemaining(props.deposit, 5);\n  return <LabelWithBackgroundProgress\n      progress={timing?.percentage}\n  >\n    {getNiceStateLabel(props.deposit)}\n  </LabelWithBackgroundProgress>\n}\n\n\nfunction FundingStatus(props: {\n  deposit: any\n}) {\n  const btcAddress = useBtcAddressFromPublicKey(props.deposit.bondedECDSAKeep.publicKey);\n  const isEnabled = !!btcAddress && props.deposit.currentState == 'AWAITING_BTC_FUNDING_PROOF'\n  const state = useBitcoinTxState(btcAddress, props.deposit.lotSizeSatoshis ?? 0, isEnabled);\n  return isEnabled ? <>\n    {state?.hasTransaction ? <>\n      <span style={{color: 'silver', fontSize: '.8em', paddingLeft: '5px'}}>({state.numConfirmations}/6)</span>\n    </>: null}\n  </> : null;\n}","import {DateTime} from \"luxon\";\nimport {gql, useQuery} from \"@apollo/client\";\nimport {NiceStateLabel} from \"../../utils/depositStates\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\nimport {SortState, useSort} from \"../../components/Table\";\nimport {useEffect, useLayoutEffect, useState} from \"react\";\n\nexport type DepositViewID =\n    ''\n    | 'active'\n    | 'liquidations'\n    | 'redeemable'\n    | 'unminted'\n    | 'operations'\n    | 'redemptions'\n    | 'notifiable';\n\n\nexport const Views: {\n  id: DepositViewID,\n  label: string,\n  description: string,\n  title?: string,\n  action?: \"make\"\n}[] = [\n  {\n    id: \"\",\n    label: \"All Deposits\",\n    description: \"All deposits managed by the system.\",\n    title: \"Deposits\",\n    action: \"make\"\n  },\n\n  {\n    id: \"operations\",\n    label: \"Deposit Operations\",\n    description: \"Bitcoins entering the system.\",\n    action: \"make\"\n  },\n\n  {\n    id: \"redemptions\",\n    label: \"Redemption Operations\",\n    description: \"Bitcoins being taken out of the system.\"\n  },\n\n  {\n    id: \"liquidations\",\n    label: \"Liquidations & Signer Misbehaviour\",\n    description: \"The interesting stuff.\"\n  },\n\n  {\n    id: \"redeemable\",\n    label: \"Redeemable\",\n    description: \"Deposits available for redemption by anyone.\"\n  },\n\n  {\n    id: \"unminted\",\n    label: \"Unminted TDTs\",\n    description: \"Deposits which custody Bitcoin, but no TBTC has been minted.\"\n  },\n\n  {\n    id: \"notifiable\",\n    label: \"Notifiable Deposits\",\n    description: \"Deposits whose current state has timed out and can be notified.\"\n  },\n]\n\n\nconst DEPOSITS_QUERY = gql`\n    query GetDeposits(\n        $where: Deposit_filter, $orderBy: Deposit_orderBy, $skip: Int, \n        $block: Block_height, $orderDirection: OrderDirection,\n        $perPage: Int\n    ) {\n        deposits(\n            first: $perPage,\n            skip: $skip,\n            orderBy: $orderBy,\n            orderDirection: $orderDirection\n            where: $where,\n            block: $block\n        ) {\n            id,\n            contractAddress,\n            lotSizeSatoshis,\n            currentState,\n            keepAddress,\n            updatedAt,\n            createdAt,\n            redemptionStartedAt,\n            currentStateTimesOutAt,\n            creator,\n            lastActor,\n            finalBtcPrice,\n\n            tdtToken {\n                owner\n            }\n\n            undercollateralizedThresholdPercent,\n            severelyUndercollateralizedThresholdPercent,\n            bondedECDSAKeep {\n                id,\n                totalBondAmount,\n                publicKey\n            }\n\n            ...NiceStateLabel\n        }\n        stats: statsRecord(id: \"current\", block: $block) {\n            depositCount\n        }\n    }\n\n    ${NiceStateLabel}\n`;\n\nexport function useDepositQuery(view: DepositViewID, pageNumber?: number) {\n  const where = ({\n    \"\": {},\n    active: {'filter_activeLikeState': true},\n    liquidations: {'filter_liquidationLikeOrSignerFailureState': true},\n    redeemable: {'filter_redeemableAsOf_lt': Math.round(DateTime.utc().toMillis() / 1000)},\n    unminted: {'filter_unmintedTDT': true},\n    notifiable: {'currentStateTimesOutAt_lt': Math.round(DateTime.utc().toMillis() / 1000)},\n    redemptions: {'redemptionStartedAt_not': null},\n  } as any)[view || ''] || {};\n\n  const dateColumn: string = ({\n    \"\": \"updatedAt\",\n    operations: \"createdAt\",\n    redemptions: \"redemptionStartedAt\",\n  } as {[key in DepositViewID]: string})[view || ''] || \"updatedAt\";\n\n  const sortState = useSort(dateColumn);\n\n  // TODO: This would cause two requests!\n  const [ready, setReady] = useState(false);\n  useEffect(() => {\n    sortState.setColumn(dateColumn)\n    sortState.setDirection(\"desc\")\n    setReady(true);\n  }, [view, sortState.setColumn, sortState.setDirection])\n\n  // We would like to load more, but then loading is much slower!\n  const perPage = 200;\n\n  const {loading, error, data} = useQueryWithTimeTravel(DEPOSITS_QUERY, {\n    variables: {\n      where: where,\n      skip: perPage * ((pageNumber ?? 1) - 1),\n      orderBy: sortState.column,\n      orderDirection: sortState.direction,\n      perPage\n    },\n    skip: !ready\n  });\n\n  return {\n    loading: loading || !ready,\n    error, data, dateColumn, view, sortState, perPage};\n}\n\nexport type UseDepositQuery = ReturnType<typeof useDepositQuery>;","import { css } from \"emotion\";\nimport React from \"react\";\nimport {Button} from \"../design-system/Button\";\n\nexport type Page = {\n  number: number\n}\nexport type Item = Page;\n\n\nexport type PaginationState = {\n  items: Item[],\n  set: (val: number) => void,\n  hasNext: boolean,\n  current: number,\n}\n\nexport function usePagination(opts: {\n  pageNumber: number,\n  setPageNumber: (val: number) => void,\n  numResults: number,\n  perPage: number\n}): PaginationState {\n  const items: Item[] = [];\n  for (let i=1; i<=opts.pageNumber; i++) {\n    items.push({\n      number: i\n    })\n  }\n\n  return {\n    items,\n    set: opts.setPageNumber,\n    hasNext: opts.perPage <= opts.numResults,\n    current: opts.pageNumber\n  }\n}\n\nexport function Pagination(props: {\n  pagination: PaginationState\n}) {\n  const {items, set, hasNext, current} = props.pagination;\n\n  // We hide the pagination if we are on page 1 and don't know yet if we even need it.\n  if (current == 1 && !hasNext) {\n    return null;\n  }\n\n  return <div className={css`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `}>\n    {items.map(page => {\n      if (page.number == current) {\n        return <div className={css`\n          display: flex;\n          flex-direction: row;\n          align-items: flex-start;\n          outline: none;\n          display: inline-block;\n          text-decoration: none;\n          cursor: pointer;          \n          font-family: Work Sans;\n          font-weight: 500;    \n          line-height: 1.2;\n              \n          background: #0A0806;    \n          border: 1px solid #0A0806;    \n          color: white;\n\n          font-size: ${11}px;\n          padding: ${0.9 * 0.8}em ${1.2 * 0.8}em;\n        `}>\n          {page.number}\n        </div>\n      }\n      return <PaginationButton onClick={set} current={current} page={page.number} />\n    })}\n    {hasNext ? <>\n        <PaginationButton onClick={set} current={current} page={current + 1} />\n        <div style={{marginLeft: '5px'}}>...</div>\n      </> : null}\n  </div>\n}\n\nfunction PaginationButton(props: {\n  page: number,\n  current: number,\n  onClick: (val: number) => void,\n}) {\n  return <div style={{margin: '0 2px'}}>\n    <Button\n      size={\"tiny\"}\n      onClick={() => props.onClick(props.page)}\n    >{props.page}</Button>\n  </div>\n}","import React, {useEffect, useRef, useState} from \"react\";\nimport {Paper} from \"../../design-system/Paper\";\nimport {DepositsTable} from \"./DepositsTable\";\nimport {Helmet} from \"react-helmet\";\nimport {Button} from \"../../design-system/Button\";\nimport {DropdownStyle, ExtraState} from \"react-dropdown-aria/dist/utils/types\";\nimport {css} from \"emotion\";\nimport {useDAppDomain} from \"../../NetworkContext\";\nimport {useParams} from \"react-router\";\nimport Tippy from \"@tippyjs/react\";\nimport {useDepositQuery, Views} from \"./Views\";\nimport {Pagination, usePagination} from \"../../components/Pagination\";\nimport { Link } from \"../../components/Link\";\n\n\n// See: https://github.com/jfangrad/react-dropdown-aria/blob/68e730d1ba8894ded9ee6cfb665c7aabf985d1dc/packages/react-dropdown-aria/styles/index.ts\nconst style: DropdownStyle = {\n  DropdownButton: base => ({\n    ...base,\n    border: 'none',\n    borderRadius: '0px',\n\n    '&:hover': {\n      border: 'none',\n      backgroundColor: '#f8f8f8',\n      boxShadow: 'none',\n    },\n\n    '&:focus': {\n      // border: '2px solid rgb(0, 128, 188)',\n      boxShadow: 'none',\n    },\n\n    '&:disabled': {\n      backgroundColor: '#e6e6e6',\n    },\n  }),\n\n  DropdownWrapper: (base, foo) => {\n    return {\n    ...base,\n        backgroundColor: 'white',\n        border: '1px solid #0A0806',\n        borderRadius: 0,\n\n        '&:hover': {\n          //border: `2px solid ${(open || base.dropdownFocused) ? colours.states.focused : colours.greys.darker}`,\n          border: foo.dropdownFocused ? '1px solid #48DBB4' : '1px solid #0A0806',\n          backgroundColor: \"#F4F4F4\"\n      },\n    }\n  },\n\n  OptionContainer: base => ({\n    ...base,\n    padding: '5px 0',\n    border: '1px solid #0A0806',\n    borderRadius: '0',\n    backgroundColor: 'white'\n  }),\n\n  OptionItem: (base, state, extra?: ExtraState) => ({\n    ...base,\n    fontSize: '0.95em',\n\n    backgroundColor: extra?.selected ? '#D7F6EE' : 'white',\n    color: extra?.selected ? \"#1b9474\" : '#0A0806',\n    '&:hover': {\n      backgroundColor: extra?.selected ? '#D7F6EE' : '#D7F6EE',\n      color: extra?.selected ? \"#1b9474\" : undefined\n    },\n  }),\n\n  Arrow: (base, { open }) => ({\n    ...base,\n\n    'svg': {\n      width: 16,\n      height: 16,\n    }\n  }),\n};\n\nfunction Box(props: {children: any, to: string, onClick: any}) {\n  return <Link onClick={props.onClick} to={props.to} className={css`\n    -webkit-column-break-inside: avoid;\n    page-break-inside: avoid;\n         break-inside: avoid;\n         \n    padding: 10px;\n    min-width: 250px;\n        \n    display: inline-block;\n    & strong {}\n    & em {\n      font-size: 0.9em;\n      color: gray;\n      font-style: normal;\n    }\n    \n    cursor: pointer;\n    &:hover {\n      background-color: #f5f5f5;\n      text-decoration: none !important;\n    }\n  `}>\n    {props.children}\n  </Link>\n}\n\n\nexport function Deposits() {\n  const {view: viewName} = useParams<any>();\n  const dAppDomain = useDAppDomain();\n  const tippy = useRef<any>();\n\n  const [pageNumber, setPageNumber] = useState(1);\n  const currentView = Views.filter(v => v.id === viewName)[0] || Views[0];\n\n  useEffect(() => {\n    setPageNumber(1);\n  }, [currentView])\n\n  const depositQuery = useDepositQuery(currentView.id, pageNumber);\n  const pagination = usePagination({\n    pageNumber,\n    setPageNumber,\n    numResults: depositQuery.data?.deposits.length,\n    perPage: depositQuery.perPage,\n  })\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Deposits</title>\n    </Helmet>\n\n    <div style={{marginBottom: '20px'}}>\n      <div style={{display: 'flex', alignItems: 'center'}}>\n        <Tippy trigger=\"click\" hideOnClick={true} arrow={false} interactive={true} maxWidth={600} className={css`\n          background-color: transparent !important;\n          padding: 0;\n          color: inherit;\n        `} onCreate={(instance) => {\n          tippy.current = instance;\n        }} content={\n          <Paper>\n            <div className={css`\n              column-count: 2;\n              column-gap: 0;\n              display: inline-block;\n              padding: 10px;\n            `}>\n              {Views.map(view => {\n                return <Box to={`/deposits/${view.id}`} onClick={() => {\n                  tippy.current.hide();\n                }}>\n                  <div><strong>{view.label}</strong></div>\n                  <div><em>{view.description}</em></div>\n                </Box>\n              })}\n            </div>\n          </Paper>\n        }>\n          <h1 style={{marginTop: 0, marginBottom: '0px', cursor: 'pointer'}} className={css`        \n          `}>\n            {currentView.label} {\" \"}\n            <img alt=\"svgImg\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMjQiIGhlaWdodD0iMjQiCnZpZXdCb3g9IjAgMCAyNCAyNCIKc3R5bGU9IiBmaWxsOiMwMDAwMDA7Ij48cGF0aCBkPSJNIDEyIDAgQyA1LjM3MTA5NCAwIDAgNS4zNzEwOTQgMCAxMiBDIDAgMTguNjI4OTA2IDUuMzcxMDk0IDI0IDEyIDI0IEMgMTguNjI4OTA2IDI0IDI0IDE4LjYyODkwNiAyNCAxMiBDIDI0IDUuMzcxMDk0IDE4LjYyODkwNiAwIDEyIDAgWiBNIDEyIDE4LjUgTCA2LjUgMTIgTCAxMCAxMiBMIDEwIDYgTCAxNCA2IEwgMTQgMTIgTCAxNy41IDEyIFoiPjwvcGF0aD48L3N2Zz4=\"/>\n          </h1>\n        </Tippy>\n\n        {currentView.action === \"make\"\n          ?  <div style={{marginLeft: \"30px\"}}>\n                <Button size={\"tiny\"} to={`https://${dAppDomain}/deposit`}>Make</Button>\n              </div>\n            : null}\n      </div>\n\n      {currentView.id == \"\" ? <div style={{color: 'gray', visibility: depositQuery.data?.stats?.depositCount ? 'visible' : 'hidden'}}>\n        {depositQuery.data?.stats?.depositCount} deposits.\n      </div> : null}\n    </div>\n\n    <Paper padding>\n      <DepositsTable\n          query={depositQuery}\n      />\n\n      <div style={{marginTop: '30px'}}>\n        <Pagination pagination={pagination} />\n      </div>\n    </Paper>\n  </div>\n}\n\n\n//\n// <div style={{\n//   marginBottom: '15px',\n//   display: 'flex',\n//   flexDirection: 'row',\n//   justifyContent: 'flex-end'\n// }}>\n//   <div className={css`\n//           display: inline-block;\n//           width: 180px;\n//         `}>\n//     <Dropdown\n//         style={style}\n//         value={view}\n//         onChange={(value) => {\n//           location.push(`/deposits/${value.value}`);\n//         }}\n//         optionItemRenderer={item => {\n//           return <span>{item.option.title}</span>\n//         }}\n//         options={[\n//           { value: 'all', title: 'All' },\n//           { value: 'active', title: 'Active Only' },\n//           { value: 'liquidations', title: 'Liquidations' },\n//           { value: 'redeemable', title: 'Redeemable' },\n//           { value: 'unminted', title: 'Unminted TDTs' }\n//         ]}\n//     />\n//   </div>\n// </div>","import {gql} from \"@apollo/client\";\nimport React from \"react\";\nimport {useParams} from 'react-router';\nimport {getSatoshisAsBitcoin} from \"../../utils/getSatoshisAsBitcoin\";\nimport {TimeToNow} from \"../../components/FormattedTime\";\nimport {css} from \"emotion\";\nimport {Address, BitcoinAddress, Hash} from \"../../components/Address\";\nimport {Paper} from \"../../design-system/Paper\";\nimport {NiceStateLabel} from \"../../utils/depositStates\";\nimport {\n  getTDTTokenAddress,\n  getVendingMachineAddress,\n  hasDepositBeenUsedToMint,\n  isVendingMachine,\n} from \"../../utils/contracts\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {Helmet} from \"react-helmet\";\nimport {getWeiAsEth} from \"../../utils/getWeiAsEth\";\nimport {\n  CollaterizationStatusWithPrice, getPriceAtCollateralizationRatio,\n} from \"../../components/CollateralizationStatus\";\nimport {Box} from \"../../components/Box\";\nimport {Button} from \"../../design-system/Button\";\nimport {Log} from \"./log\";\nimport {useDAppDomain, useEtherscanDomain} from \"../../NetworkContext\";\nimport {useBtcAddressFromPublicKey} from \"../../utils/useBtcAddressFromPublicKey\";\nimport {StatusBox} from \"./StatusBox\";\nimport {usePriceFeed} from \"../../components/PriceFeed\";\nimport {useQueryWithTimeTravel, useTimeTravelSafeSubscription} from \"../../TimeTravel\";\nimport {PageHeader} from \"../../components/PageHeader\";\nimport {HeaderBoxes} from \"../../components/HeaderBoxes\";\nimport {PageHeaderMenu} from \"../../components/PageHeaderMenu\";\nimport {AuctionDetailsFragment, getAuctionDetailsFromDeposit} from \"../../utils/getAuctionDetails\";\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {PropertyTable} from \"../../components/PropertyTable\";\n\n\nconst DEPOSIT_QUERY = gql`\n    query GetDeposit($id: ID!, $block: Block_height) {\n        deposit(id: $id, block: $block) {\n            id,\n            contractAddress,\n            currentState,\n            createdAt,\n            keepAddress,\n            lotSizeSatoshis,\n            endOfTerm,\n            index,\n\n            currentStateTimesOutAt,\n            \n            tdtToken {\n                id,\n                tokenID,\n                owner,\n                minter\n            }\n\n            initialCollateralizedPercent,\n            undercollateralizedThresholdPercent,\n            severelyUndercollateralizedThresholdPercent,\n            \n            bondedECDSAKeep {\n                id,\n                keepAddress,\n                totalBondAmount,\n                publicKey,\n                status,\n                honestThreshold,\n                members {\n                    id,\n                    address\n                }\n                pubkeySubmissions { address },\n            },\n            \n            depositLiquidation {\n                cause\n            }\n            \n            ...NiceStateLabel,\n            ...AuctionDetails\n        }\n    }\n  \n    ${NiceStateLabel}\n    ${AuctionDetailsFragment}\n`;\n\nconst DEPOSIT_SUBSCRIPTION = gql`\n    subscription WatchDeposit($id: ID!) {\n        deposit(id: $id) {\n            id\n            currentState\n        }\n    }\n`;\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  style: 'percent',\n  maximumFractionDigits: 2\n});\n\n\nexport function Deposit() {\n  return <div className={css`\n      padding: 1em;\n    `}>\n    <Helmet>\n      <title>Deposit</title>\n    </Helmet>\n    <Content />\n  </div>\n}\n\n\nexport function Content() {\n  let { depositId } = useParams<any>();\n\n  // Fix up deposit id\n  depositId = depositId.toLowerCase();\n  if (depositId.slice(0, 3) != 'dp-') {\n    depositId = 'dp-' + depositId;\n  }\n\n  const { loading, error, data } = useQueryWithTimeTravel(DEPOSIT_QUERY, {variables: {id: depositId, block: {number: 11058393}}});\n  useTimeTravelSafeSubscription(DEPOSIT_SUBSCRIPTION, { variables: { id: depositId }});\n  const etherscan = useEtherscanDomain();\n  const dAppDomain = useDAppDomain();\n  const price = usePriceFeed();\n\n  const btcAddress = useBtcAddressFromPublicKey(data?.deposit?.bondedECDSAKeep.publicKey);\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n  if (!data.deposit) return <p>Not found.</p>;  \n\n  return <div>\n    <PageHeader\n      label={\"Deposit\"}\n      subtitle={data.deposit.contractAddress}\n      buttons={\n        <PageHeaderMenu>\n          <div><a href={`https://keepscan.com/deposits/${data.deposit.contractAddress}`}>Open in KeepScan</a></div>\n          <div><a href={`https://tbtcdeposit.auction/#/liquidations/${data.deposit.contractAddress}`}>Open in Auction Tool</a></div>\n          <div><a href={`https://tbtcexplorer.com/detail/${data.deposit.contractAddress}`}>Open in tBTCExplorer</a></div>\n          <div><a href={`https://${etherscan}/address/${data.deposit.contractAddress}`}>Find on Etherscan</a></div>\n        </PageHeaderMenu>\n      }\n    >\n      <HeaderBoxes>\n        <Box label={\"lot size\"}>\n          {getSatoshisAsBitcoin(data.deposit.lotSizeSatoshis)} BTC\n        </Box>\n\n        <StatusBox deposit={data.deposit} />\n\n        <Box label={\"creation date\"}>\n          <TimeToNow time={data.deposit.createdAt} />\n        </Box>\n      </HeaderBoxes>\n    </PageHeader>\n\n    <div style={{\n      display: \"flex\",\n      flexDirection: \"row\",\n      marginTop: '20px'\n    }}>\n      <div style={{marginRight: '20px', flex: 1}}>\n        <Summary deposit={data.deposit} />\n\n        <Paper style={{marginTop: '20px'}}>\n          <div className={css`           \n            padding: 20px;\n          `}>\n            <NextStep deposit={data.deposit} />\n            <h3 style={{marginTop: 0}}>Log</h3>\n            <Log depositId={data.deposit.id} />\n          </div>\n        </Paper>\n      </div>\n\n      <div style={{flex: 1}}>\n        <Paper>\n          <div className={css`\n            font-weight: bold;\n            padding: 20px;\n            padding-bottom: 0;\n          `}>\n            Collateral <InfoTooltip>\n              The  BTC is custodied by a group of randomly chosen signing nodes which stake ETH as a security bond.\n            </InfoTooltip>\n          </div>\n          <PropertyTable style={{padding: '15px'}} data={[\n            {\n              key: 'signers',\n              label: \"Signers\",\n              tooltip: \"The node operators collectively holding the Bitcoin private key.\",\n              value: <div>\n                {data.deposit.bondedECDSAKeep.members.map((m: any) => {\n                  return <div key={m.address}>\n                    <Address address={m.address} to={`/operator/${m.address}`} />\n                  </div>\n                })}\n              </div>\n            },\n            {\n              key: 'collateralization',\n              label: \"Collaterialization\",\n              tooltip: \"If ETH loses value, the keep may become undercollaterized.\",\n              value: <CollaterizationStatusWithPrice price={price} deposit={data.deposit} highlightNormal={true} style={{fontWeight: 'bold'}} />\n            },\n            {\n              key: 'courtesyCallPrice',\n              label: \"Liquidation Price\",\n              tooltip: \"If the price of ETH falls to the first level, a courtesy call can be initiated, if it falls to the second, the deposit can be liquidated.\",\n              value: <div>\n                {getPriceAtCollateralizationRatio(data.deposit, data.deposit.undercollateralizedThresholdPercent / 100).toFixed(5)} BTC / {\" \"}\n                {getPriceAtCollateralizationRatio(data.deposit, data.deposit.severelyUndercollateralizedThresholdPercent / 100).toFixed(5)} BTC\n              </div>\n            },\n            {\n              key: 'bondedAmount',\n              label: \"Bond\",\n              tooltip: \"The total value the signers have bonded to guarantee this deposit.\",\n              value: <span>{getWeiAsEth(data.deposit.bondedECDSAKeep.totalBondAmount).toFixed(2)} ETH</span>\n            },\n            btcAddress ? {\n              key: 'publicKey',\n              label: \"BTC Address\",\n              value: <BitcoinAddress address={btcAddress} />\n            } : undefined,\n            {\n              key: 'thresholds',\n              label: \"Thresholds\",\n              tooltip: \"The collateralization requirements for this deposit: Initial / Courtesy Call / Liquidation\",\n              value: <span>\n                {formatter.format(data.deposit.initialCollateralizedPercent / 100)}<span style={{color: 'silver'}}> / </span>{formatter.format(data.deposit.undercollateralizedThresholdPercent / 100)}<span style={{color: 'silver'}}> / </span>{formatter.format(data.deposit.severelyUndercollateralizedThresholdPercent / 100)}\n              </span>\n            },\n            {\n              key: 'honestThreshold',\n              label: \"Honest Threshold\",\n              tooltip: \"How many signers must be honest for the bond not be lost.\",\n              value: <span>{formatter.format(data.deposit.bondedECDSAKeep.honestThreshold / data.deposit.bondedECDSAKeep.members.length)}</span>\n            },\n          ]} />\n        </Paper>\n        <Paper style={{marginTop: '20px'}}>\n          <PropertyTable\n              style={{padding: '15px'}}\n              data={[\n                {\n                  key: 'tokenOwner',\n                  label: \"Current Owner\",\n                  tooltip: \"Deposit owner as represented by ownership over the TDT token.\",\n                  value: <Address address={data.deposit.tdtToken.owner} />\n                },\n                {\n                  key: 'tokenMinter',\n                  label: \"Creator\",\n                  tooltip: \"Original creator of this deposit.\",\n                  value: <Address address={data.deposit.tdtToken.minter}  />\n                },\n                {\n                  key: 'tokenId',\n                  label: \"Token ID\",\n                  value: <Address address={data.deposit.tdtToken.tokenID} to={`https://${etherscan}/token/${getTDTTokenAddress()}?a=${data.deposit.tdtToken.tokenID}`}  />\n                },\n                {\n                  key: 'index',\n                  label: \"Index\",\n                  tooltip: \"The number of the deposit, counting up since inception of the system.\",\n                  value: data.deposit.index,\n                },\n                data.deposit.endOfTerm ? {\n                  key: 'endOfTerm',\n                  label: \"End Of Term\",\n                  tooltip: \"Within the term, only the owner can redeem the deposit or mint TBTC.\",\n                  value: <TimeToNow time={data.deposit.endOfTerm} />\n                } : undefined,\n                {\n                  key: 'depositContract',\n                  label: \"Deposit Contract\",\n                  value: <Address address={data.deposit.contractAddress}  />\n                },\n                {\n                  key: 'keepContract',\n                  label: \"Keep Contract\",\n                  tooltip: \"The Keep holds the original BTC in custody, and signers stake ETH as a security bond.\",\n                  value: <Address address={data.deposit.keepAddress}  />\n                },\n                {\n                  key: 'status',\n                  label: \"Keep Status\",\n                  value: data.deposit.bondedECDSAKeep.status\n                },\n              ]}\n          />\n        </Paper>\n      </div>\n    </div>\n  </div>\n}\n\n\nfunction NextStep(props: {\n  deposit: any\n}) {\n  const {deposit} = props;\n\n  let Component: any;\n  if (deposit.currentState == 'AWAITING_BTC_FUNDING_PROOF') {\n    Component = WaitingForFundingProof;\n  }\n  if (deposit.currentState == 'AWAITING_SIGNER_SETUP') {\n    if (deposit.bondedECDSAKeep.publicKey) {\n      Component = WaitingForFundingStart;\n    } else {\n      Component = WaitingForSignerSetup;\n    }\n  }\n\n  if (!Component) {\n    return null;\n  }\n\n  return <div style={{marginBottom: '20px'}} className={css`\n    margin-bottom: 20px;\n    padding-left: 15px;\n    border-left: 1px solid #64c4aa;\n  `}>\n    <div style={{marginTop: 0, color: '#64c4aa', fontWeight: 'bold', marginBottom: '10px'}}>\n      What happens next?\n    </div>\n    <Component deposit={deposit} />\n  </div>\n}\n\nfunction WaitingForFundingStart(props: {\n  deposit: any\n}) {\n  return <div>\n    The depositor must notify the contract that the signers have setup the Bitcoin deposit address, and that they want to\n    continue the deposit process.\n  </div>\n}\n\nfunction WaitingForFundingProof(props: {\n  deposit: any\n}) {\n  return <div>\n    The depositor must submit proof of having sent to Bitcoin to the deposit address, once at least 6 confirmations have been reached. <TimeToNow time={props.deposit.currentStateTimesOutAt} /> left to do so.\n  </div>\n}\n\nfunction WaitingForSignerSetup(props: {\n  deposit: any\n}) {\n  // Can be tested at: http://localhost:3000/deposit/0x30c717eee21c9362f3ac5606f5db0af9f5aa0c0a?block=11160875\n  const allSigners = props.deposit.bondedECDSAKeep.members.map((s: any) => s.address);\n  const goodSigners = new Set(props.deposit.bondedECDSAKeep.pubkeySubmissions.map((s: any) => s.address));\n  const badSigners: string[] = allSigners.filter((s: any) => !goodSigners.has(s));\n\n  return <div>\n    <p>\n      The signers chosen to back this deposit will lock up ETH collateral and then submit a Bitcoin deposit address.\n    </p>\n    <p>\n      {props.deposit.bondedECDSAKeep.pubkeySubmissions.length}/3 have done so. We are still waiting for {\" \"}\n      {badSigners\n          .map(\n              address => <Address key={address} to={`/operator/${address}`} address={address} />)\n          .reduce((prev, curr) => [prev, ', ', curr] as any)}.\n    </p>\n  </div>\n}\n\n\nfunction Summary(props: {\n  deposit: any\n}) {\n  const {deposit} = props;\n  const etherscan = useEtherscanDomain();\n  const dAppDomain = useDAppDomain();\n\n  const canBeRedeemed = ['ACTIVE', 'COURTESY_CALL'].indexOf(deposit.currentState) > -1;\n  const isAtTerm = false;  // XXX still needs to be fixed\n  const canBeRedeemedByAnyone = canBeRedeemed && (deposit.currentState == 'COURTESY_CALL' || isAtTerm || isVendingMachine(deposit.tdtToken.owner));\n\n  let content: any;\n  if (deposit.currentState === 'LIQUIDATION_IN_PROGRESS') {\n    content = <LiquidationSummary deposit={deposit} />\n  } else {\n    content = <>\n      <div className={css`\n      font-weight: bold;\n      margin-bottom: 0.5em;\n    `}>\n      Ownership <InfoTooltip>\n        For every deposit, a non-fungible TDT Token is minted. Whoever owns this token, owns the deposit.\n      </InfoTooltip>\n    </div>\n    <div className={css`\n    `}>\n      {\n        hasDepositBeenUsedToMint(deposit.tdtToken.owner, deposit.currentState)\n            ? <div>\n              This deposit has been used to mint TBTC. The corresponding TDT token is now\n              owned by the <a href={`https://${etherscan}/address/${getVendingMachineAddress()}`}>Vending Machine contract</a>.\n            </div>\n            : (deposit.tdtToken.owner == deposit.tdtToken.minter) ? <div>\n              The TDT Token representing ownership over this deposit is owned by the original\n              deposit creator, <Address address={deposit.tdtToken.owner} />.\n            </div> : <div>\n              The TDT Token representing ownership over this deposit is owned by <Address address={deposit.tdtToken.owner} />.\n            </div>\n      }\n    </div>\n    <div className={css`\n      font-size: 0.8em;\n      margin-top: 10px;\n      & a, a:visited {\n        color: gray;\n      }            \n    `}>\n      <a href={`https://${etherscan}/token/${getTDTTokenAddress()}?a=${deposit.tdtToken.tokenID}`}>TDT Token on Etherscan</a>\n    </div>\n\n    {(canBeRedeemedByAnyone) ?\n      <div style={{marginTop: 20}}>\n        This deposit can be redeemed by anyone, even non-owners. <InfoTooltip>Because it is owned by the Vending Machine, has been courtesy called, or is at-term, anyone can exchange TBTC for the Bitcoin deposited here.</InfoTooltip>\n        <div style={{marginTop: '8px'}}><Button size={\"small\"} to={`https://${dAppDomain}/deposit/${deposit.contractAddress}/redeem`}>\n          Redeem\n        </Button></div>\n      </div>\n    : null }\n    </>;\n  }\n\n\n  return <Paper padding>\n     {content}\n  </Paper>\n}\n\n\nfunction LiquidationSummary(props: {deposit: any}) {\n  const details = getAuctionDetailsFromDeposit(props.deposit);\n  return <>\n    <div>\n      This deposit is currently in liquidation. <ETHValue wei={details.value} /> ETH are on offer - {details.percentage}% of the total bond.\n    </div>\n  </>\n}\n\n","import React from \"react\";\nimport {css} from \"emotion\";\nimport {useLocation} from \"react-router-dom\";\nimport {Link} from \"../components/Link\";\n\nexport const NavigationButton = React.forwardRef((props: {\n  children: any,\n  to?: string,\n  onClick?: any\n}, ref) => {\n  const isActive = useLocation().pathname == props.to;\n\n  return <Link innerRef={ref as any} to={props.to ?? \"\"} onClick={props.onClick} data-active={isActive ? \"true\" : \"\"} className={css`\n    padding: 0.5em;    \n               \n    font-size: 14px;\n    line-height: 22px;\n    text-decoration: none;\n    \n    align-items: center;\n    letter-spacing: 0.05em;\n    text-transform: uppercase;\n    color: #0A0806;\n \n    display: flex;\n    color: black !important;\n    \n    &:hover {\n      text-decoration: none;\n    }\n    \n    position: relative;\n    &:hover::after, &[data-active=true]::after {\n      content: '';\n      position: absolute;\n      height: 5px;\n      background: #48DBB4 /**#F4F4F4**/;\n      bottom: 0px;\n      left: 0px;\n      right: 0px;\n    }\n  `}>\n    {props.children}\n  </Link>\n});","import React from \"react\";\nimport {Paper} from \"../design-system/Paper\";\n\nexport function About() {\n  return <div style={{\n    padding: '20px'\n  }}>\n    <Paper padding>\n      <h3>The Idea</h3>\n      <p>\n        Provide insight into the workings of the Keep and tBTC systems - deposits, redemptions,\n        who bonds for what, governance actions, etc. It does <strong>not</strong> desire to track ownership and\n        transfers of the KEEP and TBTC tokens themselves - for that you may want to have a look at\n        {\" \"} <a href={\"https://keep-explorer.herokuapp.com/\"}>KeepExplorer</a> or even\n        {\" \"} <a href={\"https://etherscan.io/token/0x85eee30c52b0b379b046fb0f85f4f3dc3009afec\"}>Etherscan</a>.\n      </p>\n\n      <h3>Code etc.</h3>\n      <p>\n        The source code is available <a href={\"https://github.com/miracle2k/allthekeeps\"}>on Github</a>. The backend\n        is provided by <a href={\"https://thegraph.com/\"}>The Graph</a>, and specifically\n        {\" \"} <a href={\"https://thegraph.com/explorer/subgraph/miracle2k/keep-network\"}>this subgraph</a>. The graph is\n        currently still evolving, and will likely change in backwards-incompatible ways. You can contribute to it\n        {\" \"} <a href={\"https://github.com/miracle2k/allthekeeps-graph\"}>on Github</a>.\n      </p>\n      <p>\n        <a href={\"https://github.com/miracle2k/keep-pricefeed\"}>A second subgraph</a> is providing the on-chain\n        price feed.\n      </p>\n      <p>\n        Built by <a href={\"http://twitter.com/elsdoerfer/\"}>@elsdoerfer</a>\n      </p>\n    </Paper>\n\n  </div>\n}","import * as React from \"react\"\n\nexport function ExplainerIcon(props: React.SVGProps<SVGSVGElement>) {\n  return (\n      <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 48 48\" {...props}>\n        <path\n            d=\"M24 4C12.972 4 4 12.972 4 24c0 3.275.863 6.335 2.262 9.064l-2.168 7.764c-.505 1.804 1.278 3.585 3.082 3.08l7.767-2.168C17.671 43.137 20.727 44 24 44c11.028 0 20-8.972 20-20S35.028 4 24 4zm0 3c9.406 0 17 7.594 17 17 0 9.406-7.594 17-17 17-3.003 0-5.808-.782-8.256-2.146a1.5 1.5 0 00-1.135-.135L7.223 40.78l2.062-7.383a1.5 1.5 0 00-.135-1.134A16.89 16.89 0 017 24c0-9.406 7.594-17 17-17zm-.023 5.979A1.5 1.5 0 0022.5 14.5v12a1.5 1.5 0 103 0v-12a1.5 1.5 0 00-1.523-1.521zM24 31a2 2 0 000 4 2 2 0 000-4z\"/>\n      </svg>\n  )\n}\n","/**\n * See MinimumStakeSchedule.sol\n */\n\n\n// 2 years in seconds (seconds per day * days in a year * years)\nconst schedule = 86400 * 365 * 2;\nconst steps = 10;\nconst base = 10000 * 1e18;\n\n// 2020-04-28; the date of deploying KEEP token.\n// TX:  0xea22d72bc7de4c82798df7194734024a1f2fd57b173d0e065864ff4e9d3dc014\nconst minimumStakeScheduleStart = 1588042366;\n\n\n// The minimum stake is lowered periodically over the course of 2 years since the time\n// of the schedule start and eventually ends at 10k KEEP.\nexport function calculateMinStake() {\n  const now = Math.round(Date.now() / 1000);\n  if (now < minimumStakeScheduleStart + schedule) {\n    // https://ethereum.stackexchange.com/a/89818/64957\n    const currentStep = Math.floor(steps * (now - minimumStakeScheduleStart) / schedule);\n    return base * (steps - currentStep);\n  }\n  return base;\n}\n","import {gql, useQuery} from \"@apollo/client\";\nimport React from \"react\";\nimport {Paper} from \"../design-system/Paper\";\nimport {css} from \"emotion\";\nimport {Address, Transaction} from \"../components/Address\";\nimport {ExternalLinkIcon} from \"../components/ExternalLinkIcon\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport {getSatoshisAsBitcoin} from \"../utils/getSatoshisAsBitcoin\";\nimport { Helmet } from \"react-helmet\";\nimport { Table } from \"../components/Table\";\nimport {FormattedTime, TimeToNow} from \"../components/FormattedTime\";\nimport {ExplainerIcon} from \"../components/ExplainerIcon\";\nimport {usePriceFeed} from \"../components/PriceFeed\";\nimport {getWeiAsEth} from \"../utils/getWeiAsEth\";\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {calculateMinStake} from \"../utils/calculateMinStake\";\nimport {keepFormatter} from \"../components/KeepValue\";\nimport {KeepTag} from \"../components/CurrencyTags\";\n\nconst GOVERNANCE_QUERY = gql`\n    query GetGovernance($block: Block_height) {\n        governance(id: \"GOVERNANCE\", block: $block) {\n            newDepositsAllowed\n            \n            lotSizes,\n            pendingLotSizeChange { ...Change },\n            \n            factorySelector,\n            fullyBackedFactory,\n            keepStakedFactory,\n            pendingFactoriesChange { ...Change },\n\n            signerFeeDivisor,\n            pendingSignerFeeDivisorChange { ...Change },\n\n            initialCollateralizedPercent,\n            severelyUndercollateralizedThresholdPercent,\n            undercollateralizedThresholdPercent,\n            \n            priceFeeds,\n        },\n        \n        governanceLogEntries(first: 300, orderBy: timestamp, orderDirection: desc, block: $block) {\n            id,\n            timestamp,\n            transactionHash,\n            submitter,\n            isRequest,\n            change {\n                ...Change\n            }\n        }\n    }\n\n    fragment Change on GovernanceChange {\n        type,\n        requestedAt,\n        takesEffectAfter,\n\n        newLotSizes,\n        newFactorySelector,\n        newFullyBackedFactory,\n        newKeepStakedFactory,\n    }\n`;\n\n\nexport function Governance() {\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Governance</title>\n    </Helmet>\n    <h1 style={{marginTop: 0}}>Governance</h1>\n    <Content />\n  </div>\n}\n\n\nexport function Content() {\n  const { loading, error, data } = useQueryWithTimeTravel(GOVERNANCE_QUERY);\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  return <div>\n    <div  style={{\n      display: 'flex',\n      flexDirection: 'row'\n    }}>\n      <Paper padding>\n        <Block title={\"Deposits Enabled\"} tooltip={\"New deposits can be paused for 10 days in an emergency.\"}>\n          {data.governance.newDepositsAllowed ? \"Yes\" : \"Emergency Break in Effect\"}\n        </Block>\n\n        <Block title={\"Lot Sizes\"} tooltip={\"The available sizes when creating a new deposit.\"}>\n          {formatLotSizes(data.governance.lotSizes)}\n        </Block>\n\n        <Block title={\"Signer Fee\"} tooltip={\"The fee that goes to the signers who guarantee a deposit, cannot be set to a value <0.02% or >10%.\"}>\n          {formatter.format(1 / data.governance.signerFeeDivisor)}\n        </Block>\n\n        <Block title={\"Factory Contracts\"}>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Factory Selector: </span> <Address address={data.governance.factorySelector} />\n          </div>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Fully Backed Factory: </span> <Address address={data.governance.fullyBackedFactory} />\n          </div>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Keep Staked Factory: </span> <Address address={data.governance.keepStakedFactory} />\n          </div>\n        </Block>\n\n        <Block title={\"Collateralization Thresholds\"}>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Initial: </span> {data.governance.initialCollateralizedPercent}%\n          </div>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Undercollaterized: </span> {data.governance.undercollateralizedThresholdPercent}%\n          </div>\n          <div>\n            <span style={{color: '#rgb(62 62 62)'}}>Severly Undercollaterized: </span> {data.governance.severelyUndercollateralizedThresholdPercent}%\n          </div>\n        </Block>\n\n        <Block title={\"Price Feeds\"}>\n          {data.governance.priceFeeds.map((feed: any) => {\n            return <div><Address address={feed} /></div>\n          })}\n        </Block>\n      </Paper>\n\n      <div style={{flex: 0, minWidth: '400px', marginLeft: '40px'}}>\n        <div style={{display: 'flex', flexDirection: 'row', alignItems: 'center'}}>\n          <ExplainerIcon width={\"2em\"} height={\"2em\"}/>\n          <strong style={{marginTop: 0, paddingLeft: '0.3em', fontSize: '1.2em'}}>Governance Info</strong>\n        </div>\n        The admin key has the following abilities: <strong>a)</strong> emergency break: in the first 180 days only, it can stop new deposits for 10 days.\n        {\" \"}<strong>b)</strong> it can change the governance parameters on the left with 48 hours notice, but only new deposits are affected.\n      </div>\n\n      <div style={{marginLeft: 20}}>\n        <PriceInfo />\n        <div style={{height: '20px'}}></div>\n        <FixedParams />\n      </div>\n    </div>\n\n    <Paper padding style={{marginTop: '20px'}}>\n      <h3 style={{marginTop: 0}}>Log</h3>\n\n      <Table style={{width: '100%'}}>\n        <thead>\n          <tr>\n            <th>Date</th>\n            <th style={{paddingBottom: 10}}>\n              Action\n            </th>\n            <th>Submitter</th>\n            <th>Transaction</th>\n          </tr>\n        </thead>\n        <tbody>\n          {data.governanceLogEntries.map((logEntry: any) => {\n            return <LogEntry entry={logEntry} />\n          })}\n        </tbody>\n      </Table>\n    </Paper>\n  </div>\n}\n\n\nfunction PriceInfo() {\n  const price = usePriceFeed();\n\n  let content: any;\n  if (!price) {\n    content = '-';\n  }\n  else {\n    content = <div>\n      <div>{price.val.toFixed(5)} BTC</div>\n      <div style={{\n        marginTop: '0.5em',\n        fontSize: '0.8em'\n      }}>\n        <TimeToNow time={price.timestamp} /> in block <Transaction tx={price.transactionHash}>{price.blockNumber}</Transaction>.\n      </div>\n    </div>\n  }\n\n  return <Paper padding>\n    <Block title={\"ETH Price Feed\"} tooltip={\"The price of 1 Ether in BTC - affects collateralization ratios. Updates live.\"}>\n      {content}\n    </Block>\n  </Paper>\n}\n\n\nfunction FixedParams() {\n  return <Paper padding>\n    <Block title={\"Minimum Stake\"}>\n      <KeepTag /> {keepFormatter.format(calculateMinStake() / 10 ** 18)}\n    </Block>\n  </Paper>\n}\n\n\nfunction Block(props: {\n  children?: any,\n  title: string,\n  tooltip?: string\n}) {\n  return <div style={{marginBottom: '15px'}}>\n    <div><strong>{props.title} {props.tooltip ? <InfoTooltip>{props.tooltip}</InfoTooltip> : null}</strong></div>\n    {props.children}\n  </div>\n}\n\n\nconst formatter = new Intl.NumberFormat(\"en-US\", {\n  style: 'percent',\n  maximumFractionDigits: 2\n});\n\nfunction formatLotSizes(lotSizes: any) {\n  return lotSizes.map((size: number) => {\n    return getSatoshisAsBitcoin(size)\n  }).join(\", \") + \" BTC\"\n}\n\n\nfunction LogEntry(props: {\n  entry: any\n}) {\n  const {entry, entry: {change: {type}, isRequest}} = props;\n  let Component: any;\n\n  if (type == 'LOT_SIZES') {\n    if (isRequest) {\n      Component = LotSizesChangeRequest;\n    } else {\n      Component = LotSizesChangeDone;\n    }\n  }\n  else {\n    Component = UnsupportedChange;\n  }\n  return <tr>\n    <td>\n      <TimeToNow time={props.entry.timestamp} />\n    </td>\n    <td>\n      <Component entry={props.entry} />\n    </td>\n    <td>\n      <Address address={props.entry.submitter} includeExternalIcon={true} />\n    </td>\n    <td>\n      <Transaction tx={props.entry.transactionHash} includeExternalIcon={true} />\n    </td>\n  </tr>\n}\n\n\nfunction ActionDesc(props: {\n  headline: string,\n  children?: any\n}) {\n  return <>\n    <div><strong>{props.headline}</strong></div>\n    <div className={css`\n      font-size: .9em;  \n    `}>{props.children}</div>\n  </>\n}\n\n\nfunction LotSizesChangeRequest(props: {\n  entry: any\n}) {\n  return <ActionDesc headline={\"Scheduled: Available lot sizes\"}>\n    <div>\n      New lots will be: <span>{formatLotSizes(props.entry.change.newLotSizes)}</span>\n    </div>\n    {props.entry.isRequest ? <div>\n      <span  className={css`\n          color: gray;\n      `}>\n        Can be applied after <FormattedTime time={parseInt(props.entry.change.takesEffectAfter)} /> (48 hours).\n      </span>\n    </div> : null}\n  </ActionDesc>\n}\n\n\nfunction LotSizesChangeDone(props: {\n  entry: any\n}) {\n  return <ActionDesc headline={\"Changed: Available lot sizes\"}>\n    <div>\n      Lot sizes are now: {\" \"} <span>{formatLotSizes(props.entry.change.newLotSizes)}</span>\n    </div>\n  </ActionDesc>\n}\n\nfunction UnsupportedChange(props: {\n  entry: any\n}) {\n  if (props.entry.isRequest) {\n    return <ActionDesc headline={\"A governance change was scheduled.\"} />\n  }\n  return <ActionDesc headline={\"A governance change was applied.\"} />\n}","export const TorchMapping = {\n    '0xb6f512124d8ddb8d7ef8559318de92531af32f6f': 'https://twitter.com/ercwl/status/1311452208127447044',\n    '0xc2c00cfaf708b44932a3172b10b2f22b891b95c9': 'https://twitter.com/bcmakes/status/1311482851469094914',\n    '0x6d64c48259056248e7629f2f8b306a8dec6ebc84': 'https://twitter.com/calebtebbe/status/1311486631610707968',\n    '0x425249cf0f2f91f488e24cf7b1aa3186748f7516': 'https://twitter.com/_prestwich/status/1311506768988532737',\n    '0x0e98e6c1b32f61ed8396a11730ac2f7d46e9cb8b': 'https://twitter.com/ekrenzke/status/1311515387159175168',\n    '0xb9ab101eb21561ee343f88271654986dbd397070': 'https://twitter.com/gakonst/status/1311652009582493697',\n    '0xf253266c062014482b7b00473ca3b63211ad913e': 'https://twitter.com/gtklocker/status/1311707875358711809',\n    '0xe1b06c08aa24d03bec4ac4799f7aadd183a22e5c': 'https://twitter.com/viktorbunin/status/1311728473074003969',\n    '0xc8e0345596d7196941e61d3ab607e57fe61f85e7': {\n        '3836,140': 'https://twitter.com/oleveraging/status/1311731142429679621',\n        '4226,1': 'https://twitter.com/statelayer/status/1316593462532284417'\n    },\n    '0x0536e7dd2f63f5bbe2b581b704f98f8716e40b58': 'https://twitter.com/dzack23/status/1311732655491354624',\n    '0x7889296d06cd861fe6e2cd9cc671e488259ba3cf': 'https://twitter.com/pedrouid/status/1311742902998097924',\n    '0xd0769849c3af28a9df5a89e602c013853eb674ed': 'https://twitter.com/lightcoin/status/1311752269818458114',\n    '0x5e349eca2dc61abcd9dd99ce94d04136151a09ee': 'https://twitter.com/ljxie/status/1311765940674142211',\n    '0x794aa628bd7b968051d4a1c6273f96f350a4149b': 'https://twitter.com/melt_dem/status/1311762743750467591',\n    '0x725e86fe265e61b6ac4f87e36d7f353282800721': 'https://twitter.com/obstropolos/status/1311770680707473409',\n    '0x07c6f80d694db95e697aea80708d6fe7dcf1e8e8': 'https://twitter.com/wycdd/status/1311773359802286092',\n    '0x13c0dabeb938c21524c59cdc40bcb6fdb3618754': 'https://twitter.com/ti_bi_ke/status/1311784527648391169',\n    '0x72a0d01ab425b9337f1c156cca9cdc42ea66d03c': 'https://twitter.com/protocollayer/status/1311797470792429569',\n    '0x2ec7947f3ac9aaaa44b53640506cdc9d848d9489': 'https://twitter.com/skumbagt/status/1312108592737083392',\n    '0xa483cda2b861bf47b1fbdc4e79cb58e843d2b1ca': 'https://twitter.com/kferretcrypto/status/1312147841679122434',\n    '0xf90e729c01a5116cf0925c155b70dfb97d15e457': 'https://twitter.com/Fendimannn/status/1312194276105703424',\n    '0x3b16821a5dbbff86e4a88ea0621ec6be016cd79a': 'https://twitter.com/drakefjustin/status/1312659960552198144',\n    '0x1db3439a222c519ab44bb1144fc28167b4fa6ee6': 'https://twitter.com/VitalikButerin/status/1312659953098784768',\n    '0xd334741d0766b257b18f2d058e844e17e346a0c1': 'https://twitter.com/CarlBeek/status/1312712765530951680', \n    '0xd45a8f8bb4463e62a39ce6359ee6ac5c2c942cae': 'https://twitter.com/twfhyr/status/1312727780337967107',\n    '0x69fe53eb3791dd135f71157b660c66caeff648f5': 'https://twitter.com/smart_wallet_1/status/1312766730721132545',\n    '0x8da1dbeca9f637fd5ee5d44a017b2e54ed235255': 'https://twitter.com/fishkiller/status/1312767380360032261',\n    '0xbc8dafeaca658ae0857c80d8aa6de4d487577c63': 'https://twitter.com/Victor928/status/1312929347095781376',\n    '0x358a906ca407a35de33b930aa7cf49a301a4def1': 'https://twitter.com/kevingaspar/status/1312944589268021248',\n    '0xa6a55c2699ea8ce97eedefdfbb24027e64943825': 'https://twitter.com/jay_loopring/status/1313030919532376070',\n    '0x2708ea0287dee1bdb6d09d8efbbae12bae78070c': 'https://twitter.com/fintie/status/1313101867837079552',\n    '0xee8091771021eb51ec7ad8ada26e2922023b3a13': 'https://twitter.com/dmihal/status/1313780751159177216',\n    '0x1786d033d5cbcc235b673e872c7613c2f83da583': 'https://twitter.com/NirbhikJangid/status/1313882894813650947',\n    '0x7148adcbf447e13b13390689ee5425886ca0cf3a': 'https://twitter.com/stanlyjohnson72/status/1313922896738230272',\n    '0x545c83e60bdc60cbc6357c33d817b4ba6ff832a9': 'https://twitter.com/bitcoinislife/status/1314153308894965760',\n    '0x5d3c106b91de817c4fb5e255bf87b6cd6a697d29': 'https://twitter.com/thesaltynarwhal/status/1314178692847984640',\n    '0x559960cce06978064aa6aeba5b2d8b3150d11ae6': 'https://twitter.com/Emiel94871727/status/1314165438872420352',\n    '0x568312a86f19695f9c21f472717f4f1dd8281907': 'https://twitter.com/eduardoagut/status/1314257121794560003',\n    '0x21b9dfc3d06d87639050314f2b53df0224e47faa': 'https://twitter.com/jl2fa/status/1314409822180249611',\n    '0x29acc35da10b4b00fd135e0077822e95ba928410': 'https://twitter.com/cshaotweets/status/1316460551447298048',\n    \n    \n}\n","import React, {useEffect, useState} from \"react\";\nimport {css} from \"emotion\";\nimport { Paper } from \"../design-system/Paper\";\nimport {Helmet} from \"react-helmet\";\nimport {TwitterTweetEmbed} from 'react-twitter-embed';\nimport {TimeToNow} from \"../components/FormattedTime\";\nimport {TorchMapping} from \"../torchAccountMapping\";\n\n\nexport function ZksyncTorch() {\n  return <div className={css`\n      padding: 1em;\n    `}>\n    <Helmet>\n      <title>#tBTCzksynctorch</title>\n    </Helmet>\n    <Content />\n  </div>\n}\n\nexport function Content() {\n  const [chain, setChain] = useState<any>(null);\n  const [error, setError] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    setLoading(true);\n    fetch('https://tbtc-torch.srvpool.de/torch').then(async (r) => {\n      const data = await r.json()\n      setChain(data.reverse());\n      setLoading(false);\n    }).catch(() => {\n      setError(true);\n      setLoading(false);\n    })\n  }, [])\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :(</p>;\n\n  return <div className={css`\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n  `}>\n    <div className={css`\n      display: flex;\n      flex-direction: row;\n      font-size: 30px;\n      margin-top: 20px;\n      margin-bottom: 45px;\n  `}>\n      <a href={\"https://twitter.com/search?q=%23tBTCzksynctorch&src=typed_query\"}>#tBTCzksynctorch</a>\n    </div>\n\n\n    <div className={css`\n      display: flex;\n      flex-direction: column;\n      & > * {\n        margin-right: 20px;\n        }\n    `}>\n      {\n        chain!.map((item: any, idx: number) => {\n          return <div className={css`\n            margin-bottom: 10px;\n          `}>\n            <Step\n                num={chain!.length - idx + 1}\n                from={item.to}\n                amount={item.amount}\n                time={item.timestamp}\n                txid={item.tx_id}\n            />\n            <div style={{\n              textAlign: 'center',\n              margin: 20\n            }}>\n              \n            </div>\n          </div>\n        })\n      }\n      <Step num={1} from={chain[chain.length - 1].from} amount={0} />\n    </div>\n  </div>\n}\n\nfunction Step(props: {\n  txid?: string,\n  num: number,\n  from: any,\n  amount: any,\n  time?: any\n}) {\n  const {from, amount, time} = props;\n\n  let tweetUrl = (TorchMapping as any)[from];\n  if (typeof tweetUrl == 'object') {\n    tweetUrl = tweetUrl[props.txid ?? \"\"];\n  }\n  let tweetId;\n  if (tweetUrl) {\n    const match = tweetUrl.match(/status\\/(\\d+)$/);\n    tweetId = match[1];\n  }\n\n  return <Paper padding>\n    <div style={{color: 'gray', fontSize: '0.9em', display: 'flex', flexDirection: 'row', alignItems: 'center'}}>\n      <span className={css`\n          background: #48DBB4;\n          color: black;\n          width: 25px;\n          height: 25px;\n          border: 1px solid transparent;\n          border-radius: 50%;\n          display: inline-block;\n          text-align: center;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-right: 10px;\n      `}>{props.num}</span>\n      <TimeToNow time={time} /></div>\n    <div>\n      <a href={`https://zkscan.io/explorer/accounts/${from}`}>{from}</a>\n    </div>\n    {props.amount ? <div>\n      <strong>{amount / 1000000000000000000} TBTC</strong>\n    </div> : null}\n\n    {tweetId ? <TwitterTweetEmbed\n        tweetId={tweetId}\n        options={{\n          conversation: \"none\"\n        }}\n        placeholder={<div>...</div>}\n    /> : null}\n  </Paper>;\n}\n\n","import {gql, useQuery} from \"@apollo/client\";\nimport React from \"react\";\nimport {Paper} from \"../design-system/Paper\";\nimport { Address } from \"../components/Address\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport {Helmet} from \"react-helmet\";\nimport {SortableHeader, SortState, Table, useSort} from \"../components/Table\";\nimport {GetUsersQuery} from \"../generated/graphql\";\nimport {useEtherscanDomain} from \"../NetworkContext\";\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {SkeletonTableRow} from \"../components/SkeletonLoader\";\n\nconst USERS_QUERY = gql`\n    query GetUsers(\n        $orderBy: User_orderBy,\n        $direction: OrderDirection,\n        $block: Block_height\n    ) {\n        users(first: 1000, orderBy: $orderBy, orderDirection: $direction, block: $block) {\n            id,\n            address,\n            numDepositsCreated,\n            numDepositsUnfunded,\n            numDepositsRedeemed,\n            numOwnDepositsRedeemed\n        }\n    }\n`;\n\n\nexport function Users() {\n  const sortState = useSort(\"numDepositsCreated\");\n  const { loading, error, data } = useQueryWithTimeTravel<GetUsersQuery>(USERS_QUERY, {\n    variables: {\n      orderBy: sortState.column,\n      direction: sortState.direction\n    }\n  });\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Users</title>\n    </Helmet>\n    <h1 style={{marginTop: 0, marginBottom: 25}}>Users\n    </h1>\n    <Paper padding>\n      <UsersTable data={data} sortState={sortState} loading={loading} />\n    </Paper>\n  </div>\n}\n\n\nexport function UsersTable(props: {\n  data: any,\n  loading?: boolean,\n  sortState: SortState,\n}) {\n  const {data} = props;\n\n  return <Table\n      style={{width: '100%'}}>\n    <thead>\n    <tr>\n      <th>Address</th>\n      <th>\n        <SortableHeader fieldId={\"numDepositsCreated\"} state={props.sortState}>\n          # Created <InfoTooltip>Number of deposits the address has initiated.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"numDepositsUnfunded\"} state={props.sortState}>\n          # Unfunded <InfoTooltip>Number of deposits the address has initiated, and then not completed funding.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"numDepositsRedeemed\"} state={props.sortState}>\n          # Redeemed <InfoTooltip>Number of deposits this address has redeemed.</InfoTooltip>\n        </SortableHeader>\n      </th>\n      <th>\n        <SortableHeader fieldId={\"numOwnDepositsRedeemed\"} state={props.sortState}>\n          # Own Redeemed <InfoTooltip>Number of deposits this address has redeemed which were also created by it.</InfoTooltip>\n        </SortableHeader>\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    {props.loading ? <SkeletonTableRow columns={5} /> : null}\n    {data?.users.map((user: any) => {\n      return <tr key={user.id}>\n        <td>\n          <Address long address={user.address} />\n        </td>\n        <td>{user.numDepositsCreated}</td>\n        <td>{user.numDepositsUnfunded}</td>\n        <td>{user.numDepositsRedeemed}</td>\n        <td>{user.numOwnDepositsRedeemed}</td>\n      </tr>\n    })}\n    </tbody>\n  </Table>\n}\n","import {gql, useQuery} from \"@apollo/client\";\nimport React from \"react\";\nimport {Paper} from \"../../design-system/Paper\";\nimport {Hash} from \"../../components/Address\";\nimport {InfoTooltip} from \"../../components/InfoTooltip\";\nimport {Helmet} from \"react-helmet\";\nimport {Table} from \"../../components/Table\";\nimport {GetRelayEntriesQuery} from \"../../generated/graphql\";\nimport {TimeBetween, TimeToNow} from \"../../components/FormattedTime\";\nimport {Tab, TabList, TabPanel, Tabs } from \"react-tabs\";\nimport 'react-tabs/style/react-tabs.css';\nimport {ETHValue} from \"../../components/ETHValue\";\nimport {ETHTag, GweiTag} from \"../../components/CurrencyTags\";\nimport {getGroupName} from \"./GroupName\";\nimport {useQueryWithTimeTravel} from \"../../TimeTravel\";\n\n\nconst BEACON_QUERY = gql`\n    query GetRelayEntries($block: Block_height) {\n        randomBeaconGroups(first: 1000, orderBy: createdAt, orderDirection: desc, block: $block) {\n            id,\n            pubKey,\n            createdAt,\n            uniqueMemberCount,\n            rewardPerMember,\n        }\n        relayEntries(first: 1000, orderBy: requestedAt, orderDirection: desc, block: $block) {\n            id,\n            requestId,\n            value,\n            requestedAt,\n            generatedAt,\n            rewardPerMember,\n            group {\n                id,\n                pubKey\n            }\n        }\n    }\n`;\n\n\nexport function Beacon() {\n  const { loading, error, data } = useQueryWithTimeTravel<GetRelayEntriesQuery>(BEACON_QUERY, );\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Random Beacon</title>\n    </Helmet>\n    <h1 style={{marginTop: 0, marginBottom: 25}}>\n      Random Beacon\n    </h1>\n\n    <Tabs>\n      <TabList>\n        <Tab>\n          Entries <InfoTooltip>Random numbers requested by smart contracts on Ethereum, notably the tBTC system.</InfoTooltip>\n        </Tab>\n        <Tab>\n          Groups <InfoTooltip>Operator groups tasked with providing randomness.</InfoTooltip>\n        </Tab>\n      </TabList>\n\n      <TabPanel>\n        <Paper padding>\n          <RelayEntriesTable data={data} />\n        </Paper>\n      </TabPanel>\n      <TabPanel>\n        <Paper padding>\n          <BeaconGroupsTable data={data} />\n        </Paper>\n      </TabPanel>\n    </Tabs>\n  </div>\n}\n\n\nexport function RelayEntriesTable(props: {\n  data: any,\n}) {\n  const {data} = props;\n\n  return <Table\n      style={{width: '100%'}}>\n    <thead>\n    <tr>\n      <th>\n        Requested At\n      </th>\n      <th>\n        Provided After\n      </th>\n      <th>\n        Group <InfoTooltip>The group providing this result.</InfoTooltip>\n      </th>\n      <th>\n        Reward <InfoTooltip>ETH earned by each member of the group providing this value.</InfoTooltip>\n      </th>\n      <th>\n        Random Value\n      </th>\n      <th>Request ID</th>\n    </tr>\n    </thead>\n    <tbody>\n    {data.relayEntries.map((entry: any) => {\n      return  <tr key={entry.id}>\n        <td><TimeToNow time={entry.requestedAt} /></td>\n        <td>\n          <TimeBetween earlier={entry.requestedAt} later={entry.generatedAt} />\n        </td>\n        <td>\n          <Hash hash={entry.group.pubKey} to={`/group/${entry.group.id}`}>{getGroupName(entry.group.id)}</Hash>\n        </td>\n        <td>\n          {\n            entry.value ? <>\n              <GweiTag /> <ETHValue unit={\"gwei\"} wei={entry.rewardPerMember} />\n            </> : null\n          }\n\n        </td>\n        <td style={{fontSize: '14px'}}>\n          {entry.value ? <>{entry.value.slice(0, 12)}...</> : null}\n        </td>\n        <td>\n          {entry.requestId}\n        </td>\n      </tr>\n    })}\n    </tbody>\n  </Table>\n}\n\n\nexport function BeaconGroupsTable(props: {\n  data: any,\n}) {\n  const {data} = props;\n\n  return <Table\n      style={{width: '100%'}}>\n    <thead>\n    <tr>\n      <th>\n        Group\n      </th>\n      <th>\n        Total Rewards <InfoTooltip>ETH earned by each member in this group.</InfoTooltip>\n      </th>\n      <th>\n        Created At\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    {data.randomBeaconGroups.map((group: any) => {\n      return  <tr key={group.id}>\n        <td>\n          <Hash hash={group.pubKey} to={`/group/${group.id}`}>{getGroupName(group.id)}</Hash>\n        </td>\n        {/*<td>*/}\n        {/*  {group.memberCount}*/}\n        {/*</td>*/}\n        <td>\n          <ETHTag /> <ETHValue unit={\"eth\"} wei={group.rewardPerMember} />\n        </td>\n        <td><TimeToNow time={group.createdAt} /></td>\n      </tr>\n    })}\n    </tbody>\n  </Table>\n}\n","import {gql} from \"@apollo/client\";\nimport React from \"react\";\nimport {Paper} from \"../design-system/Paper\";\nimport {Helmet} from \"react-helmet\";\nimport type {GetRandomBeaconGroupQuery} from \"../generated/graphql\";\nimport {useParams} from \"react-router\";\nimport {getGroupName} from \"./Beacon/GroupName\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport {Hash} from \"../components/Address\";\nimport {ETHTag, GweiTag, KeepTag} from \"../components/CurrencyTags\";\nimport {ETHValue} from \"../components/ETHValue\";\nimport {Table} from \"../components/Table\";\nimport {css} from \"emotion\";\nimport {Box} from \"../components/Box\";\nimport {TimeBetween, TimeToNow} from \"../components/FormattedTime\";\nimport {Tab, TabList, TabPanel, Tabs} from \"react-tabs\";\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {keepFormatter} from \"../components/KeepValue\";\nimport {HeaderBoxes} from \"../components/HeaderBoxes\";\nimport {PageHeader} from \"../components/PageHeader\";\n\nconst BEACONGROUP_QUERY = gql`\n    query GetRandomBeaconGroup($id: ID!, $block: Block_height) {\n        randomBeaconGroup(id: $id, block: $block) {\n            id,\n            createdAt,\n            rewardPerMember,\n            memberships(orderBy: count, orderDirection: desc) {\n                id,\n                count,\n                reward,\n                operator {\n                    address,\n                    stakedAmount\n                }\n            },\n            relayEntries(first: 1000, orderBy: requestedAt, orderDirection:desc) {\n                id,\n                requestId,\n                value,\n                requestedAt,\n                generatedAt,\n                rewardPerMember,\n                group {\n                    id,\n                    pubKey\n                }\n            }\n        }\n    }\n`;\n\n\nexport function BeaconGroup() {\n  const {id} = useParams<any>();\n  const { loading, error, data } = useQueryWithTimeTravel<GetRandomBeaconGroupQuery>(BEACONGROUP_QUERY, {variables: {id}});\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  const group = data!.randomBeaconGroup;\n  if (!group) return <p>No such group.</p>;\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Random Beacon Group: {getGroupName(group.id)}</title>\n    </Helmet>\n\n    <PageHeader label={getGroupName(group.id)} subtitle={\"Random Beacon Group\"}>\n      <HeaderBoxes>\n        <Box\n            label={\"reward per member\"}\n        >\n          <ETHValue wei={group.rewardPerMember} /> ETH\n        </Box>\n\n        <Box\n            label={\"created\"}\n        >\n          <TimeToNow time={group.createdAt} />\n        </Box>\n\n      </HeaderBoxes>\n    </PageHeader>\n\n    <Tabs>\n      <TabList>\n        <Tab>\n          Members\n        </Tab>\n        <Tab>\n          Entries <InfoTooltip>Entries generated by this group.</InfoTooltip>\n        </Tab>\n      </TabList>\n\n      <TabPanel>\n        <Paper padding>\n          <Table\n              style={{width: '100%'}}>\n            <thead>\n            <tr>\n              <th>\n                Operator\n              </th>\n              <th>\n                Weight <InfoTooltip>An operator can fill multiple membership slots in a group, and will then earn a multiple of rewards.</InfoTooltip>\n              </th>\n              <th>\n                ETH Earned <InfoTooltip>ETH earned by the operator through membership in the group.</InfoTooltip>\n              </th>\n              <th>\n                Amount Staked <InfoTooltip>The amount of KEEP staked affects how often an operator is chosen for a beacon group, and at what weight.</InfoTooltip>\n              </th>\n            </tr>\n            </thead>\n            <tbody>\n            {group.memberships.map((membership: any) => {\n              const {group} = membership;\n              return <tr key={membership.id}>\n                <td>\n                  <Hash hash={membership.operator.address} to={`/operator/${membership.operator.address}`} />\n                </td>\n                <td>\n                  {membership.count}\n                </td>\n                <td>\n                  <ETHTag/> <ETHValue unit={\"eth\"} wei={membership.reward}/>\n                </td>\n                <td>\n                  <KeepTag/> {keepFormatter.format(membership.operator.stakedAmount)}\n                </td>\n              </tr>\n            })}\n            </tbody>\n          </Table>\n        </Paper>\n      </TabPanel>\n\n      <TabPanel>\n        <Paper padding>\n          <Table\n              style={{width: '100%'}}>\n            <thead>\n            <tr>\n              <th>\n                Requested At\n              </th>\n              <th>\n                Provided After\n              </th>\n              <th>\n                Reward <InfoTooltip>ETH earned by each member of the group providing this value.</InfoTooltip>\n              </th>\n              <th>\n                Random Value\n              </th>\n              <th>Request ID</th>\n            </tr>\n            </thead>\n            <tbody>\n            {(group as any).relayEntries.map((entry: any) => {\n              return  <tr key={entry.id}>\n                <td><TimeToNow time={entry.requestedAt} /></td>\n                <td>\n                  <TimeBetween earlier={entry.requestedAt} later={entry.generatedAt} />\n                </td>\n                <td>\n                  {\n                    entry.value ? <>\n                      <GweiTag /> <ETHValue unit={\"gwei\"} wei={entry.rewardPerMember} />\n                    </> : null\n                  }\n\n                </td>\n                <td style={{fontSize: '14px'}}>\n                  {entry.value ? <>{entry.value.slice(0, 12)}...</> : null}\n                </td>\n                <td>\n                  {entry.requestId}\n                </td>\n              </tr>\n            })}\n            </tbody>\n          </Table>\n        </Paper>\n      </TabPanel>\n    </Tabs>\n  </div>\n}\n","import {gql} from \"@apollo/client\";\nimport React, {Fragment, useCallback, useEffect, useState} from \"react\";\nimport {Helmet} from \"react-helmet\";\nimport type {GetStakedropDataQuery} from \"../generated/graphql\";\nimport {useParams} from \"react-router\";\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {dateTimeFrom, formatSeconds, FormattedTime} from \"../components/FormattedTime\";\nimport {keepFormatter} from \"../components/KeepValue\";\nimport { DateTime } from \"luxon\";\nimport {HeaderBoxes} from \"../components/HeaderBoxes\";\nimport {Box} from \"../components/Box\";\nimport {CoinPrices, useCoinPrices} from \"../utils/useCoinPrices\";\nimport {DollarValue} from \"../components/DollarValue\";\nimport {css} from \"emotion\";\nimport {SkeletonWord} from \"../components/SkeletonLoader\";\nimport {formatPercentage} from \"../utils/formatNumber\";\nimport {toNumber} from 'lodash';\nimport {Tab, TabList, TabPanel, Tabs} from \"react-tabs\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport Tippy from \"@tippyjs/react\";\n\n\nconst STAKEDROP_QUERY = gql`\n    query GetStakedropData($block: Block_height) {\n        stakedropIntervals {\n            id,\n            number,\n            beaconIntervalStart,\n            beaconIntervalEnd,\n            ecdsaIntervalStart,\n            ecdsaIntervalEnd,\n            keepCount,\n            beaconGroupCount,\n            allocationECDSA,\n            allocationBeacon,\n        },\n        stats: statsRecord(id: \"current\") {\n            totalStakedropECDSARewards,\n            unallocatedStakedropECDSARewards,\n            totalStakedropBeaconRewards,\n            unallocatedStakedropBeaconRewards,\n            dispensedStakedropBeaconRewards,\n            dispensedStakedropECDSARewards\n        },\n        status: statusRecord(id: \"current\") {\n          totalRewardWeight\n        }\n    }\n`;\n\n\nconst ecdsaWeights = [0.04,\n  0.0768,\n  0.08832000000000001,\n  0.0953856,\n  0.10492416,\n  0.089185536,\n  0.0758077056,\n  0.06443654976,\n  0.054771067296,\n  0.0465554072016,\n  0.03957209612136,\n  0.033636281703155996,\n  0.028590839447682596,\n  0.02430221353053021,\n  0.020656881500950675,\n  0.017558349275808075,\n  0.014924596884436864,\n  0.012685907351771334,\n  0.010783021249005634,\n  0.00916556806165479,\n  0.0077907328524065705,\n  0.006622122924545585,\n  0.005628804485863747,\n  0.004784483812984185];\nconst maxWeight = Math.max(...ecdsaWeights);\nconst totalRewards = 200000000;\nconst ecdsaStart = 1600041600;\n// In solidity this is 30 days, which seems to be a set number of seconds\nconst SECONDS_DAY = 24 * 3600;\nlet termLength = 30 * SECONDS_DAY;\n\n\nfunction getCurrentInterval() {\n  return intervalOf(Date.now() / 1000);\n}\n\nfunction intervalOf(timestamp: number): number {\n  let programStart = ecdsaStart;\n  let maxIntervals = ecdsaWeights.length;\n\n  // Should not happen, but the solidity code counts those for the first interval.\n  if (timestamp < programStart) {\n    return 0;\n  }\n\n  let difference = timestamp - programStart;\n  let interval = difference / termLength;\n  if (interval >= maxIntervals) {\n    return -1;\n  }\n  return Math.floor(interval);\n}\n\nfunction getIntervalStart(interval: number): number {\n  return interval * termLength + ecdsaStart;\n}\nfunction getIntervalEnd(interval: number): number {\n  return getIntervalStart(interval) + termLength;\n}\n\n\nexport function Stakedrop() {\n  const {id} = useParams<any>();\n  const { error, data } = useQueryWithTimeTravel<GetStakedropDataQuery>(STAKEDROP_QUERY, {variables: {id}});\n  const coinPrices = useCoinPrices();\n\n  const [calculatorData, setCalculatorData] = useState<APYCalculatorState|null>(null);\n  const handleRewardShareChanged = useCallback((data: APYCalculatorState) => {\n    setCalculatorData(data);\n  }, [])\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  const intervals = [...(data?.stakedropIntervals ?? [])];\n  intervals.reverse();\n\n  const currentIntervalECDSAAllocation = ecdsaWeights[getCurrentInterval()] * totalRewards;\n\n  return  <div style={{padding: '20px', maxWidth: '1000px', margin: '0 auto'}}>\n    <Helmet>\n      <title>Stakedrop</title>\n    </Helmet>\n    <h1 style={{marginTop: 0, fontSize: 45, fontFamily: \"Roboto Slab\", color: '#4e8778', fontWeight: 900, borderBottom: '2px dotted #4e8778', textAlign: 'center'}}>\n      The Stakedrop\n    </h1>\n\n    <div style={{margin: '0 auto 60px'}}>\n      <HeaderBoxes style={{justifyContent: 'center'}}>\n        <div>\n          The Stakedrop is an incentive program that rewards node operators with KEEP tokens in exchange for providing\n          collateral to the system.\n          <p>\n            Learn more about the program in the <a href={\"https://staking.keep.network/about-staking/staking-economics\"}>Keep documentation</a> or\n            read the <a href={\"https://blog.keep.network/a-new-rewards-mechanism-deef3412c3e1\"}>Keep blog.</a>\n          </p>\n        </div>\n        <Box label={\"total allocation\"} tooltip={\"Total rewards to be distributed to node  operators over the 2-year stakedrop period.\"}>\n          <strong>{keepFormatter.format(totalRewards)}</strong>\n          <KeepAsDollarValue coinPrices={coinPrices} keep={totalRewards} style={{display: 'block'}} />\n        </Box>\n      </HeaderBoxes>\n    </div>\n\n\n    <Tabs>\n      <TabList>\n        <Tab>\n          ECDSA <InfoTooltip>Rewards for ETH providers.</InfoTooltip>\n        </Tab>\n        <Tab>\n          Beacon <InfoTooltip>Rewards for Beacon operators.</InfoTooltip>\n        </Tab>\n      </TabList>\n\n      <TabPanel>\n        <APYCalculatorUI\n            totalWeight={data?.status ? parseFloat(data.status?.totalRewardWeight) : null}\n            onRewardShareChanged={handleRewardShareChanged}\n            intervalAllocation={currentIntervalECDSAAllocation}\n        />\n\n        <div className={css`\n          margin-top: 50px;\n          display: flex;\n          flex-direction: row;\n          height: 300px;\n          justify-content: center;\n          align-items: flex-start;\n          \n          .interval-container {\n            max-width: 45px;\n            flex: 1;\n            margin: 2px;\n            writing-mode: vertical-lr;\n            height: 100%;\n            display: flex;\n            justify-content: flex-end;\n            align-items: center;\n          }\n          .interval-bar {\n            color: white;\n            display: flex;\n            width: 100%;\n            flex-direction: row;\n            align-items: center;\n            justify-content: flex-end;\n            padding: 10px 0;\n          }\n          .interval-outsidetext {\n            flex-direction: row;\n            align-items: center;\n            justify-content: center;\n            padding: 10px 0;\n          }\n          .interval-text {\n            display: block;\n            transform: rotate(-180deg);\n          }\n          .number {\n            writing-mode: lr;\n            font-size: 14px;\n            margin-top: 3px;\n            color: gray; \n          }\n        `}>\n          {\n            ecdsaWeights.map((weight, idx) => {\n              const height = weight / maxWeight * 100;\n              const startTimestamp = getIntervalStart(idx);\n              const endTimestamp = getIntervalEnd(idx);\n              const hasEnded = Date.now() / 1000 > endTimestamp;\n              const monthString = dateTimeFrom(startTimestamp).toLocaleString({month: 'long', year: 'numeric'});\n\n              const calcResult = (calculatorData?.eth && calculatorData?.keep && calculatorData?.rewardShare) ? calculateAPR({\n                rewardShare: calculatorData?.rewardShare,\n                intervalAllocation: ecdsaWeights[idx] * totalRewards,\n                ethUsed: calculatorData?.eth ?? null,\n                keepUsed: calculatorData?.keep,\n                coinPrices\n              }) : null;\n\n              const tooltipText = hasEnded ? <>\n                Ran from <FormattedTime format={\"simple\"} time={startTimestamp}/> to <FormattedTime format={\"full\"} time={endTimestamp}/>.\n                Distributed {keepFormatter.format(weight * totalRewards)} <small>KEEP</small>.\n              </> : <>\n                Runs from <FormattedTime format={\"simple\"} time={startTimestamp}/> to <FormattedTime format={\"full\"} time={endTimestamp}/>.\n                Distributes {keepFormatter.format(weight * totalRewards)} <small>KEEP</small>.\n              </>\n              //const barText = <span className={\"interval-text\"}>{keepFormatter.format(weight * totalRewards)} <small>KEEP</small></span>;\n\n              //  ({formatPercentage(calcResult.apr)}% APR)\n              // const barText = calcResult\n              //     ? <>{keepFormatter.format(calcResult.keep)} <small>KEEP</small></>\n              //     : monthString\n              const barText = monthString;\n\n              return <div className={\"interval-container\"}>\n                {height <= 50 ? <div className={\"interval-outsidetext\"}>\n                  <span className={\"interval-text\"}>{barText}</span>\n                </div>: null}\n                <Tippy content={tooltipText}>\n                  <div style={{height:`${height}%`, backgroundColor: hasEnded ? 'silver' : \"rgb(78, 135, 120)\"}} className={\"interval-bar\"}>\n                    {height > 50 ? <span className={\"interval-text\"}>{barText}</span> : null}\n                  </div>\n                </Tippy>\n                <div className={\"number\"}>\n                  {idx+1}\n                </div>\n              </div>\n            })\n          }\n        </div>\n\n        {intervals.length ? <div>\n          <h2 style={{marginTop: '70px'}}>Old Scheme</h2>\n          <p style={{marginTop: 0}}>\n            Stakedrop Intervals 1 and 2 used a different rewards mechanism. This is kept for historical reference.\n          </p>\n          {\n            intervals.slice(2).map(interval => {\n              return <div>\n                <SingleInterval interval={interval} coinPrices={coinPrices} showECDSA={true} showBeacon={false} />\n                {interval.number > 1 ? <hr className={css`\n                  background: #4e8778;\n                  height: 1px;\n                  border: 0;\n                `}/> : null}\n              </div>})\n          }\n        </div> : null}\n      </TabPanel>\n      <TabPanel>\n        {intervals.map((interval) => {\n          return <Fragment key={interval.number}>\n            <SingleInterval interval={interval} coinPrices={coinPrices} showECDSA={false} showBeacon={true} />\n            {interval.number > 1 ? <hr className={css`\n          background: #4e8778;\n          height: 1px;\n          border: 0;\n        `}/> : null}\n          </Fragment>\n        })}\n      </TabPanel>\n    </Tabs>\n  </div>\n}\n\n\nfunction SingleInterval(props: {\n  interval: GetStakedropDataQuery[\"stakedropIntervals\"][0],\n  coinPrices: CoinPrices,\n  showECDSA: boolean,\n  showBeacon: boolean\n}) {\n  const {interval, coinPrices} = props;\n  const perKeepPerOperator = interval.allocationECDSA / Math.max(interval.keepCount, 1000) / 3;\n  const perBeaconGroup = interval.allocationBeacon ? interval.allocationBeacon / interval.beaconGroupCount / 64 : null;\n\n  const ecdsaEndDate = dateTimeFrom(interval.ecdsaIntervalEnd);\n  const secondsToEcdsaEnd = ecdsaEndDate.diffNow('seconds').seconds;\n\n  const beaconEndDate = dateTimeFrom(interval.beaconIntervalEnd);\n  const secondsToBeaconEnd = beaconEndDate.diffNow('seconds').seconds;\n\n  const totalKeep = props.showECDSA ? parseInt(interval.allocationECDSA) : parseInt(interval.allocationBeacon ?? 0);\n  const start = props.showECDSA ? interval.ecdsaIntervalStart : interval.beaconIntervalStart;\n  const end = props.showECDSA ? ecdsaEndDate : beaconEndDate;\n  const secondsToEnd = props.showECDSA ? secondsToEcdsaEnd : secondsToBeaconEnd;\n\n  return <div style={{margin: '30px 0 30px', display: 'flex', flexDirection: 'row', alignItems: 'flex-start'}}>\n    <div>\n      <div style={{fontFamily: \"Roboto Slab\", color: '#4e8778', fontWeight: 900, fontSize: 60, lineHeight: 1}}>\n        {interval.number}\n        <span style={{fontSize: '0.4em'}}>\n              {interval.number == 1 ? 'st' : interval.number == 2 ? 'nd' : interval.number == 3 ? 'rd' : 'th'}\n            </span>\n      </div>\n      <div style={{color: '#4e8778'}}>Interval</div>\n    </div>\n\n    <div style={{marginLeft: '45px', display: 'flex', flexDirection: 'column', flex: 1}}>\n      <HeaderBoxes>\n        <Box label={\"KEEP to be distributed\"} style={{flex: 3}}>\n          {keepFormatter.format(totalKeep)}\n          <KeepAsDollarValue coinPrices={coinPrices}  keep={totalKeep} />\n        </Box>\n\n        {props.showECDSA ? <Box label={\"KEEP per deposit\"}  style={{flex: 2}}\n             tooltip={`Reward an operator earns for each deposit they are collateralizing in the interval. For interval ${interval.number} this is based on ${interval.keepCount} keeps created.`}>\n          {keepFormatter.format(perKeepPerOperator)}\n          <KeepAsDollarValue coinPrices={coinPrices}  keep={perKeepPerOperator} />\n        </Box> : null}\n\n        {props.showBeacon ? <Box label={\"KEEP per beacon group\"}  style={{flex: 2}}\n             tooltip={`Reward an operator earns for each beacon group they are participating in. For interval ${interval.number} this is based on ${interval.beaconGroupCount} groups.`}>\n          {perBeaconGroup === null ? <>-</> : <>\n            {keepFormatter.format(perBeaconGroup)}\n            <KeepAsDollarValue coinPrices={coinPrices}  keep={perBeaconGroup} />\n          </>}\n        </Box> : null}\n      </HeaderBoxes>\n\n      <div style={{marginTop: '16px', fontSize: '14px'}}>\n        {secondsToEnd > 0\n            ? <>\n              Began <FormattedTime time={start} format={\"simple\"} /> and there are {\" \"}\n              <span title={end.toLocaleString(DateTime.DATETIME_FULL)} style={{\n                color: 'green',\n                fontWeight: 'bold'\n              }}>{formatSeconds(secondsToEnd)} remaining</span>.\n            </>\n            : <>\n              Ran from <FormattedTime format={\"simple\"} time={start}/> to <FormattedTime\n                format={\"simple\"} time={end}/>.\n            </>\n        }\n      </div>\n    </div>\n  </div>\n}\n\nfunction KeepAsDollarValue(props: {\n  coinPrices: CoinPrices,\n  keep: number,\n  style?: any,\n  showTilde?: boolean\n}) {\n  if (!props.coinPrices.keep) {\n    return null;\n  }\n  const usdValue = props.keep * props.coinPrices.keep;\n  return <span style={{color: 'gray', fontSize: '0.5em', paddingLeft: '0.3em',  ...props.style}}>\n    {props.showTilde ? \"~\" : null}<DollarValue dollar={usdValue} showCents={false} />\n  </span>\n}\n\n\nfunction calculateAPR(props: {\n  coinPrices: CoinPrices,\n  ethUsed: number,\n  keepUsed: number,\n  rewardShare: number,\n  intervalAllocation: number,\n}) {\n  const {coinPrices, ethUsed, keepUsed, rewardShare, intervalAllocation} = props;\n  const {ethereum: ethPrice, keep: keepPrice} = coinPrices;\n  const keepRewards = rewardShare * intervalAllocation;\n\n  if (!keepPrice || !ethPrice) { return null; }\n\n  const includeKeepInApr = true;\n  let usdValueRewards, totalUsdInvested, totalIntervalYield, yieldPerYear: number;\n  usdValueRewards = keepRewards * keepPrice;\n  totalUsdInvested = (includeKeepInApr ? props.ethUsed * ethPrice : 0) + props.keepUsed * keepPrice;\n  totalIntervalYield = usdValueRewards / totalUsdInvested!\n  yieldPerYear = totalIntervalYield * 12;\n  return {\n    usd: usdValueRewards,\n    keep: keepRewards,\n    apr: yieldPerYear\n  }\n}\n\n\nfunction APYOutput(props: {\n  rewardShare: number|null,\n  intervalAllocation: number,\n  ethUsed: number|null,\n  keepUsed: number|null\n}) {\n  const coinPrices = useCoinPrices();\n  const {ethereum: ethPrice, keep: keepPrice} = coinPrices;\n  const {rewardShare, intervalAllocation, ethUsed,  keepUsed} = props;\n  \n  let calcResult: ReturnType<typeof calculateAPR>|null = null;\n  if (keepPrice && ethPrice && ethUsed && keepUsed && rewardShare) {\n    calcResult = calculateAPR({\n      rewardShare,\n      intervalAllocation,\n      ethUsed,\n      keepUsed,\n      coinPrices\n    });\n  }\n\n  if (rewardShare === null || calcResult === null) {\n    return null;\n  }\n\n  return <div className={css`\n    font-size: 16px;\n    .value {\n      margin: 10px 0;\n      font-size: 24px;\n    }\n    .value .header {\n      font-size: 0.7em; \n    }\n    strong small {\n    }\n  `}>\n    <div className={\"value\"}>\n      <div className={\"header\"}>Est. Payout Interval {getCurrentInterval()+1}</div>\n      <strong>{keepFormatter.format(calcResult.keep)} <small>KEEP</small></strong>\n      <KeepAsDollarValue showTilde={true} coinPrices={coinPrices}  keep={calcResult.keep} />\n    </div>\n\n    <div className={\"value\"}>\n      <div className={\"header\"}>APR</div>\n      <strong>{formatPercentage(calcResult.apr)}</strong>\n    </div>\n\n    <div>\n      <strong>{formatPercentage(rewardShare)}</strong> of rewards.\n    </div>\n  </div>\n}\n\n\ntype APYCalculatorState = {rewardShare: number|null, eth: number|null, keep: number|null};\n\nfunction APYCalculatorUI(props: {\n  onRewardShareChanged: (data: APYCalculatorState) => void,\n  totalWeight: number|null,\n  intervalAllocation: number\n}) {\n  const {totalWeight} = props;\n  const defaultEth = 300;\n  const defaultKeep = 80000;\n  const [eth, setEth] = useState<number|null>(defaultEth);\n  const [ethText, setEthText] = useState(defaultEth);\n  const [keep, setKeep] = useState<number|null>(defaultKeep);\n  const [keepText, setKeepText] = useState(defaultKeep);\n\n  const handleKeep = useCallback((e: any) => {\n    const value = e.target.value;\n    setKeepText(e.value);\n    const num = toNumber(value);\n    if (!Number.isNaN(num)) {\n      setKeep(num);\n    } else {\n      setKeep(null)\n    }\n  }, []);\n\n  const handleEth = useCallback((e: any) => {\n    const value = e.target.value;\n    setEthText(e.value);\n    const num = toNumber(value);\n    if (!Number.isNaN(num)) {\n      setEth(num);\n    } else {\n      setEth(null)\n    }\n  }, []);\n\n  const {rewardWeight} = (keep === null || eth === null) ? {rewardWeight: null}\n  : getStakedropRewardFormula({ethLocked: eth, stakedAmount: keep})\n  const share = (rewardWeight === null || totalWeight == null) ? null : rewardWeight / (totalWeight + rewardWeight);\n\n  useEffect(() => {\n    props.onRewardShareChanged({rewardShare: share, eth, keep});\n  }, [share])\n\n  return <div className={css`\n    border: 1px silver dotted;\n    padding: 20px;\n    background: white;\n    \n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    justify-content: flex-start;\n    \n    .inputs {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n    h3 {\n      margin: 0px;\n      margin-bottom: 15px;\n      font-size: 18px;\n    }\n    .inputs > div {\n      margin: 5px;\n    }\n    .inputs label {\n      color: gray;\n      display: block;\n    }\n    input {\n      text-align: center;\n      font-size: 22px;\n      padding: 0.4em;\n    }\n    .result {\n      flex: 1;\n      text-align: center;\n    }\n  `}>\n    <div className={\"root\"}>\n      <h3>Rewards Calculator</h3>\n      <div className={\"inputs\"}>\n        <div>\n          <label>KEEP Staked</label>\n          <input value={keepText} onChange={handleKeep} />\n        </div>\n        <div>\n          <label>ETH Locked</label>\n          <input value={ethText} onChange={handleEth} />\n        </div>\n      </div>\n    </div>\n    <div className={\"result\"}>\n      <APYOutput\n          rewardShare={share}\n          intervalAllocation={props.intervalAllocation}\n          ethUsed={eth}\n          keepUsed={keep}\n      />\n    </div>\n  </div>\n}\n\n\nexport function getStakedropRewardFormula(opts: {\n  ethLocked: number,\n  stakedAmount: number\n}) {\n  // =IF(B11>3000,2*SQRT(B11*3000)-3000,B11)\n  const ethScore = opts.ethLocked > 3000\n      ? (Math.sqrt(opts.ethLocked * 3000) * 2) - 3000\n      : opts.ethLocked;\n\n  const MinStake = 70000;\n  // This will start to be wrong once MinStake changes. We might have to calculate the value for\n  // all min stake values, or come up with a clever formula.\n  // =IF(B11=0,0,1+MIN(C11/70000,SQRT(C11/(B11*500))))\n  const boostFactor1 = opts.stakedAmount / MinStake;\n  const boostFactor2 = opts.ethLocked == 0 ? 0 : Math.sqrt(opts.stakedAmount / (opts.ethLocked * 500));\n  const boost = 1 + Math.min(boostFactor1, boostFactor2);\n\n  const rewardWeight = ethScore * boost;\n  return {rewardWeight, boost, ethScore};\n}","import {gql, useQuery} from \"@apollo/client\";\nimport React, {useEffect} from \"react\";\nimport {Paper} from \"../design-system/Paper\";\nimport {Address} from \"../components/Address\";\nimport {InfoTooltip} from \"../components/InfoTooltip\";\nimport {Helmet} from \"react-helmet\";\nimport {RTHeader, SortState, Table, useSort} from \"../components/Table\";\nimport {GetUsersQuery} from \"../generated/graphql\";\nimport {Column, useSortBy, useTable} from 'react-table';\nimport {useQueryWithTimeTravel} from \"../TimeTravel\";\nimport {SkeletonTableRow} from \"../components/SkeletonLoader\";\nimport {formatSeconds, FormattedTime, TimeBetween, TimeToNow} from \"../components/FormattedTime\";\nimport {KeepValue} from \"../components/KeepValue\";\nimport {KeepTag} from \"../components/CurrencyTags\";\nimport Tippy, {useSingleton} from \"@tippyjs/react\";\nimport {FixedNumber} from \"ethers\";\nimport {useMemo} from \"react\";\nimport {LabelWithBackgroundProgress} from \"./Deposit/StatusBox\";\n\nconst GRANTS_QUERY = gql`\n    query GetGrants(\n        $orderBy: Grant_orderBy,\n        $direction: OrderDirection,\n        $block: Block_height\n    ) {\n        grants(first: 1000, orderBy: $orderBy, orderDirection: $direction, block: $block) {\n          id,\n          grantee,\n          revokedAt,\n          revokedAmount,\n          revokedWithdrawn,\n          revocable,\n          amount,\n          duration,\n          timestamp,\n          start,\n          cliff,\n          withdrawn,\n          staked,\n          stakingPolicy,\n          transactionHash,\n        }\n    }\n`;\n\n\nexport function Grants() {\n  const sortState = useSort(\"timestamp\");\n\n  const { loading, error, data } = useQueryWithTimeTravel<GetUsersQuery>(GRANTS_QUERY, {\n    variables: {\n      orderBy: sortState.column,\n      direction: sortState.direction\n    }\n  });\n\n  if (error) return <p>Error :( {\"\"+ error}</p>;\n\n  return  <div style={{padding: '20px'}}>\n    <Helmet>\n      <title>Grants</title>\n    </Helmet>\n    <h1 style={{marginTop: 0, marginBottom: 25}}>\n      Grants\n    </h1>\n    <Paper padding>\n      <GrantsTable data={data} sortState={sortState} loading={loading} />\n    </Paper>\n  </div>\n}\n\n\nconst KnownStakingPolicies: {[address: string]: {label: string, description?: string}} = {\n  // NB: Adaptive Policy:\n  // - You can find the multiplier in the constructor arguments\n  // - You can find the stakeahead time in constructor arg number 3: Decode to decimal is the time in seconds.\n  '0x1b612f89eee49b0fb1dcd429cf2109a9699acd53': {\n    label: \"Permissive\",\n    description: 'Allows the grantee to stake the entire grant, regardless of its unlocking status.'\n  },\n  '0x36d293d15168ccdf93d1294d4a51a6d6c070f1ff': {\n    label: 'Adaptive 5x/90d',\n    description: 'Allows the grantee to always stake 5 times the minimum stake, or the amount that would be unlocked 90 days in the future, if it is greater.'\n  },\n  '0x68d9e6f0bee28a2ba31ab4410fd42205550d5612': {\n    label: 'Adaptive 1x/90d',\n    description: 'Allows the grantee to always stake the minimum stake, or the amount that would be unlocked 90 days in the future, if it is greater.'\n  },\n  '0x3715f0775310d970697f164699820e1a93109eac': {\n    label: 'Adaptive 0x/90d',\n    description: 'Allows the grantee to stake the amount that would be unlocked 90 days in the future.'\n  },\n  '0x57edf653ba095feea910fa62298654dfc588d762': {\n    label: 'Adaptive 5x/-',\n    description: 'Allows the grantee to always stake 5 times the minimum stake.'\n  },\n  '0x4c3ad59b5a32f2d076051d01d6f58bc75d278159': {\n    label: 'Guaranteed Minimum',\n    description: 'Allows the grantee to always stake the minimum stake, or the unlocked amount if greater.'\n  },\n}\n\n\nexport function GrantsTable(props: {\n  data: any,\n  loading?: boolean,\n  sortState: SortState,\n}) {\n  const {data} = props;\n  const [source, target] = useSingleton();\n\n  const columns = React.useMemo<(Column & {label?: string})[]>(\n    () => [\n      {\n        label: \"Updated At\",\n        tooltip: \"The last time any action affected this grant, including withdrawal, revocation or staking.\",\n        Header: RTHeader,\n        accessor: 'timestamp',\n        Cell: ({value, row}) => {\n          return <TimeToNow time={value} />\n        },\n      },\n      {\n        Header: 'Grantee',\n        Cell: ({value}) => {\n          return <Address address={value} />\n        },\n        accessor: 'grantee',\n      },\n      {\n        accessor: 'state',\n        label: 'State',\n        Header: RTHeader,\n        tooltip: \"Light Grey: Withdrawn, Green: Staked, Red: Revoked, Dark Gray: Rest\",\n        disableSortBy: true,\n        Cell: ({value, row}) => {\n          return <GrantAmountsAsBar grant={row.original as any}/>\n        }\n      },\n      {\n        label: 'Amount',\n        Header: RTHeader,\n        Cell: ({value}) => {\n          return <>\n            <KeepTag /> <KeepValue raw={value} />\n          </>\n        },\n        accessor: 'amount',\n      },\n      {\n        label: 'Withdrawn',\n        Header: RTHeader,\n        Cell: ({value}) => {\n          return <>\n            <KeepTag /> <KeepValue raw={value} />\n          </>\n        },\n        accessor: 'withdrawn',\n      },\n      {\n        label: 'Staked',\n        Header: RTHeader,\n        accessor: 'staked',\n        Cell: ({value}) => {\n          return <>\n            <KeepTag /> <KeepValue raw={value} />\n          </>\n        },\n      },\n      {\n        label: 'Duration',\n        tooltip: \"Total duration of the grant, over which time it gradually unlocks.\",\n        Header: RTHeader,\n        accessor: 'duration',\n        Cell: ({value, row}) => {\n          const obj = row.original as any;\n          const progress = Math.max(0, (Date.now() / 1000) - parseInt(obj.cliff));\n          const percent = progress / parseInt(value);\n\n          if (percent >= 1) {\n            return <span style={{color: 'gray'}}>{formatSeconds(value)}</span>\n          }\n\n          return <LabelWithBackgroundProgress\n            progress={percent}\n            singleColor={\"#f7e4ce\"}\n          >\n            {formatSeconds(value)}\n          </LabelWithBackgroundProgress>;\n        }\n      },\n      {\n        Header: 'Cliff',\n        accessor: 'cliff',\n        Cell: ({value, row}) => {\n          if ((row.original as any).start == value) {\n            return \"\";\n          }\n\n          return <TimeBetween earlier={(row.original as any).start} later={value} />\n        },\n      },\n      // {\n      //   Header: 'Revocable',\n      //   Cell: ({value}) => {\n      //     return value ? \"yes\" : 'no'\n      //   },\n      //   accessor: 'revocable',\n      // },\n      // {\n      //   Header: 'Revoked Amount',\n      //   accessor: 'revokedAmount',\n      //   Cell: ({value}) => {\n      //     if (!value) { return \"\"; }\n      //     return <>\n      //       <KeepTag /> <KeepValue raw={value} />\n      //     </>\n      //   }\n      // },\n      // {\n      //   Header: 'Revoked Withdrawn',\n      //   accessor: 'revokedWithdrawn',\n      //   Cell: ({value}) => {\n      //     if (!value) { return \"\"; }\n      //     return <>\n      //       <KeepTag /> <KeepValue raw={value} />\n      //     </>\n      //   }\n      // },\n      {\n        Header: RTHeader,\n        label: \"Start\",\n        accessor: 'start',\n        Cell: ({value}) => {\n          return <FormattedTime time={value} format={\"day-full\"} />\n        },\n      },\n      {\n        Header: 'Revoked',\n        accessor: 'revokedSummary',\n        Cell: ({value, row}) => {\n          const obj = row.original as any;\n          if (!obj.revokedAt || obj.revokedAt == '0') {\n            if (!obj.revocable) {\n              return <small style={{color: 'gray'}}>non-revocable</small>\n            }\n            return \"\";\n          }\n          return <>\n            <FormattedTime time={obj.revokedAt} format={\"day-full\"} />\n          </>\n        }\n      },\n      // {\n      //   Header: RTHeader,\n      //   label: \"Revoked At\",\n      //   accessor: 'revokedAt',\n      //   Cell: ({value}) => {\n      //     if (!value ||  value == \"0\") { return \"\"; }\n      //     return <FormattedTime time={value} format={\"day-full\"} />\n      //   }\n      // },\n      {\n        Header: RTHeader,\n        label: \"Staking Policy\",\n        Cell: ({value}) => {\n          const policy = KnownStakingPolicies[value] || {\n            label: null\n          }\n          return <>\n            <Address address={value} children={policy.label} /> {policy.description ? <InfoTooltip singleton={target}>{policy.description}</InfoTooltip> : null}\n          </>\n        },\n        accessor: 'stakingPolicy',\n      },\n    ],\n    []\n  )\n\n  const currentSortBy = useMemo(() => {\n    return [{id: props.sortState.column, desc: props.sortState.direction === 'desc'}]\n  }, [props.sortState]);\n\n  const tableInstance = useTable({\n    columns,\n    data: useMemo(() => {\n      return data?.grants ?? [];\n    }, [data?.grants]),\n    useControlledState: state => {\n      return React.useMemo(\n          () => ({\n            ...state,\n            sortBy: currentSortBy\n          }),\n          [state, currentSortBy]\n      )\n    },\n    manualSortBy: true,\n    autoResetSortBy: false,\n    // Custom data we pass through\n    sortState: props.sortState\n  }, useSortBy);\n\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    rows,\n    prepareRow,\n    state: { sortBy }\n  } = tableInstance;\n\n  return <>\n    <Tippy singleton={source} delay={500} />\n    <Table style={{width: '100%'}} {...getTableProps()}>\n      <thead>\n      {\n        headerGroups.map(headerGroup => (\n          <tr {...headerGroup.getHeaderGroupProps()}>\n            {\n              headerGroup.headers.map(column => {\n                return <th {...column.getHeaderProps()}>\n                  {\n                    column.render('Header')\n                  }\n                </th>\n              })\n            }\n          </tr>\n        ))}\n      </thead>\n      <tbody {...getTableBodyProps()}>\n      {props.loading ? <SkeletonTableRow columns={columns.length} /> : null}\n      {\n        rows.map(row => {\n          prepareRow(row)\n          return (\n            <tr {...row.getRowProps()}>\n              {\n                row.cells.map(cell => {\n                  return (\n                    <td {...cell.getCellProps()}>\n                      {\n                        cell.render('Cell')\n                      }\n                    </td>\n                  )\n                })\n              }\n            </tr>\n          )\n        })}\n      </tbody>\n    </Table>\n  </>\n}\n\n\nconst GrantAmountsAsBar = React.memo((props: {\n  grant: any\n}) => {\n  const obj = props.grant;\n  const total = FixedNumber.from(obj.amount);\n  if (total.isZero()) {\n    return null;\n  }\n  const staked = FixedNumber.from(obj.staked).divUnsafe(total);\n  const withdrawn = FixedNumber.from(obj.withdrawn).divUnsafe(total);\n  const revoked = FixedNumber.from(obj.revokedAmount).divUnsafe(total);\n  const remainder = FixedNumber.from(\"1\").subUnsafe(staked).subUnsafe(revoked).subUnsafe(withdrawn);\n\n  // return <div style={{width: '150px', position: 'relative', height: '20px', }}>\n  //   <div style={{width: '20%', position: 'absolute', backgroundColor: 'red', left: 0, top: 0, bottom: 0, right: 20}} />\n  //   <div style={{width: '30%', position: 'absolute', backgroundColor: 'green', left: 21, top: 0, bottom: 0, right: 90}} />\n  // </div>\n\n  // gray: #607d8b\n  // orange: #ffc107\n  const h = FixedNumber.from( \"100\");\n  return <div style={{width: '150px', height: '20px', display: 'flex', flexDirection: 'row'}}>\n    <div style={{backgroundColor: '#dcdcdc', width: `${withdrawn.mulUnsafe(h).toString()}px`}} />\n    <div style={{backgroundColor: '#4caf50', width: `${staked.mulUnsafe(h).toString()}px`}} />\n    <div style={{backgroundColor: '#90a4ae', width: `${remainder.mulUnsafe(h).toString()}px`}} />\n    <div style={{backgroundColor: '#f44336', width: `${revoked.mulUnsafe(h).toString()}px`}} />\n  </div>\n});","import React, {useMemo, useRef, useState} from 'react';\nimport {ApolloClient, ApolloProvider, HttpLink, InMemoryCache, split} from '@apollo/client';\nimport {BrowserRouter as Router, Link, Route, Switch, useHistory, useLocation,} from \"react-router-dom\";\nimport {css} from 'emotion'\nimport {Operators} from \"./pages/Operators\";\nimport {Operator} from \"./pages/Operator\";\nimport {Deposits} from \"./pages/Deposits\";\nimport {Deposit} from \"./pages/Deposit\";\nimport {NavigationButton} from \"./design-system/NavigationButton\";\nimport 'tippy.js/dist/tippy.css';\nimport {About} from \"./pages/About\";\nimport {Redirect} from \"react-router\";\nimport {Helmet} from \"react-helmet\";\nimport {Governance} from \"./pages/Governance\";\nimport {UseWalletProvider} from 'use-wallet'\nimport {WebSocketLink} from \"@apollo/client/link/ws\";\nimport {getMainDefinition} from \"@apollo/client/utilities\";\nimport {ZksyncTorch} from \"./pages/tBTCzkSyncTorch\";\nimport {Network, SetNetwork, useIsRopsten, useNetwork} from \"./NetworkContext\";\nimport {Users} from \"./pages/Users\";\nimport {Beacon} from \"./pages/Beacon\";\nimport {BeaconGroup} from \"./pages/Group\";\nimport {TimeTravelState, useTimeTravelBlock} from \"./TimeTravel\";\nimport {DateTime} from \"luxon\";\nimport {Paper} from \"./design-system/Paper\";\nimport Tippy from \"@tippyjs/react\";\nimport {Button} from \"./design-system/Button\";\nimport {Stakedrop} from \"./pages/Stakedrop\";\nimport {Grants} from \"./pages/Grants\";\n\n\nfunction makeApolloLink(uri: string) {\n  const httpLink = new HttpLink({\n    uri: 'https://' + uri\n  });\n\n  const wsLink = new WebSocketLink({\n    uri: `wss://` + uri,\n    options: {\n      reconnect: true\n    }\n  });\n\n  return split(\n    ({ query }) => {\n      const definition = getMainDefinition(query);\n      return (\n          definition.kind === 'OperationDefinition' &&\n          definition.operation === 'subscription'\n      );\n    },\n    wsLink,\n    httpLink,\n  );\n}\n\nfunction AppInternal() {\n  const isRopsten = useIsRopsten();\n\n  let url: string;\n  if (isRopsten) {\n    url = 'api.thegraph.com/subgraphs/name/miracle2k/all-the-keeps-ropsten';\n  }\n  else {\n    // DEV:\n    //url = 'api.thegraph.com/subgraphs/name/miracle2k/keep-network';\n    // LIVE\n    url = 'api.thegraph.com/subgraphs/id/QmRzyd7B2Q2JFWgtygn7NkUo1Zys1cFjRUx96NznvgGNsP';\n  }\n\n  const client = useMemo(() => {\n    return new ApolloClient({\n      cache: new InMemoryCache(),\n      link: makeApolloLink(url)\n    });\n  }, []);\n\n  return (\n      <Router>\n        <ApolloProvider client={client}>\n          <TimeTravelState>\n            <UseWalletProvider\n                chainId={isRopsten ? 3 : 1}\n            >\n              <Helmet titleTemplate=\"%s | AllTheKeeps\"></Helmet>\n              <Header />\n              <TimeTravelWarning />\n              <div className={css`            \n              `}>\n                <Switch>\n                  <Route path=\"/\" exact>\n                    <Redirect to=\"/deposits\" />\n                  </Route>\n                  <Route exact path=\"/deposits\">\n                    <Deposits />\n                  </Route>\n                  <Route exact path=\"/deposits/:view\">\n                    <Deposits />\n                  </Route>\n                  <Route path=\"/about\" exact>\n                    <About />\n                  </Route>\n                  <Route path=\"/torch\" exact>\n                    <ZksyncTorch />\n                  </Route>\n                  <Route path=\"/governance\" exact>\n                    <Governance />\n                  </Route>\n                  <Route path=\"/operators\" exact>\n                    <Operators />\n                  </Route>\n                  <Route path=\"/users\" exact>\n                    <Users />\n                  </Route>\n                  <Route path=\"/beacon\" exact>\n                    <Beacon />\n                  </Route>\n                  <Route path=\"/group/:id\" exact>\n                    <BeaconGroup />\n                  </Route>\n                  <Route path=\"/operator/:operatorId\" exact>\n                    <Operator />\n                  </Route>\n                  <Route path=\"/operator/:operatorId/:tabId\" exact>\n                    <Operator />\n                  </Route>\n                  <Route path=\"/deposit/:depositId\" exact>\n                    <Deposit />\n                  </Route>\n                  <Route path=\"/stakedrop\" exact>\n                    <Stakedrop />\n                  </Route>\n                  <Route path=\"/grants\" exact>\n                    <Grants />\n                  </Route>\n                </Switch>\n              </div>\n            </UseWalletProvider>\n          </TimeTravelState>\n        </ApolloProvider>\n      </Router>\n  );\n}\n\nfunction App() {\n  const network = (window.location.host.indexOf(\"ropsten\") > -1) ? Network.ROPSTEN : Network.MAINNET;\n  return <SetNetwork network={network}>\n    <AppInternal />\n  </SetNetwork>\n}\n\nexport default App;\n\n\nfunction Header() {\n  return <div className={css`\n    background: #fafafa; /* #48DBB4; */\n    border-bottom: 1px #C4C4C4 solid;\n    \n    display: flex;\n    flex-direction: row;\n    padding: 0 20px;   \n  `}>\n    <strong style={{padding: '10px 20px 10px 0'}}>\n      <img src={\"/logo.png\"} height={40} alt={\"AllTheKeeps Logo\"} />\n    </strong>\n\n    <NavigationButton to={\"/deposits\"}>\n      Deposits\n    </NavigationButton>\n\n    <NavigationButton to={\"/operators\"}>\n      Operators\n    </NavigationButton>\n\n    <NavigationButton to={\"/governance\"}>\n      Governance\n    </NavigationButton>\n\n    <NavigationButton to={\"/users\"}>\n      Users\n    </NavigationButton>\n\n    <NavigationButton to={\"/beacon\"}>\n      Beacon\n    </NavigationButton>\n\n    <NavigationButton to={\"/grants\"}>\n      Grants\n    </NavigationButton>\n\n    <NavigationButton to={'/stakedrop'}>\n      <img alt=\"Stakedrop Icon\" style={{height: '2em'}} src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iNjQiIGhlaWdodD0iNjQiCnZpZXdCb3g9IjAgMCAxMjggMTI4IgpzdHlsZT0iIGZpbGw6IzAwMDAwMDsiPjxwYXRoIGZpbGw9IiNGOUE3QjUiIGQ9Ik0xNCw2OS44djE3LjVjMCw3LjMsNS45LDEzLjIsMTMuMiwxMy4yYzEuNywwLDMuMy0wLjMsNC44LTAuOWwwLDBjOS4yLTMuMSwxOS4zLTIuMSwyNy43LDIuN2w2LjcsMy44aDBjNC44LDMuMiwxMC42LDUsMTYuOCw1YzE3LDAsMzAuNy0xMy43LDMwLjctMzAuN1Y2NC43TDE0LDY5Ljh6Ij48L3BhdGg+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTExMC42LDQ4LjhjMC0wLjEtMC4xLTAuMS0wLjEtMC4yYy0wLjItMC4zLTAuMy0wLjYtMC41LTAuOWMtNi0xMC44LTE4LjctMTkuMi0zNy4zLTE5LjJjLTI4LjksMC00OS41LDI0LjUtNTUuNCwzMi41Yy0wLjcsMC44LTEuMywxLjYtMS44LDIuNWMwLDAsMCwwLDAsMGwwLDBjLTEsMS45LTEuNiw0LTEuNiw2LjNjMCw3LjMsNS45LDEzLjIsMTMuMiwxMy4yYzEuNywwLDMuMy0wLjMsNC44LTAuOWwwLDBjOS4yLTMuMSwxOS4zLTIuMSwyNy43LDIuN2w2LjcsMy44aDBjNC44LDMuMiwxMC42LDUsMTYuOCw1YzE3LDAsMzAuNy0xMy43LDMwLjctMzAuN0MxMTQsNTcuNywxMTIuOCw1MywxMTAuNiw0OC44eiI+PC9wYXRoPjxwYXRoIGZpbGw9IiNGRjY5N0QiIGQ9Ik04My4zLDg1LjZjLTQuNCwwLTguOC0xLjMtMTIuNS0zLjdsLTAuMi0wLjFsLTctMy45Yy02LjMtMy42LTEzLjUtNS40LTIwLjctNS40Yy00LjUsMC05LDAuNy0xMy40LDIuMmwtMC4yLDAuMWwtMC4zLDAuMWMtMC42LDAuMi0xLjIsMC40LTEuOSwwLjRjLTIuOSwwLTUuMy0yLjQtNS4zLTUuM2MwLTAuOSwwLjItMS43LDAuNi0yLjVsMCwwYzAuMi0wLjMsMC40LTAuNiwwLjctMC45bDAuMi0wLjNsMC4yLTAuM2M1LjEtNi45LDIzLjgtMjkuMyw0OS4xLTI5LjNjMTQsMCwyNS4xLDUuNSwzMC40LDE1LjFjMC4yLDAuMywwLjMsMC41LDAuNCwwLjdsMCwwLjFjMS43LDMuMywyLjUsNi44LDIuNSwxMC41QzEwNi4xLDc1LjMsOTUuOSw4NS42LDgzLjMsODUuNnoiPjwvcGF0aD48cGF0aCBmaWxsPSIjRkZGIiBkPSJNODMuMyA1NEE4LjggOC44IDAgMSAwIDgzLjMgNzEuNkE4LjggOC44IDAgMSAwIDgzLjMgNTRaIj48L3BhdGg+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM0Y0QTU0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJNMTE0LDY0Ljd2MTUuNmMwLDE3LTEzLjcsMzAuNy0zMC43LDMwLjdjLTYuMiwwLTEyLTEuOC0xNi44LTVoMGwtNi43LTMuOGMtOC41LTQuOC0xOC41LTUuNy0yNy43LTIuN2wwLDBjLTEuNSwwLjYtMy4xLDAuOS00LjgsMC45Yy03LjMsMC0xMy4yLTUuOS0xMy4yLTEzLjJWNjkuOGMwLTIuMywwLjYtNC40LDEuNi02LjNsMCwwYzAsMCwwLDAsMCwwYzAuNS0wLjksMS4xLTEuNywxLjgtMi41YzUuOS04LDI2LjYtMzIuNSw1NS40LTMyLjVjMTguNiwwLDMxLjMsOC4zLDM3LjMsMTkuMmMwLjIsMC4zLDAuMywwLjYsMC41LDAuOWMwLDAuMSwwLjEsMC4xLDAuMSwwLjJjMi4xLDQuMiwzLjQsOC45LDMuNCwxNCI+PC9wYXRoPjwvc3ZnPg==\"/>\n    </NavigationButton>\n\n    <NavigationButton to={'/torch'}>\n      <img alt=\"Torch Icon\" style={{height: '2em'}} src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iNjQiIGhlaWdodD0iNjQiCnZpZXdCb3g9IjAgMCAxMjggMTI4IgpzdHlsZT0iIGZpbGw6IzAwMDAwMDsiPjxwYXRoIGZpbGw9IiNmY2NhM2QiIGQ9Ik00MC43LDQyLjlMNDAuNyw0Mi45TDU0LDE0bDUsOEw2OSw0YzAsMCwxNy45LDM3LjgsMTguMiwzOC44bDAsMGMxLjEsMi44LDEuOCw1LjksMS44LDkuMiBjMCwxMy44LTExLjIsMjUtMjUsMjVTMzksNjUuOCwzOSw1MkMzOSw0OC44LDM5LjYsNDUuNyw0MC43LDQyLjl6Ij48L3BhdGg+PHBhdGggZmlsbD0iI2ZmNjE0NCIgZD0iTTc5LDY2LjdjLTAuNiwwLTEuMy0wLjItMS44LTAuNmMtMS4zLTEtMS41LTIuOS0wLjUtNC4yQzc4LjgsNTksODAsNTUuNiw4MCw1MmMwLTItMC40LTMuOS0xLjEtNS44IGMtMC4zLTAuNi0yLjMtNS0xMC40LTIyLjFjLTAuNy0xLjUtMC4xLTMuMywxLjQtNGMxLjUtMC43LDMuMy0wLjEsNCwxLjRjNi41LDEzLjcsMTIsMjEuMiwxMi40LDIyLjNjMCwwLDAsMC4xLDAuMSwwLjEgYzEsMi42LDEuNSw1LjMsMS41LDhjMCw1LTMuNiw5LjYtNi43LDEzLjZDODAuNyw2Ni4zLDc5LjgsNjYuNyw3OSw2Ni43eiI+PC9wYXRoPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik02NC42IDY0YzYuOC0uMyAxMi4yLTYuMyAxMS45LTEzLjItLjEtMS4zLS4zLTIuNi0uOC0zLjgtLjMtLjYtLjUtMS4yLS43LTEuNGwtLjItLjR2MGMtLjYtMS4xLTIuMy0uOS0yLjYuNHYwQzcxLjkgNDcgNzAuOCA0OCA2OS40IDQ4Yy0xIDAtMi0uNS0yLjYtMS41TDYyIDM3LjdjLTEuMi0yLjEtNC4zLTItNS4zLjJsLTMuMyA3TDUzIDQ1LjVjLS4yLjQtLjUuOS0uNyAxLjQtLjYgMS41LS45IDMtLjkgNC42QzUxLjUgNTguNiA1Ny40IDY0LjMgNjQuNiA2NHpNNjkgMTI0TDU5IDEyNCA1NCA4OSA3NCA4OXpNNDEgNzdIODdWODlINDF6Ij48L3BhdGg+PHBhdGggZmlsbD0iIzQ0NGI1NCIgZD0iTTg3IDc0aC01LjdDODcuOCA2OC45IDkyIDYwLjkgOTIgNTJjMC0zLjUtLjctNy0yLTEwLjMgMC0uMS0uMS0uMS0uMS0uMi0xLjItMi42LTE0LjEtMjkuOS0xOC4yLTM4LjctLjUtMS0xLjQtMS43LTIuNS0xLjhDNjggLjkgNjcgMS41IDY2LjQgMi41bC03LjUgMTMuNi0yLjMtMy43Yy0uNi0uOS0xLjYtMS41LTIuNy0xLjQtMS4xLjEtMi4xLjctMi41IDEuN0wzOCA0MS42Yy0uMS4xLS4xLjItLjEuNC0xLjIgMy4yLTEuOCA2LjYtMS44IDEwIDAgNS45IDEuOCAxMS41IDUuMiAxNi4yLjkgMS4yIDIuNSAxLjcgMy44IDEuMSAxLjctLjggMi4yLTMgMS4yLTQuNUM0Mi43IDYwIDQxLjMgNTQgNDIuNCA0Ny45Yy4yLTEuNC43LTIuNyAxLjItNGwwIDAgMTAuMS0yMmMuMy0uNyAxLjMtLjggMS44LS4xbDEuMSAxLjdjLjggMS4zIDIuNCAxLjggMy45IDEuMS42LS4zIDEtLjggMS4zLTEuM2w2LjItMTEuMWMuNC0uNyAxLjQtLjcgMS44LjFDNzYuMyAyNi40IDg0LjEgNDMgODQuNSA0My45bDAgLjFjLjMuOC42IDEuNS44IDIuM0M4OSA2MC45IDc4IDc0IDY0IDc0SDQxYy0xLjcgMC0zIDEuMy0zIDN2MTJjMCAxLjcgMS4zIDMgMyAzaDEwLjRsNC42IDMyLjRjLjIgMS41IDEuNSAyLjYgMyAyLjZoMTBjMS41IDAgMi44LTEuMSAzLTIuNkw3Ni42IDkySDg3YzEuNyAwIDMtMS4zIDMtM1Y3N0M5MCA3NS4zIDg4LjcgNzQgODcgNzR6TTY1LjUgMTIxaC0zYy0uNSAwLS45LS40LTEtLjlsLTMuOS0yN2MtLjEtLjYuNC0xLjEgMS0xLjFoMTAuOGMuNiAwIDEuMS41IDEgMS4xbC0zLjkgMjdDNjYuNCAxMjAuNiA2NiAxMjEgNjUuNSAxMjF6TTgzIDg2SDQ1Yy0uNiAwLTEtLjQtMS0xdi00YzAtLjYuNC0xIDEtMWgzOGMuNiAwIDEgLjQgMSAxdjRDODQgODUuNiA4My42IDg2IDgzIDg2ek0zOSAxQTMgMyAwIDEgMCAzOSA3IDMgMyAwIDEgMCAzOSAxeiI+PC9wYXRoPjwvc3ZnPg==\"/>\n    </NavigationButton>\n\n    <div style={{flex: 1}} />\n\n    <SettingsDropdownButton />\n\n    <NavigationButton to={\"/about\"}>\n      About\n    </NavigationButton>\n  </div>\n}\n\n\n// Estimating block time https://blocklytics.org/blog/ethereum-blocks-subgraph-made-for-time-travel/\n// NB: This does not really work at all, why?\nconst anchor = 10867845;\nconst anchorTime = 1600188773;\nfunction timeOfBlock(number: number) {\n  return DateTime.fromSeconds(anchorTime + ((number - anchor) * 14));\n}\n\n\nfunction TimeTravelWarning() {\n  const block = useTimeTravelBlock();\n\n  const location = useLocation();\n  const nonTimeTravelLink = useMemo(() => {\n    const query = new URLSearchParams(location.search);\n    if (query.has(\"block\")) { query.delete(\"block\"); }\n    return `${location.pathname}${query.toString()}`\n  }, [location.pathname, location.search]);\n\n  if (!block) {\n    return null;\n  }\n\n  return <div className={css`\n    padding: 8px;\n    font-size: 14px;\n    background-color: #fff9c4;\n  `}>\n    You are viewing the state at a block height of <strong>{block}</strong>.\n    {\" \"}<Link to={nonTimeTravelLink} style={{color: '#5519d3'}}>Exit Time Travel</Link>.\n  </div>\n}\n\n\nfunction SettingsDropdownButton() {\n  const tippy = useRef<any>();\n\n  return <Tippy\n    trigger=\"manual\"\n    hideOnClick={true}\n    arrow={false}\n    interactive={true}\n    maxWidth={600}\n    className={css`\n        background-color: transparent;\n        padding: 0;\n        color: inherit;\n      `}\n    onCreate={(instance) => {\n      tippy.current = instance;\n    }}\n    content={\n      <Paper>\n        <div className={css`\n          display: flex;\n          flex-direction: column;\n        `}\n        >\n          <NetSwitcher />\n\n          <hr className={css`\n            width: 100%;\n            border: none;\n            border-top: 1px solid silver;\n          `} />\n\n          <div className={css`\n            display: inline-block;\n            padding: 10px;\n          `}>\n            <div>\n              <strong>Time Travel</strong>\n              <div style={{color: 'gray'}}>\n                Browse state at a specific block time.\n              </div>\n            </div>\n            <div>\n              <TimeTravelField />\n            </div>\n          </div>\n        </div>\n      </Paper>\n    }>\n      <NavigationButton onClick={(e: any) => {e.preventDefault(); tippy.current.show() }}>\n        <img alt=\"Preferences Icon\" style={{height: '2em'}}  src=\"data:image/png;base64,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\"/>\n      </NavigationButton>\n  </Tippy>\n}\n\nfunction NetSwitcher() {\n  const network = useNetwork();\n\n  const handleClick = () => {\n    if (network == Network.MAINNET) {\n      window.location.href = \"https://ropsten.allthekeeps.com\";\n    }\n    else {\n      window.location.href = \"https://allthekeeps.com\";\n    }\n  }\n\n  return <div className={css`\n    display: inline-block;\n    padding: 10px;\n  `}>\n    <div style={{marginBottom: 5}}>\n      <strong>{network == Network.MAINNET ? \"Mainnet\" : \"Ropsten Testnet\"}</strong>\n    </div>\n    <Button size={\"tiny\"} onClick={handleClick}>\n      {network == Network.MAINNET ? \"Switch to Ropsten Testnet\" : \"Switch to Mainnet\"}\n    </Button>\n  </div>\n}\n\nfunction TimeTravelField() {\n  const block = useTimeTravelBlock();\n  const history = useHistory();\n  const location = useLocation();\n  const [text, setText] = useState<string>(block?.toString() ?? \"\");\n\n  const apply = () => {\n    const blockNumber = parseInt(text);\n    if (!blockNumber || !text) { return; }\n\n    const query = new URLSearchParams(location.search);\n    query.set('block', blockNumber.toString());\n    history.push(`${location.pathname}?${query.toString()}`);\n  }\n\n  const handleKeyPress = (e: any) => {\n    if (e.keyCode == 13) {\n      apply();\n    }\n  };\n  const handleBlur = (e: any) => {\n    apply();\n  };\n\n  return <input\n    value={text}\n    placeholder={\"Block Number\"}\n    className={css`\n      padding: 0.4em;\n      margin-top: 5px;\n    `}\n    onChange={(e) => { setText(e.target.value) }}\n    onBlur={handleBlur}\n    onKeyDown={handleKeyPress}\n  />\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","/** @typedef { import(\"web3-eth-contract\").Contract } EthereumContract */\n\nimport secp256k1 from \"bcrypto/lib/secp256k1-browser.js\"\nimport KeyRing from \"bcoin/lib/primitives/keyring.js\"\nimport Outpoint from \"bcoin/lib/primitives/outpoint.js\"\nimport Input from \"bcoin/lib/primitives/input.js\"\nimport Output from \"bcoin/lib/primitives/output.js\"\nimport TX from \"bcoin/lib/primitives/tx.js\"\nimport BcoinScript from \"bcoin/lib/script/index.js\"\n//import { BitcoinSPV } from \"./lib/BitcoinSPV.js\"\n/** @typedef { import(\"./lib/BitcoinSPV.js\").Proof } Proof */\n//import { BitcoinTxParser } from \"./lib/BitcoinTxParser.js\"\nimport ElectrumClient from \"./ElectrumClient\"\n\n/** @typedef { import(\"./lib/ElectrumClient.js\").Config } ElectrumConfig */\n\n//import BN from \"bn.js\"\n//import { backoffRetrier } from \"./lib/backoff.js\"\n\nconst { Script } = BcoinScript\n\n/** @enum {string} */\nexport const BitcoinNetwork = {\n  TESTNET: \"testnet\",\n  MAINNET: \"main\",\n  SIMNET: \"simnet\",\n  REGTEST: \"regtest\"\n}\n\n/**\n * Partial details about a transaction; same fields as `Transaction`, but only\n * the transaction ID is guaranteed to be present in a function that returns\n * this type.\n *\n * @typedef {object} PartialTransactionInBlock\n * @property {string} transactionID Transaction ID.\n * @property {number} [outputPosition] Position of output in the transaction.\n * @property {number} [value] Value of the output (satoshis).\n */\n\n/**\n * Complete details about a transaction in a block.\n *\n * @typedef {object} TransactionInBlock\n * @property {string} transactionID Transaction ID.\n * @property {number} outputPosition Position of output in the transaction.\n * @property {number} value Value of the output (satoshis).\n */\n\n/**\n * An extraction of a transaction's important fields as hex strings.\n *\n * @typedef {object} HexTransactionFields\n * @property {string} version The transaction version as an unprefixed hex\n *           string.\n * @property {string} txInVector The transaction input vector as an unprefixed\n *           (i.e. without leading 0x), length-prefixed raw hex string.\n * @property {string} txOutVector The transaction output vector as an\n *           unprefixed (i.e. without leading 0x), length-prefixed raw hex\n *           string.\n * @property {string} locktime The transaction locktime as an unprefixed hex\n *           string.\n */\n\n/**\n * @typedef {object} SPVProofInfo\n * @property {HexTransactionFields} parsedTransaction Parsed transaction with\n *           additional data useful in submitting SPV proofs, stored as buffers.\n */\n\n/**\n * @typedef {Proof & SPVProofInfo} SPVProof\n */\n\n/**\n * A handler that is notified whenever a new confirmation arrives for a given\n * transaction id.\n *\n * @callback OnReceivedConfirmationHandler\n * @param {{ transactionID: string, confirmations: number, requiredConfirmations: number }} confirmationInfo\n *        The transaction id whose confirmation was received, the\n *        total number of confirmations seen for that transaction id,\n *        and the required confirmations for that transaction id.\n */\n\nconst BitcoinHelpers = {\n  Network: BitcoinNetwork,\n\n  /** @type {ElectrumConfig?} */\n  electrumConfig: null,\n\n  /**\n   * Updates the config to use for Electrum client connections. Electrum is\n   * the core mechanism used to interact with the Bitcoin blockchain.\n   *\n   * @param {ElectrumConfig} newConfig The config to use for future Electrum\n   *        connections.\n   */\n  setElectrumConfig: function(newConfig) {\n    BitcoinHelpers.electrumConfig = newConfig\n  },\n\n  /**\n   * Converts signature provided as `r` and `s` values to a bitcoin signature\n   * encoded to the DER format:\n   *   30 <length total> 02 <length r> <r (BE)> 02 <length s> <s (BE)>\n   * It also checks `s` value and converts it to a low value if necessary as per\n   * [BIP-0062](https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki#low-s-values-in-signatures).\n   *\n   * @param {string} r A signature's `r` value in hexadecimal format.\n   * @param {string} s A signature's `s` value in hexadecimal format.\n   *\n   * @return {Buffer} The signature in the DER format.\n   */\n  signatureDER: function(r, s) {\n    // Verifies if either of `r` or `s` values equals zero or is greater or equal\n    // curve's order. If so throws an error.\n    // Checks if `s` is a high value. As per BIP-0062 signature's `s` value should\n    // be in a low half of curve's order. If it's a high value it's converted to\n    // `-s`.\n    // Checks `s` per BIP-62: signature's `s` value should be in a low half of\n    // curve's order. If it's not, it's converted to `-s`.\n    const bitcoinSignature = secp256k1.signatureNormalize(\n        Buffer.from(r.concat(s), \"hex\")\n    )\n\n    return secp256k1.signatureExport(bitcoinSignature)\n  },\n  /**\n   * Takes the x and y coordinates of a public key point and returns a\n   * hexadecimal representation of 64-byte concatenation of x and y\n   * coordinates.\n   *\n   * @param {string} publicKeyX A hex public key X coordinate.\n   * @param {string} publicKeyY A hex public key Y coordinate.\n   *\n   * @return {string} An unprefixed, concatenated hex representation of the two\n   *         given coordinates.\n   */\n  publicKeyPointToPublicKeyString: function(publicKeyX, publicKeyY) {\n    return `${publicKeyX.replace(\"0x\", \"\")}${publicKeyY.replace(\"0x\", \"\")}`\n  },\n  Address: {\n    /**\n     * Converts the a public key point, specified as distinct X and Y\n     * components represented as hex strings, to a Bitcoin P2WPKH address for\n     * the specified Bitcoin network.\n     *\n     * @param {string} publicKeyX The X component of a public key.\n     * @param {string} publicKeyY The Y component of a public key.\n     * @param {BitcoinNetwork} bitcoinNetwork The Bitcoin network to generate an\n     *        address for.\n     *\n     * @return {string} The Bitcoin P2WPKH address for the given network.\n     */\n    publicKeyPointToP2WPKHAddress: function(\n        publicKeyX,\n        publicKeyY,\n        bitcoinNetwork\n    ) {\n      return this.publicKeyToP2WPKHAddress(\n          BitcoinHelpers.publicKeyPointToPublicKeyString(publicKeyX, publicKeyY),\n          bitcoinNetwork\n      )\n    },\n    /**\n     * Converts the specified `pubKeyHash` to a valid Bech32 address for\n     * the specified `network`.\n     *\n     * @param {string} pubKeyHash A pubKeyHash as a string.\n     * @param {string} network The Bitcoin network for the Bech32 address.\n     *\n     * @return {string} A Bech32 address corresponding to the given pubKeyHash\n     *         on the given network.\n     */\n    pubKeyHashToBech32: function(pubKeyHash, network) {\n      const address = Script.fromProgram(\n          0,\n          Buffer.from(pubKeyHash, \"hex\")\n      ).getAddress()\n\n      if (address === null) {\n        throw new Error(`Malformed PubKeyHash: ${pubKeyHash}`)\n      }\n\n      return address.toBech32(network)\n    },\n    /**\n     * Converts a public key to the public key byte format expected by various\n     * bcoin functions.\n     *\n     * @param {string} publicKeyString Public key as a hexadecimal\n     *        representation of 64-byte concatenation of x and y coordinates.\n     * @return {{ x: Buffer, y: Buffer }} An object containing the x and y\n     *         components of the public key as separate buffers.\n     */\n    splitPublicKey: function(publicKeyString) {\n      const [xString, yString] = [\n        publicKeyString.substring(0, publicKeyString.length / 2),\n        publicKeyString.substring(publicKeyString.length / 2)\n      ]\n      return {\n        x: Buffer.from(xString, \"hex\"),\n        y: Buffer.from(yString, \"hex\")\n      }\n    },\n    /**\n     * Converts public key to bitcoin Witness Public Key Hash Address according to\n     * [BIP-173](https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki).\n     * @param {string} publicKeyString Public key as a hexadecimal representation of\n     * 64-byte concatenation of x and y coordinates.\n     * @param {BitcoinNetwork} network Network for which address has to be calculated.\n     * @return {string} A Bitcoin P2WPKH address for given network.\n     */\n    publicKeyToP2WPKHAddress: function(publicKeyString, network) {\n      // Witness program requires usage of compressed public keys.\n      const compress = true\n\n      const publicKey = secp256k1.publicKeyImport(\n          BitcoinHelpers.Address.splitPublicKey(publicKeyString),\n          compress\n      )\n      const keyRing = KeyRing.fromKey(publicKey, compress)\n      const p2wpkhAddress = Script.fromProgram(\n          0,\n          keyRing.getKeyHash(null)\n      ).getAddress()\n\n      if (p2wpkhAddress === null) {\n        throw new Error(\n            `Could not derive p2wpkh address from public key ${publicKeyString}.`\n        )\n      }\n\n      // Serialize address to a format specific to given network.\n      return p2wpkhAddress.toString(network)\n    },\n    /**\n     * Converts a Bitcoin ScriptPubKey address string to a hex script\n     * string.\n     *\n     * @param {string} address A Bitcoin address.\n     *\n     * @return {string} A Bitcoin script for the given address, as an\n     *         unprefixed hex string.\n     */\n    toScript: function(address) {\n      return BitcoinHelpers.Address.toRawScript(address).toString(\"hex\")\n    },\n    /**\n     * Used to convert `redeemerOutputScript` to a BTC address.\n     */\n    fromScript: function(script) {\n      // We receive the script with a 0x prefix\n      script = script.slice(2)\n      // The first byte is a length-prefix added by the client when requesting the redemption to the Script.toRaw() output.\n      script = script.slice(2)\n      return Script.fromRaw(Buffer.from(script, 'hex')).getAddress().toString()\n    },\n    /**\n     * Converts a Bitcoin ScriptPubKey address string to a raw script\n     * buffer.\n     *\n     * @param {string} address A Bitcoin address.\n     *\n     * @return {Buffer} A Bitcoin script for the given address, as a Buffer\n     *         of bytes.\n     */\n    toRawScript: function(address) {\n      // Reading of the Script.toRaw code makes it clear this will always be a\n      // Buffer, and indeed the bcoin code itself `assert`s it in several\n      // places.\n      return /** @type {Buffer} */ (Script.fromAddress(address).toRaw())\n    }\n  },\n  /**\n   * Sets up an Electrum client instance and passes it to the passed `block`,\n   * setting the Electrum client to be closed once the promise the block returns\n   * completes. Returns a promise to the block's final result.\n   *\n   * Example usage:\n   *\n   *   const value = await BitcoinHelpers.withElectrumClient(async (client) => {\n   *     return client.lookUpValue()\n   *   })\n   *\n   * @param {function(ElectrumClient):Promise<T>} block A function to execute\n   *        with the ElectrumClient passed in; it is expected to return a\n   *        Promise that will resolve once the function is finished performing\n   *        work with the client. withElectrumClient returns that promise, but\n   *        also ensures that the client will be closed once the promise\n   *        completes (successfully or unsuccessfully).\n   * @template T\n   */\n  withElectrumClient: async function(block) {\n    if (BitcoinHelpers.electrumConfig === null) {\n      throw new Error(\"Electrum client not configured.\")\n    }\n\n    const electrumClient = new ElectrumClient(BitcoinHelpers.electrumConfig)\n\n    await electrumClient.connect()\n\n    const result = block(electrumClient)\n    result.then(\n        () => {\n          electrumClient.close()\n        },\n        () => {\n          electrumClient.close()\n        }\n    )\n\n    return result\n  },\n  Transaction: {\n    /**\n     * Finds a transaction to the given `bitcoinAddress` of the given\n     * `expectedValue`. If there is more than one such transaction, returns\n     * the most recent one.\n     *\n     * @param {string} bitcoinAddress A receiving Bitcoin address.\n     * @param {number} expectedValue The expected value of the transaction\n     *        to fetch.\n     *\n     * @return {Promise<TransactionInBlock?>} A promise to an object of\n     *         transactionID, outputPosition, and value, that resolves with\n     *         either null if such a transaction could not be found, or the\n     *         information about the transaction that was found.\n     */\n    find: async function(bitcoinAddress, expectedValue) {\n      const script = BitcoinHelpers.Address.toScript(bitcoinAddress)\n\n      return await BitcoinHelpers.Transaction.findScript(script, expectedValue)\n    },\n    /**\n     * Finds a transaction to the given `outputScript` of the given\n     * `expectedValue`. If there is more than one such transaction, returns\n     * the most recent one.\n     *\n     * @param {string} outputScript A Bitcoin output script to look for as a\n     *        non-0x-prefixed hex string.\n     * @param {number} expectedValue The expected value of the transaction\n     *        to fetch.\n     * @param {string} [outpoint] If specified, only finds a transaction that\n     *        spends the specified outpoint.\n     *\n     * @return {Promise<TransactionInBlock?>} A promise to an object of\n     *         transactionID, outputPosition, and value, that resolves with\n     *         either null if such a transaction could not be found, or the\n     *         information about the transaction that was found.\n     */\n    findScript: async function(outputScript, expectedValue, outpoint) {\n      return await BitcoinHelpers.withElectrumClient(electrumClient => {\n        return BitcoinHelpers.Transaction.findWithClient(\n            electrumClient,\n            outputScript,\n            expectedValue,\n            outpoint\n        )\n      })\n    },\n    /**\n     * Watches the Bitcoin chain for a transaction of value `expectedValue`\n     * to address `bitcoinAddress`.\n     *\n     * @param {string} bitcoinAddress Bitcoin address to watch.\n     * @param {number} expectedValue The expected value to watch for.\n     *\n     * @return {Promise<TransactionInBlock>} A promise to the found\n     *         transaction once it is seen on the chain.\n     */\n    findOrWaitFor: async function(electrumClient, bitcoinAddress, expectedValue) {\n      const script = BitcoinHelpers.Address.toScript(bitcoinAddress)\n\n      // This function is used as a callback to electrum client. It is\n      // invoked when an existing or a new transaction is found.\n      const checkTransactions = async function(/** @type {string?} */ status) {\n        // If the status is set, transactions were seen for the script.\n        if (status) {\n          return BitcoinHelpers.Transaction.findWithClient(\n              electrumClient,\n              script,\n              expectedValue\n          )\n        }\n\n        // Return null if status is unset so we continue receiving events.\n        return null\n      }\n\n      return electrumClient.onTransactionToScript(script, checkTransactions)\n    },\n    /**\n     * Checks the given Bitcoin `transactionID` to ensure it has at least\n     * `requiredConfirmations` on-chain. If it does, resolves the returned\n     * promise with the current number of on-chain confirmations. If it does\n     * not, fulfills the promise with `null`.\n     *\n     * @param {string} transactionID A hex Bitcoin transaction id hash.\n     * @param {number} requiredConfirmations A number of required\n     *        confirmations below which this function will return null.\n     *\n     * @return {Promise<number?>} A promise to the current number of\n     *         confirmations for the given `transaction`, iff that transaction\n     *         has at least `requiredConfirmations` confirmations.\n     */\n    checkForConfirmations: async function(\n        electrumClient,\n        transactionID,\n        requiredConfirmations\n    ) {\n      const { confirmations } = await electrumClient.getTransaction(\n          transactionID\n      )\n      if (confirmations >= requiredConfirmations) {\n        return confirmations\n      }\n\n      return null\n    },\n    /**\n     * Watches the Bitcoin chain until the given `transactionID` has the given\n     * number of `requiredConfirmations`.\n     *\n     * @param {string} transactionID A hex Bitcoin transaction id hash.\n     * @param {number} requiredConfirmations The number of required\n     *        confirmations to wait before returning.\n     * @param {OnReceivedConfirmationHandler} [onReceivedConfirmation] A\n     *        callback that fires when a confirmation is seen.\n     */\n    waitForConfirmations: async function(\n        electrumClient,\n        transactionID,\n        requiredConfirmations,\n        onReceivedConfirmation\n    ) {\n      const checkConfirmations = async function(block) {\n        const { confirmations } = await electrumClient.getTransaction(\n            transactionID\n        )\n\n        if (typeof onReceivedConfirmation === \"function\" && confirmations) {\n          onReceivedConfirmation({\n            transactionID,\n            confirmations,\n            requiredConfirmations\n          })\n        }\n\n        if (confirmations >= requiredConfirmations) {\n          electrumClient.off('block', checkConfirmations);\n        }\n      }\n\n      electrumClient.on('block', checkConfirmations)\n      return () => {\n        electrumClient.off('block', checkConfirmations)\n      }\n    },\n    /**\n     * Estimates the fee that would be needed for a given transaction.\n     *\n     * @param {EthereumContract} tbtcConstantsContract The TBTCConstants\n     *        contract that provides the stub value for this function.\n     *\n     * @warning This is a stub. Currently it takes the TBTCConstants\n     *          contract and returns its reported minimum fee, rather than\n     *          calling electrumClient.blockchainEstimateFee.\n     *\n     * @return {Promise<BN>} The estimated fee to execute the provided\n     *         transaction.\n     */\n    // estimateFee: async function(tbtcConstantsContract) {\n    //   return new BN(\n    //       await tbtcConstantsContract.methods.getMinimumRedemptionFee().call()\n    //   ).muln(4)\n    // },\n    /**\n     * For the given `transactionID`, constructs an SPV proof that proves it\n     * has at least `confirmations` confirmations on the Bitcoin chain.\n     * Returns data for this proof, as well as the parsed Bitcoin\n     * transaction data.\n     *\n     * @param {string} transactionID A hex Bitcoin transaction id hash.\n     * @param {number} confirmations The number of confirmations to include\n     *        in the proof.\n     *\n     * @return {Promise<SPVProof>} The proof data, plus the parsed transaction\n     *         for the proof.\n     */\n    // getSPVProof: async function(transactionID, confirmations) {\n    //   return await BitcoinHelpers.withElectrumClient(async electrumClient => {\n    //     const spv = new BitcoinSPV(electrumClient)\n    //     const proof = await backoffRetrier(3, err =>\n    //         String(err).includes(\"not in block at height\")\n    //     )(async () => spv.getTransactionProof(transactionID, confirmations))\n    //\n    //     return {\n    //       ...proof,\n    //       parsedTransaction: BitcoinTxParser.parse(proof.tx)\n    //     }\n    //   })\n    // },\n    /**\n     * Broadcasts the given signed transaction to the Bitcoin chain.\n     *\n     * @param {string} signedTransaction The signed transaction in\n     *        hexadecimal format.\n     *\n     * @return {Promise<PartialTransactionInBlock>} Partial information for the\n     *         broadcast transaction with the transactionID field set.\n     */\n    broadcast: async function(signedTransaction) {\n      return await BitcoinHelpers.withElectrumClient(async electrumClient => {\n        const transactionID = await electrumClient.broadcastTransaction(\n            signedTransaction\n        )\n\n        return {\n          transactionID: transactionID\n        }\n      })\n    },\n    /**\n     * Adds a witness signature for an input in a transaction.\n     *\n     * @param {string} unsignedTransaction Unsigned raw bitcoin transaction\n     *        in hexadecimal format.\n     * @param {number} inputIndex Index number of input to be signed.\n     * @param {string} r Signature's `r` value in hexadecimal format.\n     * @param {string} s Signature's `s` value in hexadecimal format.\n     * @param {string} publicKey 64-byte signer's public key's concatenated\n     *        x and y coordinates in hexadecimal format.\n     *\n     * @return {string} Raw transaction in a hexadecimal format with witness\n     *         signature.\n     */\n    addWitnessSignature: function(\n        unsignedTransaction,\n        inputIndex,\n        r,\n        s,\n        publicKey\n    ) {\n      // Signature\n      let signatureDER\n      try {\n        signatureDER = BitcoinHelpers.signatureDER(r, s)\n      } catch (err) {\n        throw new Error(`failed to convert signature to DER format: [${err}]`)\n      }\n\n      const hashType = Buffer.from([Script.hashType.ALL])\n      const sig = Buffer.concat([signatureDER, hashType])\n\n      // Public Key\n      let compressedPublicKey\n      try {\n        const publicKeyBytes = BitcoinHelpers.Address.splitPublicKey(publicKey)\n        compressedPublicKey = secp256k1.publicKeyImport(publicKeyBytes, true)\n      } catch (err) {\n        throw new Error(`failed to import public key: [${err}]`)\n      }\n\n      // Combine witness\n      let signedTransaction\n      try {\n        signedTransaction = TX.fromRaw(\n            Buffer.from(unsignedTransaction, \"hex\"),\n            null\n        ).clone()\n      } catch (err) {\n        throw new Error(`failed to import transaction: [${err}]`)\n      }\n\n      signedTransaction.inputs[inputIndex].witness.fromItems([\n        sig,\n        compressedPublicKey\n      ])\n\n      return signedTransaction.toRaw().toString(\"hex\")\n    },\n    /**\n     * Constructs a Bitcoin SegWit transaction with one input and one\n     * output. Difference between previous output's value and current's\n     * output value will be taken as a transaction fee.\n     *\n     * @param {string} previousOutpoint Previous transaction's output to be\n     *        used as an input. Provided in hexadecimal format, consists of\n     *        32-byte transaction ID and 4-byte output index number.\n     * @param {number} inputSequence Input's sequence number. As per\n     *        BIP-125 the value is used to indicate that transaction should\n     *        be able to be replaced in the future. If input sequence is set\n     *        to `0xffffffff` the transaction won't be replaceable.\n     * @param {number} outputValue Value for the output.\n     * @param {string} outputScript Output script for the transaction as an\n     *        unprefixed hexadecimal string.\n     *\n     * @return {string} Raw bitcoin transaction in hexadecimal format.\n     */\n    constructOneInputOneOutputWitnessTransaction(\n        previousOutpoint,\n        inputSequence,\n        outputValue,\n        outputScript\n    ) {\n      // Input\n      const prevOutpoint = Outpoint.fromRaw(\n          Buffer.from(previousOutpoint, \"hex\")\n      )\n\n      const input = Input.fromOptions({\n        prevout: prevOutpoint,\n        sequence: inputSequence\n      })\n\n      // Output\n      const rawOutputScript = Buffer.from(outputScript, \"hex\")\n\n      const output = Output.fromOptions({\n        value: outputValue,\n        script: rawOutputScript\n      })\n\n      // Transaction\n      const transaction = TX.fromOptions({\n        inputs: [input],\n        outputs: [output]\n      })\n\n      return transaction.toRaw().toString(\"hex\")\n    },\n    /**\n     * Finds all transactions containing unspent outputs received\n     * by the `bitcoinAddress`.\n     *\n     * @param {string} bitcoinAddress Bitcoin address to check.\n     *\n     * @return {Promise<TransactionInBlock[]>} A promise to an array of\n     *         transactions with accompanying information about the output\n     *         position and value pointed at the specified receiver script.\n     *         Resolves with an empty array if no such transactions exist.\n     */\n    findAllUnspent: async function(bitcoinAddress) {\n      return await BitcoinHelpers.withElectrumClient(async electrumClient => {\n        const script = BitcoinHelpers.Address.toScript(bitcoinAddress)\n        return BitcoinHelpers.Transaction.findAllUnspentWithClient(\n            electrumClient,\n            script\n        )\n      })\n    },\n    /**\n     * Gets the confirmed balance of the `bitcoinAddress`.\n     *\n     * @param {string} bitcoinAddress Bitcoin address to check.\n     *\n     * @return {Promise<number>} A promise to the confirmed balance in satoshis.\n     */\n    getBalance: async function(bitcoinAddress) {\n      return await BitcoinHelpers.withElectrumClient(async electrumClient => {\n        const script = BitcoinHelpers.Address.toScript(bitcoinAddress)\n        return Number(\n            (await electrumClient.getBalanceOfScript(script)).confirmed\n        )\n      })\n    },\n\n    // Raw helpers.\n    /**\n     * Finds a transaction to the given `receiverScript` of the given\n     * `expectedValue` using the given `electrumClient`. If there is more\n     * than one such transaction, returns the most recent one.\n     *\n     * @param {ElectrumClient} electrumClient An already-initialized Electrum client.\n     * @param {string} receiverScript A receiver script.\n     * @param {number} expectedValue The expected value of the transaction\n     *        to fetch.\n     * @param {string} [outpoint] If specified, only finds a transaction that\n     *        spends the specified outpoint.\n     *\n     * @return {Promise<TransactionInBlock?>} A promise to an object of\n     *         transactionID, outputPosition, and value, that resolves with\n     *         either null if such a transaction could not be found, or the\n     *         information about the transaction that was found.\n     */\n    findWithClient: async function(\n        electrumClient,\n        receiverScript,\n        expectedValue,\n        outpoint\n    ) {\n      const unspentTransactions = await electrumClient.getUnspentToScript(\n          receiverScript\n      )\n\n      for (const tx of unspentTransactions.reverse()) {\n        if (tx.value !== expectedValue) {\n          // Skip if the value doesn't match.\n          continue\n        }\n        if (typeof outpoint !== \"undefined\") {\n          const outpointMatches = (\n              await electrumClient.getTransaction(tx.tx_hash)\n          ).vin.some(({ txid, vout }) => {\n            const inputOutpoint = txid + vout\n            return inputOutpoint == outpoint\n          })\n\n          if (!outpointMatches) {\n            // If an outpoint filter is passed, skip if the outpoint isn't spent\n            // by the transaction.\n            continue\n          }\n        }\n\n        // If neither of the above `continue`d, this is a match; return it.\n        return {\n          transactionID: tx.tx_hash,\n          outputPosition: tx.tx_pos,\n          value: tx.value\n        }\n      }\n\n      return null\n    },\n    /**\n     * Finds all transactions to the given `receiverScript` using the\n     * given `electrumClient`.\n     *\n     * @param {ElectrumClient} electrumClient An already-initialized Electrum client.\n     * @param {string} receiverScript A receiver script.\n     *\n     * @return {Promise<TransactionInBlock[]>} A promise to an array of\n     *         transactions with accompanying information about the output\n     *         position and value pointed at the specified receiver script.\n     *         Resolves with an empty array if no such transactions exist.\n     */\n    findAllUnspentWithClient: async function(electrumClient, receiverScript) {\n      const unspentTransactions = await electrumClient.getUnspentToScript(\n          receiverScript\n      )\n\n      const result = []\n\n      for (const tx of unspentTransactions.reverse()) {\n        result.push({\n          transactionID: tx.tx_hash,\n          outputPosition: tx.tx_pos,\n          value: tx.value\n        })\n      }\n\n      return result\n    }\n  }\n}\n\nexport default BitcoinHelpers\n"],"sourceRoot":""}